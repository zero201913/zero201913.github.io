  <!DOCTYPE html>
  <html lang="zh-CN"  
      data-theme-mode="auto"
  >
  <head>
  <meta charset="utf-8">
  
  
  
  <script>window.REIMU_CONFIG = {};window.REIMU_CONFIG.icon_font = '4552607_4k4bc36ef96';window.REIMU_CONFIG.clipboard_tips = {"success":{"zh-CN":"复制成功 (*^▽^*)"},"fail":{"zh-CN":"复制失败 (ﾟ⊿ﾟ)ﾂ"},"copyright":{"enable":false,"count":50,"license_type":"by-nc-sa"}};window.REIMU_CONFIG.clipboard_tips.copyright.content = '本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！';window.REIMU_CONFIG.code_block = {"expand":true};window.REIMU_CONFIG.base = 'http://example.com';</script>
  <title>
    接口隔离原则与合成复用原则在Spring中的应用 | Zero02 Blog
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic|Noto Serif SC:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic|Noto Serif SC:400,400italic,700,700italic&display=swap" media="print" onload="this.media='all'">
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_4k4bc36ef96.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    
<link rel="stylesheet" href="/css/loader.css">

    <meta name="description" content="本文详细介绍了接口隔离原则(ISP)和合成复用原则(CRP)在SpringBoot和SpringCloud中的应用实践，包括接口拆分、微服务接口隔离、组合替代继承、依赖注入实现组合等最佳实践，帮助开发者构建模块化、可维护的系统架构。">
<meta property="og:type" content="article">
<meta property="og:title" content="接口隔离原则与合成复用原则在Spring中的应用">
<meta property="og:url" content="http://example.com/2026/02/03/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB&%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%202026_2_3/index.html">
<meta property="og:site_name" content="Zero02 Blog">
<meta property="og:description" content="本文详细介绍了接口隔离原则(ISP)和合成复用原则(CRP)在SpringBoot和SpringCloud中的应用实践，包括接口拆分、微服务接口隔离、组合替代继承、依赖注入实现组合等最佳实践，帮助开发者构建模块化、可维护的系统架构。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-02-03T01:30:00.000Z">
<meta property="article:modified_time" content="2026-02-03T12:27:42.747Z">
<meta property="article:author" content="Zero02">
<meta name="twitter:card" content="summary">
    <link rel="alternate" href="/atom.xml" title="Zero02 Blog" type="application/atom+xml">
    <link rel="shortcut icon" href="/images/favicon.ico">
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" integrity="sha384-IfxC36XL/toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx/1oA/0l8ysE" crossorigin="anonymous">
    
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script>

    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css" integrity="sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa" crossorigin="anonymous">

    <link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css" integrity="sha384-tLMkTWh2pfXNWGFlUS0w1TFtRG5xZ9lPWFOooj+vDDLIL+xBGQU/voDBY5XE2lVh" crossorigin="anonymous">
<meta name="generator" content="Hexo 8.1.0"></head>

  <body>
      <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi rotate">
          <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
           M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)" />
          </svg>
      </div>
      <div class="loading-word">少女祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var loaderEl = document.getElementById('loader');
    var startLoading = () => {
      time = Date.now();
      loaderEl.classList.remove("loading");
    }
    var hideLoader = () => {
      document.body.style.overflow = 'auto';
      loader.classList.add('loading');
    };

    var endLoading = () => {
      if (!time) {
        hideLoader();
      } else {
        if (Date.now() - time > 500) {
          time = null;
          hideLoader();
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    loaderEl.addEventListener('click', endLoading);
  </script>
<div id="copy-tooltip"></div>
<div id="heatmap-tooltip"></div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav" aria-label="Primary navigation">
        <a class="main-nav-link-wrap" href="/">
            <div class="main-nav-icon icon rotate">
                &#xe62b;
            </div>
          <span class="main-nav-link">首页</span>
        </span>
        <a class="main-nav-link-wrap" href="/archives">
            <div class="main-nav-icon icon rotate">
                &#xe62b;
            </div>
          <span class="main-nav-link">归档</span>
        </span>
        <a class="main-nav-link-wrap" href="/about">
            <div class="main-nav-icon icon rotate">
                &#xe62b;
            </div>
          <span class="main-nav-link">关于</span>
        </span>
        <a class="main-nav-link-wrap" href="/friend">
            <div class="main-nav-icon icon rotate">
                &#xe62b;
            </div>
          <span class="main-nav-link">友链</span>
        </span>
    <a id="main-nav-toggle" class="nav-icon" aria-label="Toggle navigation" role="button"></a>
  </nav>
  <nav id="sub-nav" aria-label="Secondary navigation">
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅" aria-label="RSS 订阅" target="_blank"></a>
  </nav>
</div>
<header id="header" aria-label="Site header">
    <picture></picture>
    <img  fetchpriority="high" src="https://image.acg.lol/file/2025/11/09/reimu-3.jpg" alt="接口隔离原则与合成复用原则在Spring中的应用">
  <div id="header-outer">
    <div id="header-title">
          <span id="logo">
            <h1 data-aos="slide-up">接口隔离原则与合成复用原则在Spring中的应用</h1>
          </span>
        <h2 id="subtitle-wrap" data-aos="slide-down">
        </h2>
    </div>
  </div>
</header>

        <div id="content" aria-label="Page content"  class="sidebar-right" >
          <aside id="sidebar" aria-label="Sidebar">
  <div class="sidebar-wrapper-container sticky">
  <div class="sidebar-wrapper">
    <div class="sidebar-wrap" data-aos="fade-up">
          <div class="sidebar-toc-sidebar"><h3 class="toc-title">文章目录</h3>
<div class="sidebar-toc-wrapper toc-div-class" >
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99-ISP"><span class="toc-number">1.</span> <span class="toc-text">接口隔离原则(ISP)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">1. 核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SpringBoot%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">2. SpringBoot中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%8E%A5%E5%8F%A3%E6%8B%86%E5%88%86%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 接口拆分示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Spring%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 Spring中的具体实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%BD%BF%E7%94%A8-Qualifier%E5%8C%BA%E5%88%86%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 使用@Qualifier区分接口实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SpringCloud%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">3. SpringCloud中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 微服务接口隔离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-API%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1%E9%9A%94%E7%A6%BB"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 API网关路由隔离</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.</span> <span class="toc-text">4. 最佳实践场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%A7%92%E8%89%B2%E5%9F%BA%E7%A1%80%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 角色基础接口设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 事件监听器接口隔离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 配置服务接口隔离</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BC%98%E5%8A%BF%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.</span> <span class="toc-text">5. 优势总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84ISP%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.6.</span> <span class="toc-text">6. 实际项目中的ISP实践建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%E5%8E%9F%E5%88%99-CRP"><span class="toc-number">2.</span> <span class="toc-text">合成复用原则(CRP)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5-1"><span class="toc-number">2.1.</span> <span class="toc-text">1. 核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SpringBoot%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="toc-number">2.2.</span> <span class="toc-text">2. SpringBoot中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%BB%84%E5%90%88%E6%9B%BF%E4%BB%A3%E7%BB%A7%E6%89%BF"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.1 组合替代继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Spring%E4%B8%AD%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%AE%9E%E7%8E%B0%E7%BB%84%E5%90%88"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2 Spring中的依赖注入实现组合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%8A%A8%E6%80%81%E7%BB%84%E5%90%88%E4%B8%8E%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3 动态组合与策略模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SpringCloud%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="toc-number">2.3.</span> <span class="toc-text">3. SpringCloud中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8A%9F%E8%83%BD%E7%9A%84%E7%BB%84%E5%90%88"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 微服务功能的组合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E7%BB%84%E5%90%88"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 配置管理的组合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%9C%BA%E6%99%AF-1"><span class="toc-number">2.4.</span> <span class="toc-text">4. 最佳实践场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%84%E5%90%88%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1 模板方法模式的组合实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%84%E5%90%88%E5%BA%94%E7%94%A8"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2 装饰器模式的组合应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BC%98%E5%8A%BF%E6%80%BB%E7%BB%93-1"><span class="toc-number">2.5.</span> <span class="toc-text">5. 优势总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.6.</span> <span class="toc-text">6. 实践建议</span></a></li></ol></li></ol>
</div>
</div>
          <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Zero02" class="lazyload">
  <div class="sidebar-author-name">Zero02</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">15</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">8</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social" >
</div>
<div class="sidebar-menu">
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">首页</div>
      </div>
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">归档</div>
      </div>
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">关于</div>
      </div>
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">友链</div>
      </div>
</div>
</div>
          <div class="sidebar-btn-wrapper" style="position:static">
            <div class="sidebar-toc-btn current"></div>
            <div class="sidebar-common-btn"></div>
          </div>
    </div>
  </div>
  <div class="sidebar-widget">
  </div>
  </div>
</aside>

          <section id="main" aria-label="Main content"><article id="post-接口隔离&amp;合成复用 2026_2_3" class="h-entry article" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <span class="article-date-link icon-calendar" data-aos="zoom-in">
    <time datetime="2026-02-03T01:30:00.000Z" itemprop="datePublished">2026-02-03</time>
    <time style="display: none;" id="post-update-time">2026-02-03</time>
  </span>
</div>

    </div>
    
    <div class="hr-line"></div>
    
    <div class="e-content article-entry" itemprop="articleBody">
        <h1 id="接口隔离原则-ISP"><a href="#接口隔离原则-ISP" class="headerlink" title="接口隔离原则(ISP)"></a>接口隔离原则(ISP)</h1><p>接口隔离原则(Interface Segregation Principle, ISP)是SOLID原则中的第五个原则，它规定：客户端不应该被迫依赖于它不使用的方法。多个特定客户端接口要好于一个通用接口。</p>
<h2 id="1-核心概念"><a href="#1-核心概念" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>接口隔离原则的关键思想：</p>
<ul>
<li><strong>不要强迫客户端依赖它们不需要的方法</strong></li>
<li><strong>将臃肿的接口拆分为更小、更具体的接口</strong></li>
<li><strong>让接口的职责单一化</strong></li>
<li><strong>避免”胖接口”(Fat Interface)</strong></li>
</ul>
<h2 id="2-SpringBoot中的应用方式"><a href="#2-SpringBoot中的应用方式" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-接口拆分示例"><a href="#2-1-接口拆分示例" class="headerlink" title="2.1 接口拆分示例"></a>2.1 接口拆分示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反ISP的反例 - 臃肿的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// 用户基本操作</span></span><br><span class="line">    UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getAllUsers</span><span class="params">()</span>;</span><br><span class="line">    UserDTO <span class="title function_">createUser</span><span class="params">(UserCreateRequest request)</span>;</span><br><span class="line">    UserDTO <span class="title function_">updateUser</span><span class="params">(Long id, UserUpdateRequest request)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 管理员操作</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">resetPassword</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getLockedUsers</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 认证授权操作</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(Long userId, String permission)</span>;</span><br><span class="line">    Set&lt;String&gt; <span class="title function_">getUserPermissions</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">assignRole</span><span class="params">(Long userId, String role)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合ISP的正确设计 - 拆分接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BasicUserService</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getAllUsers</span><span class="params">()</span>;</span><br><span class="line">    UserDTO <span class="title function_">createUser</span><span class="params">(UserCreateRequest request)</span>;</span><br><span class="line">    UserDTO <span class="title function_">updateUser</span><span class="params">(Long id, UserUpdateRequest request)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdminUserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">resetPassword</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getLockedUsers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorizationService</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(Long userId, String permission)</span>;</span><br><span class="line">    Set&lt;String&gt; <span class="title function_">getUserPermissions</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">assignRole</span><span class="params">(Long userId, String role)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Spring中的具体实现"><a href="#2-2-Spring中的具体实现" class="headerlink" title="2.2 Spring中的具体实现"></a>2.2 Spring中的具体实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实现类按需实现接口</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BasicUserService</span>, AdminUserService, AuthorizationService &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取用户逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserDTO&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取所有用户逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现所有接口的方法...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通控制器只需要基础服务</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BasicUserService basicUserService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(BasicUserService basicUserService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.basicUserService = basicUserService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserDTO&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(basicUserService.getUserById(id));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理员控制器需要管理功能</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/admin/users&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminUserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BasicUserService basicUserService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AdminUserService adminUserService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AdminUserController</span><span class="params">(BasicUserService basicUserService, </span></span><br><span class="line"><span class="params">                              AdminUserService adminUserService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.basicUserService = basicUserService;</span><br><span class="line">        <span class="built_in">this</span>.adminUserService = adminUserService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;userId&#125;/lock&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">lockUser</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span> &#123;</span><br><span class="line">        adminUserService.lockUser(userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-使用-Qualifier区分接口实现"><a href="#2-3-使用-Qualifier区分接口实现" class="headerlink" title="2.3 使用@Qualifier区分接口实现"></a>2.3 使用@Qualifier区分接口实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 专门的管理员服务实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;adminUserService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminOnlyUserService</span> <span class="keyword">implements</span> <span class="title class_">AdminUserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">resetPassword</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 管理员专用的密码重置逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只实现AdminUserService接口的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 认证服务实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;authService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthBasedAuthorizationService</span> <span class="keyword">implements</span> <span class="title class_">AuthorizationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(Long userId, String permission)</span> &#123;</span><br><span class="line">        <span class="comment">// 基于权限的验证逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只实现AuthorizationService接口的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-SpringCloud中的应用方式"><a href="#3-SpringCloud中的应用方式" class="headerlink" title="3. SpringCloud中的应用方式"></a>3. SpringCloud中的应用方式</h2><h3 id="3-1-微服务接口隔离"><a href="#3-1-微服务接口隔离" class="headerlink" title="3.1 微服务接口隔离"></a>3.1 微服务接口隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单服务的细粒度接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderQueryService</span> &#123;</span><br><span class="line">    OrderDTO <span class="title function_">getOrderById</span><span class="params">(Long orderId)</span>;</span><br><span class="line">    List&lt;OrderDTO&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(Long userId)</span>;</span><br><span class="line">    Page&lt;OrderDTO&gt; <span class="title function_">getOrdersWithPagination</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderCommandService</span> &#123;</span><br><span class="line">    OrderDTO <span class="title function_">createOrder</span><span class="params">(OrderCreateCommand command)</span>;</span><br><span class="line">    OrderDTO <span class="title function_">updateOrderStatus</span><span class="params">(Long orderId, OrderStatus status)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">cancelOrder</span><span class="params">(Long orderId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderPaymentService</span> &#123;</span><br><span class="line">    PaymentResult <span class="title function_">processPayment</span><span class="params">(Long orderId, PaymentRequest paymentRequest)</span>;</span><br><span class="line">    RefundResult <span class="title function_">processRefund</span><span class="params">(Long orderId, RefundRequest refundRequest)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Feign客户端接口也遵循ISP</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderQueryClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/orders/&#123;id&#125;&quot;)</span></span><br><span class="line">    OrderDTO <span class="title function_">getOrderById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;userId&#125;/orders&quot;)</span></span><br><span class="line">    List&lt;OrderDTO&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderCommandClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    OrderDTO <span class="title function_">createOrder</span><span class="params">(<span class="meta">@RequestBody</span> OrderCreateCommand command)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;orderId&#125;/status&quot;)</span></span><br><span class="line">    OrderDTO <span class="title function_">updateOrderStatus</span><span class="params">(<span class="meta">@PathVariable</span> Long orderId, </span></span><br><span class="line"><span class="params">                               <span class="meta">@RequestParam</span> OrderStatus status)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-API网关路由隔离"><a href="#3-2-API网关路由隔离" class="headerlink" title="3.2 API网关路由隔离"></a>3.2 API网关路由隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># application.yml</span><br><span class="line">spring:</span><br><span class="line">cloud:</span><br><span class="line">gateway:</span><br><span class="line">routes:</span><br><span class="line"># 查询路由 - 只读权限</span><br><span class="line">- id: order-query</span><br><span class="line">uri: lb:<span class="comment">//order-service</span></span><br><span class="line">predicates:</span><br><span class="line">- Path=/api/orders<span class="comment">/**</span></span><br><span class="line"><span class="comment">filters:</span></span><br><span class="line"><span class="comment">- name: RequestRateLimiter</span></span><br><span class="line"><span class="comment">args:</span></span><br><span class="line"><span class="comment">redis-rate-limiter.replenishRate: 100</span></span><br><span class="line"><span class="comment">redis-rate-limiter.burstCapacity: 200</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 命令路由 - 需要更高权限</span></span><br><span class="line"><span class="comment">- id: order-command</span></span><br><span class="line"><span class="comment">uri: lb://order-service</span></span><br><span class="line"><span class="comment">predicates:</span></span><br><span class="line"><span class="comment">- Path=/api/orders/command/**</span></span><br><span class="line"><span class="comment">filters:</span></span><br><span class="line"><span class="comment">- name: AuthFilter</span></span><br><span class="line"><span class="comment">args:</span></span><br><span class="line"><span class="comment">required-role: ADMIN</span></span><br></pre></td></tr></table></figure>

<h2 id="4-最佳实践场景"><a href="#4-最佳实践场景" class="headerlink" title="4. 最佳实践场景"></a>4. 最佳实践场景</h2><h3 id="4-1-角色基础接口设计"><a href="#4-1-角色基础接口设计" class="headerlink" title="4.1 角色基础接口设计"></a>4.1 角色基础接口设计</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础读写接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ReadableRepository</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    Optional&lt;T&gt; <span class="title function_">findById</span><span class="params">(ID id)</span>;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsById</span><span class="params">(ID id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WritableRepository</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    T <span class="title function_">save</span><span class="params">(T entity)</span>;</span><br><span class="line">    &lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; List&lt;S&gt; <span class="title function_">saveAll</span><span class="params">(Iterable&lt;S&gt; entities)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(ID id)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(T entity)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CrudRepository</span>&lt;T, ID&gt; <span class="keyword">extends</span> <span class="title class_">ReadableRepository</span>&lt;T, ID&gt;, WritableRepository&lt;T, ID&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务特定的仓库接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuditableRepository</span>&lt;T, ID&gt; <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">findByCreatedDateAfter</span><span class="params">(LocalDateTime date)</span>;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">findByLastModifiedBy</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现按需扩展</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepositoryImpl</span> <span class="keyword">implements</span> <span class="title class_">CrudRepository</span>&lt;User, Long&gt;, AuditableRepository&lt;User, Long&gt; &#123;</span><br><span class="line">    <span class="comment">// 实现所有必要的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-事件监听器接口隔离"><a href="#4-2-事件监听器接口隔离" class="headerlink" title="4.2 事件监听器接口隔离"></a>4.2 事件监听器接口隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不同类型的事件监听器接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderEventListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onOrderCreated</span><span class="params">(OrderCreatedEvent event)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onOrderCancelled</span><span class="params">(OrderCancelledEvent event)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentEventListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onPaymentSuccess</span><span class="params">(PaymentSuccessEvent event)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onPaymentFailed</span><span class="params">(PaymentFailedEvent event)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InventoryEventListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onStockLow</span><span class="params">(StockLowEvent event)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onStockReplenished</span><span class="params">(StockReplenishedEvent event)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合监听器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessEventListener</span> <span class="keyword">implements</span> </span><br><span class="line">    <span class="title class_">OrderEventListener</span>, PaymentEventListener, InventoryEventListener &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOrderCreated</span><span class="params">(OrderCreatedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理订单创建事件</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPaymentSuccess</span><span class="params">(PaymentSuccessEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理支付成功事件</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现所有接口方法...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 专门的库存监听器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryOnlyListener</span> <span class="keyword">implements</span> <span class="title class_">InventoryEventListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStockLow</span><span class="params">(StockLowEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 只关心库存不足事件</span></span><br><span class="line">        sendRestockAlert(event.getProductId());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStockReplenished</span><span class="params">(StockReplenishedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 只关心库存补充事件</span></span><br><span class="line">        updateInventoryDashboard(event.getProductId());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendRestockAlert</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="comment">// 发送补货提醒</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateInventoryDashboard</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="comment">// 更新仪表板</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-配置服务接口隔离"><a href="#4-3-配置服务接口隔离" class="headerlink" title="4.3 配置服务接口隔离"></a>4.3 配置服务接口隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置读取接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigReader</span> &#123;</span><br><span class="line">    String <span class="title function_">getString</span><span class="params">(String key)</span>;</span><br><span class="line">    Integer <span class="title function_">getInt</span><span class="params">(String key)</span>;</span><br><span class="line">    Boolean <span class="title function_">getBoolean</span><span class="params">(String key)</span>;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">getValue</span><span class="params">(String key, Class&lt;T&gt; type)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置写入接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigWriter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setString</span><span class="params">(String key, String value)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setInt</span><span class="params">(String key, Integer value)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBoolean</span><span class="params">(String key, Boolean value)</span>;</span><br><span class="line">    &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String key, T value)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置监听接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigWatcher</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addListener</span><span class="params">(String keyPattern, ConfigChangeListener listener)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeListener</span><span class="params">(String keyPattern)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合配置服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigService</span> <span class="keyword">extends</span> <span class="title class_">ConfigReader</span>, ConfigWriter, ConfigWatcher &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只读配置服务（用于前端等场景）</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;readOnlyConfigService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadOnlyConfigService</span> <span class="keyword">implements</span> <span class="title class_">ConfigReader</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConfigService fullConfigService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getString</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fullConfigService.getString(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只实现读取方法，编译时保证不会调用写入方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-优势总结"><a href="#5-优势总结" class="headerlink" title="5. 优势总结"></a>5. 优势总结</h2><ol>
<li><strong>减少依赖</strong>：客户端只依赖需要的方法，减少不必要的耦合</li>
<li><strong>提高灵活性</strong>：可以独立修改和扩展各个接口</li>
<li><strong>增强可维护性</strong>：接口职责单一，易于理解和维护</li>
<li><strong>改善编译时检查</strong>：未实现的方法会在编译时报错</li>
<li><strong>更好的封装</strong>：隐藏不需要暴露的功能</li>
</ol>
<h2 id="6-实际项目中的ISP实践建议"><a href="#6-实际项目中的ISP实践建议" class="headerlink" title="6. 实际项目中的ISP实践建议"></a>6. 实际项目中的ISP实践建议</h2><ol>
<li><strong>按功能域拆分大接口</strong></li>
<li><strong>使用Spring的@Qualifier区分不同实现</strong></li>
<li><strong>在微服务中按业务能力划分API</strong></li>
<li><strong>利用Java 8的默认方法适度扩展接口</strong></li>
<li><strong>定期重构检查接口的”肥胖度”</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用默认方法的适度扩展</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdvancedUserService</span> <span class="keyword">extends</span> <span class="title class_">BasicUserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">default</span> UserDTO <span class="title function_">updateUser</span><span class="params">(Long id, UserUpdateRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 提供默认的更新逻辑，具体实现可以覆盖</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">existing</span> <span class="operator">=</span> getUserById(id);</span><br><span class="line">        <span class="comment">// 合并更新逻辑</span></span><br><span class="line">        <span class="keyword">return</span> mergeAndSave(existing, request);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserDTO <span class="title function_">mergeAndSave</span><span class="params">(UserDTO existing, UserUpdateRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 默认合并保存逻辑</span></span><br><span class="line">        <span class="keyword">return</span> existing;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SpringBoot&#x2F;SpringCloud中应用接口隔离原则，可以构建出更加模块化、可维护的微服务架构，每个服务、组件只暴露必要的接口，降低系统复杂度。</p>
<h1 id="合成复用原则-CRP"><a href="#合成复用原则-CRP" class="headerlink" title="合成复用原则(CRP)"></a>合成复用原则(CRP)</h1><p>合成复用原则(Composite Reuse Principle, CRP)，也称为组合&#x2F;聚合复用原则，它规定：尽量使用对象组合，而不是继承来达到复用的目的。</p>
<h2 id="1-核心概念-1"><a href="#1-核心概念-1" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>合成复用原则的关键思想：</p>
<ul>
<li><strong>优先使用组合(Composition)和聚合(Aggregation)而非继承(Inheritance)</strong></li>
<li><strong>组合表示”has-a”关系，继承表示”is-a”关系</strong></li>
<li><strong>通过依赖注入实现组合关系</strong></li>
<li><strong>降低类之间的耦合度，提高系统的灵活性</strong></li>
</ul>
<h2 id="2-SpringBoot中的应用方式-1"><a href="#2-SpringBoot中的应用方式-1" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-组合替代继承"><a href="#2-1-组合替代继承" class="headerlink" title="2.1 组合替代继承"></a>2.1 组合替代继承</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反CRP的反例 - 使用继承导致的问题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        validate(order);</span><br><span class="line">        calculateTotal(order);</span><br><span class="line">        save(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(Order order)</span> &#123; <span class="comment">/* 基础验证 */</span> &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">calculateTotal</span><span class="params">(Order order)</span> &#123; <span class="comment">/* 基础计算 */</span> &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Order order)</span> &#123; <span class="comment">/* 基础保存 */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特殊订单处理 - 继承导致的问题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GroupOrderProcessor</span> <span class="keyword">extends</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">calculateTotal</span><span class="params">(GroupOrder order)</span> &#123;</span><br><span class="line">        <span class="comment">// 需要重新实现大部分逻辑，只是修改了计算方式</span></span><br><span class="line">        <span class="comment">// 违反了&quot;is-a&quot;关系，GroupOrderProcessor并不是一种OrderProcessor</span></span><br><span class="line">        <span class="built_in">super</span>.validate(order);</span><br><span class="line">        <span class="comment">// 团购特有的计算逻辑</span></span><br><span class="line">        calculateGroupDiscount(order);</span><br><span class="line">        <span class="built_in">super</span>.save(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">calculateGroupDiscount</span><span class="params">(GroupOrder order)</span> &#123;</span><br><span class="line">        <span class="comment">// 团购折扣计算</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合CRP的正确设计 - 使用组合</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator validator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator calculator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Saver saver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderProcessor</span><span class="params">(Validator validator, Calculator calculator, Saver saver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.validator = validator;</span><br><span class="line">        <span class="built_in">this</span>.calculator = calculator;</span><br><span class="line">        <span class="built_in">this</span>.saver = saver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        validator.validate(order);</span><br><span class="line">        calculator.calculateTotal(order);</span><br><span class="line">        saver.save(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过组合实现不同策略</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StandardOrderProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator standardValidator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator standardCalculator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Saver standardSaver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StandardOrderProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.standardValidator = <span class="keyword">new</span> <span class="title class_">StandardValidator</span>();</span><br><span class="line">        <span class="built_in">this</span>.standardCalculator = <span class="keyword">new</span> <span class="title class_">StandardCalculator</span>();</span><br><span class="line">        <span class="built_in">this</span>.standardSaver = <span class="keyword">new</span> <span class="title class_">DatabaseSaver</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 或者通过依赖注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StandardOrderProcessor</span><span class="params">(Validator validator, Calculator calculator, Saver saver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.standardValidator = validator;</span><br><span class="line">        <span class="built_in">this</span>.standardCalculator = calculator;</span><br><span class="line">        <span class="built_in">this</span>.standardSaver = saver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupOrderProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator groupValidator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator groupCalculator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Saver groupSaver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GroupOrderProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.groupValidator = <span class="keyword">new</span> <span class="title class_">GroupValidator</span>();</span><br><span class="line">        <span class="built_in">this</span>.groupCalculator = <span class="keyword">new</span> <span class="title class_">GroupCalculator</span>();</span><br><span class="line">        <span class="built_in">this</span>.groupSaver = <span class="keyword">new</span> <span class="title class_">DatabaseSaver</span>(); <span class="comment">// 可以复用保存逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Spring中的依赖注入实现组合"><a href="#2-2-Spring中的依赖注入实现组合" class="headerlink" title="2.2 Spring中的依赖注入实现组合"></a>2.2 Spring中的依赖注入实现组合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义可组合的组件接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, Object value)</span>;</span><br><span class="line">    Object <span class="title function_">get</span><span class="params">(String key)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(String metric, <span class="type">long</span> value)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File Log: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Redis Cache PUT: &quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Redis Cache GET: &quot;</span> + key);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrometheusMetrics</span> <span class="keyword">implements</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(String metric, <span class="type">long</span> value)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Metrics: &quot;</span> + metric + <span class="string">&quot; = &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务服务通过组合使用这些组件</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsCollector metrics;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过构造器注入所有需要的组件</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository, </span></span><br><span class="line"><span class="params">                       Logger logger, </span></span><br><span class="line"><span class="params">                       Cache cache,</span></span><br><span class="line"><span class="params">                       MetricsCollector metrics)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">        <span class="built_in">this</span>.logger = logger;</span><br><span class="line">        <span class="built_in">this</span>.cache = cache;</span><br><span class="line">        <span class="built_in">this</span>.metrics = metrics;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 记录指标</span></span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.start&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 尝试从缓存获取</span></span><br><span class="line">            <span class="type">UserDTO</span> <span class="variable">cached</span> <span class="operator">=</span> (UserDTO) cache.get(<span class="string">&quot;user:&quot;</span> + id);</span><br><span class="line">            <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">                metrics.record(<span class="string">&quot;user.get.cache.hit&quot;</span>, <span class="number">1</span>);</span><br><span class="line">                logger.log(<span class="string">&quot;Cache hit for user: &quot;</span> + id);</span><br><span class="line">                <span class="keyword">return</span> cached;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从数据库获取</span></span><br><span class="line">            <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;User not found&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 存入缓存</span></span><br><span class="line">            cache.put(<span class="string">&quot;user:&quot;</span> + id, user);</span><br><span class="line"></span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.success&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            logger.log(<span class="string">&quot;Retrieved user: &quot;</span> + id);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.error&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            logger.log(<span class="string">&quot;Error retrieving user: &quot;</span> + id + <span class="string">&quot;, error: &quot;</span> + e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.duration&quot;</span>, duration);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-动态组合与策略模式"><a href="#2-3-动态组合与策略模式" class="headerlink" title="2.3 动态组合与策略模式"></a>2.3 动态组合与策略模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付策略接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    PaymentResult <span class="title function_">pay</span><span class="params">(PaymentRequest request)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(PaymentType type)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体支付策略</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">pay</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Alipay payment processing...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResult</span>(<span class="literal">true</span>, <span class="string">&quot;Alipay success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(PaymentType type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> PaymentType.ALIPAY == type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">pay</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Wechat Pay processing...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResult</span>(<span class="literal">true</span>, <span class="string">&quot;Wechat Pay success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(PaymentType type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> PaymentType.WECHAT_PAY == type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支付服务通过组合多个策略</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;PaymentStrategy&gt; paymentStrategies;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Spring会自动注入所有PaymentStrategy实现</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentService</span><span class="params">(List&lt;PaymentStrategy&gt; paymentStrategies)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategies = paymentStrategies;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">processPayment</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 根据支付类型选择合适的策略</span></span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> paymentStrategies.stream()</span><br><span class="line">        .filter(s -&gt; s.supports(request.getPaymentType()))</span><br><span class="line">        .findFirst()</span><br><span class="line">        .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UnsupportedPaymentTypeException</span>(<span class="string">&quot;Unsupported payment type&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> strategy.pay(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态添加新的支付策略</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPaymentStrategy</span><span class="params">(PaymentStrategy strategy)</span> &#123;</span><br><span class="line">        paymentStrategies.add(strategy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-SpringCloud中的应用方式-1"><a href="#3-SpringCloud中的应用方式-1" class="headerlink" title="3. SpringCloud中的应用方式"></a>3. SpringCloud中的应用方式</h2><h3 id="3-1-微服务功能的组合"><a href="#3-1-微服务功能的组合" class="headerlink" title="3.1 微服务功能的组合"></a>3.1 微服务功能的组合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义微服务的能力接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CircuitBreaker</span> &#123;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">execute</span><span class="params">(Supplier&lt;T&gt; supplier, Supplier&lt;T&gt; fallback)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RateLimiter</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">allowRequest</span><span class="params">(String key, <span class="type">int</span> limit)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RetryPolicy</span> &#123;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">execute</span><span class="params">(Supplier&lt;T&gt; supplier)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line">    ServiceInstance <span class="title function_">choose</span><span class="params">(String serviceId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Resilience4jCircuitBreaker</span> <span class="keyword">implements</span> <span class="title class_">CircuitBreaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">CircuitBreakerRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> CircuitBreakerRegistry.ofDefaults();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(Supplier&lt;T&gt; supplier, Supplier&lt;T&gt; fallback)</span> &#123;</span><br><span class="line">        <span class="type">CircuitBreaker</span> <span class="variable">cb</span> <span class="operator">=</span> registry.circuitBreaker(<span class="string">&quot;default&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cb.executeSupplier(supplier);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisRateLimiter</span> <span class="keyword">implements</span> <span class="title class_">RateLimiter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">allowRequest</span><span class="params">(String key, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="comment">// Redis限流逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微服务客户端组合多种能力</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResilientServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RateLimiter rateLimiter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RetryPolicy retryPolicy;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoadBalancer loadBalancer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResilientServiceClient</span><span class="params">(RestTemplate restTemplate,</span></span><br><span class="line"><span class="params">                                  CircuitBreaker circuitBreaker,</span></span><br><span class="line"><span class="params">                                  RateLimiter rateLimiter,</span></span><br><span class="line"><span class="params">                                  RetryPolicy retryPolicy,</span></span><br><span class="line"><span class="params">                                  LoadBalancer loadBalancer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplate;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreaker = circuitBreaker;</span><br><span class="line">        <span class="built_in">this</span>.rateLimiter = rateLimiter;</span><br><span class="line">        <span class="built_in">this</span>.retryPolicy = retryPolicy;</span><br><span class="line">        <span class="built_in">this</span>.loadBalancer = loadBalancer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">callService</span><span class="params">(String serviceName, String endpoint, Class&lt;T&gt; responseType)</span> &#123;</span><br><span class="line">        <span class="comment">// 组合使用各种能力</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> serviceName + <span class="string">&quot;:&quot;</span> + endpoint;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!rateLimiter.allowRequest(key, <span class="number">100</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RateLimitExceededException</span>(<span class="string">&quot;Rate limit exceeded&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> circuitBreaker.execute(</span><br><span class="line">            () -&gt; retryPolicy.execute(() -&gt; &#123;</span><br><span class="line">                <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> loadBalancer.choose(serviceName);</span><br><span class="line">                <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> buildUrl(instance, endpoint);</span><br><span class="line">                <span class="keyword">return</span> restTemplate.getForObject(url, responseType);</span><br><span class="line">            &#125;),</span><br><span class="line">            () -&gt; getFallbackResponse(responseType)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">buildUrl</span><span class="params">(ServiceInstance instance, String endpoint)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http://&quot;</span> + instance.getHost() + <span class="string">&quot;:&quot;</span> + instance.getPort() + endpoint;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; T <span class="title function_">getFallbackResponse</span><span class="params">(Class&lt;T&gt; responseType)</span> &#123;</span><br><span class="line">        <span class="comment">// 返回兜底响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-配置管理的组合"><a href="#3-2-配置管理的组合" class="headerlink" title="3.2 配置管理的组合"></a>3.2 配置管理的组合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置源接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    String <span class="title function_">getValue</span><span class="params">(String key)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体配置源</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnvironmentConfigSource</span> <span class="keyword">implements</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> System.getenv(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> System.getenv(key) != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConfigSource</span> <span class="keyword">implements</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 从数据库获取配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 检查数据库中是否存在配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteConfigSource</span> <span class="keyword">implements</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 从远程配置中心获取</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 检查远程配置中心</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置管理器组合多个配置源</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompositeConfigService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ConfigSource&gt; configSources;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CompositeConfigService</span><span class="params">(List&lt;ConfigSource&gt; configSources)</span> &#123;</span><br><span class="line">        <span class="comment">// 按优先级排序：环境变量 &gt; 数据库 &gt; 远程配置</span></span><br><span class="line">        <span class="built_in">this</span>.configSources = configSources.stream()</span><br><span class="line">        .sorted((a, b) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (a <span class="keyword">instanceof</span> EnvironmentConfigSource) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (b <span class="keyword">instanceof</span> EnvironmentConfigSource) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (a <span class="keyword">instanceof</span> DatabaseConfigSource) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (b <span class="keyword">instanceof</span> DatabaseConfigSource) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfig</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ConfigSource source : configSources) &#123;</span><br><span class="line">            <span class="keyword">if</span> (source.containsKey(key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> source.getValue(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigNotFoundException</span>(<span class="string">&quot;Config not found: &quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态添加新的配置源</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addConfigSource</span><span class="params">(ConfigSource configSource, <span class="type">int</span> priority)</span> &#123;</span><br><span class="line">        configSources.add(priority, configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-最佳实践场景-1"><a href="#4-最佳实践场景-1" class="headerlink" title="4. 最佳实践场景"></a>4. 最佳实践场景</h2><h3 id="4-1-模板方法模式的组合实现"><a href="#4-1-模板方法模式的组合实现" class="headerlink" title="4.1 模板方法模式的组合实现"></a>4.1 模板方法模式的组合实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用组合替代模板方法模式中的继承</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Step</span>&lt;T, R&gt; &#123;</span><br><span class="line">    R <span class="title function_">execute</span><span class="params">(T input)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体步骤</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidationStep</span> <span class="keyword">implements</span> <span class="title class_">Step</span>&lt;Order, ValidationResult&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ValidationResult <span class="title function_">execute</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 验证逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ValidationResult</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PricingStep</span> <span class="keyword">implements</span> <span class="title class_">Step</span>&lt;Order, PricingResult&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PricingResult <span class="title function_">execute</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 定价逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PricingResult</span>(BigDecimal.valueOf(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersistenceStep</span> <span class="keyword">implements</span> <span class="title class_">Step</span>&lt;Order, Void&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Void <span class="title function_">execute</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 持久化逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 流程编排器组合各个步骤</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderProcessingPipeline</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Step&lt;?, ?&gt;&gt; steps;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderProcessingPipeline</span><span class="params">(List&lt;Step&lt;?, ?&gt;&gt; steps)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.steps = steps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> OrderResult <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">context</span> <span class="operator">=</span> order;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Step step : steps) &#123;</span><br><span class="line">            <span class="keyword">if</span> (step <span class="keyword">instanceof</span> Step) &#123;</span><br><span class="line">                context = ((Step&lt;Order, ?&gt;) step).execute((Order) context);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 如果某步失败，可以中断流程</span></span><br><span class="line">                <span class="keyword">if</span> (context <span class="keyword">instanceof</span> ValidationResult &amp;&amp; !((ValidationResult) context).isValid()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> OrderResult.failure(<span class="string">&quot;Validation failed&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> OrderResult.success((Order) context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态添加步骤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStep</span><span class="params">(Step&lt;?, ?&gt; step)</span> &#123;</span><br><span class="line">        steps.add(step);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-装饰器模式的组合应用"><a href="#4-2-装饰器模式的组合应用" class="headerlink" title="4.2 装饰器模式的组合应用"></a>4.2 装饰器模式的组合应用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line">    String <span class="title function_">fetchData</span><span class="params">(String key)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicDataService</span> <span class="keyword">implements</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Basic data for: &quot;</span> + key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器 - 添加缓存功能</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachingDataService</span> <span class="keyword">implements</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataService delegate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache cache;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CachingDataService</span><span class="params">(DataService delegate, Cache cache)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">        <span class="built_in">this</span>.cache = cache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheKey</span> <span class="operator">=</span> <span class="string">&quot;data:&quot;</span> + key;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cached</span> <span class="operator">=</span> (String) cache.get(cacheKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> cached;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> delegate.fetchData(key);</span><br><span class="line">        cache.put(cacheKey, data);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器 - 添加日志功能</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingDataService</span> <span class="keyword">implements</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataService delegate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggingDataService</span><span class="params">(DataService delegate, Logger logger)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">        <span class="built_in">this</span>.logger = logger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        logger.log(<span class="string">&quot;Fetching data for key: &quot;</span> + key);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> delegate.fetchData(key);</span><br><span class="line">            logger.log(<span class="string">&quot;Successfully fetched data for key: &quot;</span> + key);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">            logger.log(<span class="string">&quot;Data fetch took: &quot;</span> + duration + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用组合的装饰器链</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataServiceFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BasicDataService basicService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Cache cache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Logger logger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> DataService <span class="title function_">createDataService</span><span class="params">(<span class="type">boolean</span> enableCaching, <span class="type">boolean</span> enableLogging)</span> &#123;</span><br><span class="line">        <span class="type">DataService</span> <span class="variable">service</span> <span class="operator">=</span> basicService;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (enableCaching) &#123;</span><br><span class="line">            service = <span class="keyword">new</span> <span class="title class_">CachingDataService</span>(service, cache);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (enableLogging) &#123;</span><br><span class="line">            service = <span class="keyword">new</span> <span class="title class_">LoggingDataService</span>(service, logger);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-优势总结-1"><a href="#5-优势总结-1" class="headerlink" title="5. 优势总结"></a>5. 优势总结</h2><ol>
<li><strong>灵活性</strong>：可以在运行时动态组合不同的功能</li>
<li><strong>松耦合</strong>：组件之间通过接口交互，不直接依赖具体实现</li>
<li><strong>可测试性</strong>：容易模拟和替换组件进行测试</li>
<li><strong>可维护性</strong>：修改一个组件不会影响其他组件</li>
<li><strong>符合开闭原则</strong>：新增功能通过添加新组件而非修改现有代码</li>
<li><strong>避免继承的缺点</strong>：避免菱形继承、脆弱基类等问题</li>
</ol>
<h2 id="6-实践建议"><a href="#6-实践建议" class="headerlink" title="6. 实践建议"></a>6. 实践建议</h2><ol>
<li><strong>识别”has-a”关系时使用组合而非继承</strong></li>
<li><strong>通过Spring的依赖注入管理组件生命周期</strong></li>
<li><strong>使用接口定义组件契约</strong></li>
<li><strong>合理设计组件的粒度</strong></li>
<li><strong>利用Java 8+的函数式接口增强组合能力</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用函数式接口增强组合</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionalPipelineService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T, R&gt; Function&lt;T, R&gt; <span class="title function_">composeFunctions</span><span class="params">(List&lt;Function&lt;T, R&gt;&gt; functions)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> functions.stream()</span><br><span class="line">        .reduce(Function.identity(), Function::andThen);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exampleUsage</span><span class="params">()</span> &#123;</span><br><span class="line">        Function&lt;Order, Order&gt; pipeline = composeFunctions(Arrays.asList(</span><br><span class="line">            <span class="built_in">this</span>::validateOrder,</span><br><span class="line">            <span class="built_in">this</span>::calculatePrice,</span><br><span class="line">            <span class="built_in">this</span>::applyDiscounts,</span><br><span class="line">            <span class="built_in">this</span>::saveOrder</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="type">Order</span> <span class="variable">result</span> <span class="operator">=</span> pipeline.apply(<span class="keyword">new</span> <span class="title class_">Order</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">validateOrder</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">calculatePrice</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">applyDiscounts</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">saveOrder</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SpringBoot&#x2F;SpringCloud中，合成复用原则是构建灵活、可维护微服务架构的基石。Spring框架本身的依赖注入机制就是CRP的典型应用，通过组合各种Bean来构建复杂的应用功能。</p>

    </div>
    <footer class="article-footer">
        <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式" data-aos="zoom-in">设计模式</a>

      
    </footer>
  </div>
    <nav id="article-nav" aria-label="Article navigation" data-aos="fade-up">
      <div class="article-nav-link-wrap left">
          <img data-src="https://image.acg.lol/file/2025/11/09/reimu-1.jpg" data-sizes="auto" alt="SOLID原则与设计模式应用分类表" class="lazyload">
        <a href="/2026/02/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8%E5%88%86%E7%B1%BB%E8%A1%A8%202026_2_3/" aria-label="前一篇: SOLID原则与设计模式应用分类表" title="前一篇: SOLID原则与设计模式应用分类表"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
            SOLID原则与设计模式应用分类表
        </h3>
      </div>
    <div class="article-nav-link-wrap right">
        <img data-src="https://image.acg.lol/file/2025/11/09/reimu-2.jpg" data-sizes="auto" alt="迪米特原则在SpringBoot/SpringCloud中的应用" class="lazyload">
      <a href="/2026/02/03/%E8%BF%AA%E7%B1%B3%E7%89%B9%E5%8E%9F%E5%88%99%202026_2_3/" aria-label="后一篇: 迪米特原则在SpringBoot/SpringCloud中的应用"  title="后一篇: 迪米特原则在SpringBoot/SpringCloud中的应用"></a>
      <div class="article-nav-caption">后一篇</div>
      <h3 class="article-nav-title">
          迪米特原则在SpringBoot/SpringCloud中的应用
      </h3>
    </div>
  </nav>

</article>


</section>
        </div>
        <footer id="footer" aria-label="Site footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    <div>
      <span class="icon-copyright"></span>
        2020-2026
        <span class="footer-info-sep rotate"></span>
      Zero02
    </div>
      <div>
        基于&nbsp;<a href="https://hexo.io/" rel="noopener nofollow noreferrer" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="noopener nofollow noreferrer" target="_blank">Reimu</a>
      </div>
      <div>
        <span class="icon-brush"></span>
        28.8k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        02:18
      </div>
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">总访客量&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
  </div>
</footer>

          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav" aria-label="Mobile navigation">
  <div class="sidebar-wrap">
        <div class="sidebar-toc-sidebar"><h3 class="toc-title">文章目录</h3>
<div class="sidebar-toc-wrapper toc-div-class" >
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99-ISP"><span class="toc-number">1.</span> <span class="toc-text">接口隔离原则(ISP)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">1. 核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SpringBoot%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">2. SpringBoot中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%8E%A5%E5%8F%A3%E6%8B%86%E5%88%86%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 接口拆分示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Spring%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 Spring中的具体实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%BD%BF%E7%94%A8-Qualifier%E5%8C%BA%E5%88%86%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 使用@Qualifier区分接口实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SpringCloud%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">3. SpringCloud中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 微服务接口隔离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-API%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1%E9%9A%94%E7%A6%BB"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 API网关路由隔离</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.</span> <span class="toc-text">4. 最佳实践场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%A7%92%E8%89%B2%E5%9F%BA%E7%A1%80%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 角色基础接口设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 事件监听器接口隔离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 配置服务接口隔离</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BC%98%E5%8A%BF%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.</span> <span class="toc-text">5. 优势总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84ISP%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.6.</span> <span class="toc-text">6. 实际项目中的ISP实践建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%E5%8E%9F%E5%88%99-CRP"><span class="toc-number">2.</span> <span class="toc-text">合成复用原则(CRP)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5-1"><span class="toc-number">2.1.</span> <span class="toc-text">1. 核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SpringBoot%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="toc-number">2.2.</span> <span class="toc-text">2. SpringBoot中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%BB%84%E5%90%88%E6%9B%BF%E4%BB%A3%E7%BB%A7%E6%89%BF"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.1 组合替代继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Spring%E4%B8%AD%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%AE%9E%E7%8E%B0%E7%BB%84%E5%90%88"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2 Spring中的依赖注入实现组合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%8A%A8%E6%80%81%E7%BB%84%E5%90%88%E4%B8%8E%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3 动态组合与策略模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SpringCloud%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="toc-number">2.3.</span> <span class="toc-text">3. SpringCloud中的应用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8A%9F%E8%83%BD%E7%9A%84%E7%BB%84%E5%90%88"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 微服务功能的组合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E7%BB%84%E5%90%88"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 配置管理的组合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%9C%BA%E6%99%AF-1"><span class="toc-number">2.4.</span> <span class="toc-text">4. 最佳实践场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%84%E5%90%88%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1 模板方法模式的组合实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%84%E5%90%88%E5%BA%94%E7%94%A8"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2 装饰器模式的组合应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BC%98%E5%8A%BF%E6%80%BB%E7%BB%93-1"><span class="toc-number">2.5.</span> <span class="toc-text">5. 优势总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.6.</span> <span class="toc-text">6. 实践建议</span></a></li></ol></li></ol>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="Zero02" class="lazyload">
  <div class="sidebar-author-name">Zero02</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">15</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">8</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social" >
</div>
<div class="sidebar-menu">
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">首页</div>
      </div>
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">归档</div>
      </div>
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">关于</div>
      </div>
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
          <div class="sidebar-menu-icon icon rotate">
              &#xe62b;
          </div>
        <div class="sidebar-menu-link">友链</div>
      </div>
</div>
</div>
  </div>
      <div class="sidebar-btn-wrapper">
        <div class="sidebar-toc-btn current"></div>
        <div class="sidebar-common-btn"></div>
      </div>
</nav>

    </div>
      <div id="aplayer" theme="var(--color-link)"></div>
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin="anonymous"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script>




<script src="/js/script.js"></script>


  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>


<script src="/js/pjax_script.js" data-pjax></script>




  <script>
    var setupFirework = () => {
      if (!false || !window.matchMedia('(max-width: 768px)').matches) {
        window.firework && window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["var(--red-0)"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'));
      }
    }
  </script>
  
<script src="https://npm.webcache.cn/mouse-firework@0.2.0/dist/index.umd.js" integrity="sha384-qi9WggRt19tv8Vc7pCHW3ulMNLwrn515zaLEWZjl1px07vz8+pUoWX8n1rgq282T" crossorigin="anonymous" onload="setupFirework()" defer></script>


  
<script src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js" integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE&#x2F;jMSCxD+jAPU55x&#x2F;jj3wlf" crossorigin="anonymous"></script>

  
<script src="/js/pjax.js"></script>


  <script>
    var setupLive2d = () => {
      live2d.init("https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/", {themeTipsPath: ""});
    }
  </script>
  
<script src="https://fastly.jsdelivr.net/gh/D-Sketon/plugin-live2d/js/live2d-autoload.js" onload="setupLive2d()" async></script>




<div id="lazy-script">
  <div>
      
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "Zero02",
          title: "接口隔离原则与合成复用原则在Spring中的应用",
          url: "http://example.com/2026/02/03/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB&amp;%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%202026_2_3/",
          excerpt: "本文详细介绍了接口隔离原则(ISP)和合成复用原则(CRP)在SpringBoot和SpringCloud中的应用实践，包括接口拆分、微服务接口隔离、组合替代继承、依赖注入实现组合等最佳实践，帮助开发者构建模块化、可维护的系统架构。",
          description: "",
          stripContent: "接口隔离原则(ISP)接口隔离原则(Interface Segregation Principle, ISP)是SOLID原则中的第五个原则，它规定：客户端不应该被迫依赖于它不使用的方法。多个特定客户端接口要好于一个通用接口。 1. 核心概念接口隔离原则的关键思想：  不要强迫客户端依赖它们不需要的方法 将臃肿的接口拆分为更小、更具体的接口 让接口的职责单一化 避免”胖接口”(Fat Interface)  2. SpringBoot中的应用方式2.1 接口拆分示例123456789101112",
          date: "Tue Feb 03 2026 09:30:00 GMT+0800",
          updated: "Tue Feb 03 2026 20:27:42 GMT+0800",
          cover: "https://image.acg.lol/file/2025/11/09/reimu-3.jpg",
        };
      </script>
        
<script src="/js/insert_highlight.js" data-pjax></script>

      
<script src="/js/tabs.js" data-pjax defer></script>

      <script type="module" data-pjax>
        (async () => {
          const PhotoSwipeLightbox = (await safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js", "sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/")).default;
          const initPswp = (gallery, children) => {
            if (_$$(`${gallery} ${children}`).length > 0) {
              new PhotoSwipeLightbox({
                gallery,
                children,
                pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
              }).init();
            }
          }
          const pswp = () => {
            initPswp('.article-entry', 'a.article-gallery-item');
            initPswp('.article-gallery', 'a.article-gallery-item');
          }
          pswp();
        })();
      </script>
        


  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '1.12.0' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  


  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin="anonymous" async></script>


<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>


    <script>
    var setupAPlayer = () => {
      if (!false || !window.matchMedia('(max-width: 768px)').matches) {
        if (window.matchMedia('(max-width: 959px)').matches) {
          const aplayer = _$('#aplayer');
          if (aplayer) {
            const aside = aplayer.parentNode?.parentNode;
            if (aside?.tagName === 'ASIDE') {
              aplayer.removeAttribute('data-aos');
              aplayer.parentNode.removeChild(aplayer);
              document.body.appendChild(aplayer);
            }
          }
        }
        new APlayer({
          theme: "var(--color-link)",
          container: document.getElementById('aplayer'),
          audio: [{"name":"To the South","artist":"Kirara Magic","url":"/music/Kirara Magic.mp3","cover":"/music/Kirara Magic.jpg"}] || [],
          fixed: window.matchMedia('(max-width: 768px)').matches ? true : (true || false),
          autoplay: false || false,
          loop: 'all' || 'all',
          order: 'random' || 'list',
          preload: 'auto' || 'auto',
          volume: 0.6 || 0.7,
          mutex: true || true,
          listFolded: true || false,
          lrcType: 0 || 0,
        });
      }
    }
    </script>
  
<script src="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js" integrity="sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr+h5UfruuRL&#x2F;aORyw+5+HZoU6e" crossorigin="anonymous" defer onload="setupAPlayer()"></script>



  </body>
  </html>
