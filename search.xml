<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Malnutrition（营养不良）</title>
      <link href="/2026/02/09/Malnutrition/"/>
      <url>/2026/02/09/Malnutrition/</url>
      
        <content type="html"><![CDATA[<h1 id="Malnutrition（营养不良）"><a href="#Malnutrition（营养不良）" class="headerlink" title="Malnutrition（营养不良）"></a>Malnutrition（营养不良）</h1><blockquote><p>Malnutrition is a disorder of your food intake.</p><p>营养不良是一种与食物摄入有关的健康问题。</p></blockquote><p>It occurs when a person eats too little or too much, or has an unbalanced diet. In most cases, malnutrition means <strong>undernourishment</strong>, a lack of food and not enough calories. It is widespread in developing countries.</p><p class="chinese-paragraph">当一个人吃得过少或过多，或者饮食不均衡时，就会出现营养不良。在大多数情况下，营养不良指的是营养不足，即缺乏食物和热量摄入不够。这在发展中国家非常普遍。</p><p>On the other side, obesity occurs in developed countries where people eat too much. According to the World Health Organization, malnutrition is one of the greatest dangers to global health. Currently, about one billion people around the world do not have enough to eat.</p><p class="chinese-paragraph">另一方面，在发达国家，人们吃得过多，导致肥胖问题。根据世界卫生组织的数据，营养不良是对全球健康最大的威胁之一。目前，全世界约有十亿人没有足够的食物。</p><hr><h2 id="When-does-malnutrition-occur（营养不良何时发生）"><a href="#When-does-malnutrition-occur（营养不良何时发生）" class="headerlink" title="When does malnutrition occur（营养不良何时发生）"></a>When does malnutrition occur（营养不良何时发生）</h2><p>Malnutrition happens when people lack nutrients, vitamins and minerals. Not enough protein can have negative effects on a person’s growth and lead to physical problems. Vitamins are important for good health and the functioning of your body. A lack of them can cause major problems. Vitamin A deficiency can affect the brain and lead to a lower IQ rate. It can make children less active and not able to <strong>concentrate</strong>.</p><p class="chinese-paragraph">当人们缺乏营养素、维生素和矿物质时，就会发生营养不良。蛋白质摄入不足会对人的生长发育产生负面影响，并引发身体问题。维生素对维持身体健康和身体机能至关重要，缺乏会导致严重问题。例如，缺乏维生素A会影响大脑发育，降低智商水平，使孩子变得不活跃，难以集中注意力。</p><p>It affects the transmission of viruses, including HIV. It is especially widespread among women, children and older people. Children can be at risk even before birth because they depend on the mother’s nutrition.</p><p class="chinese-paragraph">它还会影响病毒传播，包括艾滋病毒。营养不良在妇女、儿童和老年人中尤为普遍。儿童甚至在出生前就可能面临风险，因为他们依赖母亲的营养供给。</p><p>One in ten people around the world is malnourished. Eating disorders account for 60 million deaths a year, including six million children. It is the main cause of child <strong>mortality</strong>.</p><p class="chinese-paragraph">全球每十个人中就有一人营养不良。饮食失调每年造成6000万人死亡，其中包括600万儿童。它是儿童死亡的主要原因。</p><hr><h2 id="Causes-of-malnutrition（营养不良的成因）"><a href="#Causes-of-malnutrition（营养不良的成因）" class="headerlink" title="Causes of malnutrition（营养不良的成因）"></a>Causes of malnutrition（营养不良的成因）</h2><p>One of the major causes of malnutrition in developing countries is <strong>famine</strong> and drought, which lead to the unavailability of food. Many countries in the Third World do not have enough land to grow food on or do not know how to use it. They do not have the money to afford imported food. In other countries, the government neglects the importance of agriculture and does not help farmers.</p><p class="chinese-paragraph">发展中国家营养不良的一个主要原因是饥荒和干旱，这导致食物匮乏。许多第三世界国家没有足够的土地种植粮食，或者不知道如何有效利用土地。他们也没有钱购买进口食品。还有一些国家的政府忽视农业的重要性，未能给予农民支持。</p><p>In places with a lack of or dirty drinking water, diseases like <strong>diarrhea</strong> lead to indigestion of food. Digestive disorders may also be a cause of malnutrition. People eat properly but their body cannot digest the food. In the Third World, many others do not <strong>breastfeed</strong> their children, thus weakening the immune system.</p><p class="chinese-paragraph">在饮用水缺乏或不干净的地区，腹泻等疾病会导致消化不良。消化系统疾病也可能是营养不良的原因之一。即使人们正常进食，但身体无法吸收营养。此外，在第三世界国家，许多母亲不母乳喂养孩子，从而削弱了孩子的免疫力。</p><hr><h2 id="Signs-of-malnutrition（营养不良的迹象）"><a href="#Signs-of-malnutrition（营养不良的迹象）" class="headerlink" title="Signs of malnutrition（营养不良的迹象）"></a>Signs of malnutrition（营养不良的迹象）</h2><ul><li>decaying teeth（蛀牙）</li><li>poor growth（发育不良）</li><li>weight loss（体重下降）</li><li>fragile bones that break easily（易骨折的脆弱骨骼）</li><li>weakening of muscles（肌肉无力）</li><li>diarrhea（腹泻）</li><li>dizziness（头晕）</li></ul><hr><h2 id="Depression-Obesity（抑郁与肥胖）"><a href="#Depression-Obesity（抑郁与肥胖）" class="headerlink" title="Depression &amp; Obesity（抑郁与肥胖）"></a>Depression &amp; Obesity（抑郁与肥胖）</h2><p>In developed countries, obesity is the most widespread form of malnutrition. Obese people consume more calories than they need. This may lead to diabetes and contribute to heart problems and high blood pressure. Too much fat in your diet can lead to high <strong>cholesterol</strong> levels.</p><p class="chinese-paragraph">在发达国家，肥胖是最普遍的营养不良形式。肥胖者摄入的热量超过身体所需，这可能导致糖尿病，并增加心脏病和高血压的风险。饮食中脂肪过多还可能导致胆固醇升高。</p><hr><h2 id="Solutions-and-Treatment（解决方案与治疗）"><a href="#Solutions-and-Treatment（解决方案与治疗）" class="headerlink" title="Solutions and Treatment（解决方案与治疗）"></a>Solutions and Treatment（解决方案与治疗）</h2><p>One way to help avoid malnutrition is to enrich food with vitamins. For example, milk is enriched with Vitamin D. In Third World countries, schools must try to teach children the right eating habits and <strong>emphasize</strong> eating vegetables and fruit. Governments and other institutions must do their part in educating the population to eat the right things. The World Health Organization and other groups try to help the poorest of these countries with financial aid and other support.</p><p class="chinese-paragraph">避免营养不良的一种方法是为食物添加维生素。例如，牛奶中强化了维生素D。在第三世界国家，学校应努力教导孩子正确的饮食习惯，强调多吃蔬菜和水果。政府和其他机构也应承担起教育民众合理膳食的责任。世界卫生组织等组织正通过财政援助和其他方式帮助这些最贫困的国家。</p>]]></content>
      
      
      <categories>
          
          <category> English </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>开发与系统技巧总结</title>
      <link href="/2026/02/04/%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93%202026_2_4/"/>
      <url>/2026/02/04/%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93%202026_2_4/</url>
      
        <content type="html"><![CDATA[<h2 id="系统禁止运行脚本"><a href="#系统禁止运行脚本" class="headerlink" title="系统禁止运行脚本"></a>系统禁止运行脚本</h2><p>在windows系统尝试激活 python虚拟环境时会出现以下错误：</p><p><img src="https://i-blog.csdnimg.cn/direct/9d4893e58fdf42da908035c6d3e4d47d.png" alt="img"></p><h3 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h3><p>查看当前的执行策略：</p><p>在 powershell 中运行命令查看当前执行策略：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-ExecutionPolicy</span><br></pre></td></tr></table></figure><p>可能会显示Restricted（限制脚本运行）</p><p>修改执行策略：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-ExecutionPolicy Unrestricted -Scope CurrentUser -Force</span><br></pre></td></tr></table></figure><h3 id="命令说明："><a href="#命令说明：" class="headerlink" title="命令说明："></a>命令说明：</h3><p>Set-ExecutionPolicy</p><p>这是用于更改PowerShell执行策略的cmdlet。执行策略是一个安全特性，用于控制PowerShell是否允许运行脚本以及运行哪些脚本。</p><p>Unrestricted</p><p>表示设置为无限制模式，此模式的特性如下：</p><ul><li>本地脚本：可以直接运行，无需数字签名。</li><li>远程脚本：可以运行，但首次运行时会显示警告，提醒该脚本是从互联网或远程来源下载的。</li></ul><p>注意：这种模式对安全性要求较低，可能会允许执行恶意脚本，因此需要谨慎使用。可以使用RemoteSigned：允许本地脚本运行，但需要远程下载的脚本带有数字签名。</p><p>-Scope CurrentUser</p><p>指定更改执行策略的作用范围，只影响当前用户。</p><p>-Force</p><p>强制执行此命令，忽略任何提示或确认。例如：</p><ul><li>不会要求用户手动确认更改。</li><li>自动覆盖当前的执行策略。</li></ul><p><strong>重新运行脚本</strong></p><p>重新运行报错的脚本，此时能正常运行。</p><h2 id="右键打开命令行"><a href="#右键打开命令行" class="headerlink" title="右键打开命令行"></a>右键打开命令行</h2><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>Win10系统默认“Shift+右键”只能打开<a href="https://zhida.zhihu.com/search?content_id=237661644&content_type=Article&match_order=1&q=powershell&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzAzNDE3NjAsInEiOiJwb3dlcnNoZWxsIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjM3NjYxNjQ0LCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.sTZg33pZcfjv4sNgNBqwCdXoFnlXaUT3gpXgzscnDOU&zhida_source=entity">powershell</a>，不能打开cmd，只能打开powershell。如果想在该文件夹目录下打开cmd，并且路径指向该目录，可以如下操作，非常快捷，一分钟搞定，亲测有效，特此记录</p><h3 id="途径"><a href="#途径" class="headerlink" title="途径"></a>途径</h3><p>在磁盘任意位置建立一个文本文档，打开后复制粘贴如下内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\background\shell\cmd_here]</span><br><span class="line">@=&quot;在此处打开命令行&quot;</span><br><span class="line">&quot;Icon&quot;=&quot;cmd.exe&quot;</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\background\shell\cmd_here\command]</span><br><span class="line">@=&quot;\&quot;C:\\Windows\\System32\\cmd.exe\&quot;&quot;</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Folder\shell\cmdPrompt]</span><br><span class="line">@=&quot;在此处打开命令行&quot;</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Folder\shell\cmdPrompt\command]</span><br><span class="line">@=&quot;\&quot;C:\\Windows\\System32\\cmd.exe\&quot; \&quot;cd %1\&quot;&quot;</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\shell\cmd_here]</span><br><span class="line">@=&quot;在此处打开命令行&quot;</span><br><span class="line">&quot;Icon&quot;=&quot;cmd.exe&quot;</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\shell\cmd_here\command]</span><br><span class="line">@=&quot;\&quot;C:\\Windows\\System32\\cmd.exe\&quot;&quot;</span><br></pre></td></tr></table></figure><p>将其按<a href="https://zhida.zhihu.com/search?content_id=237661644&content_type=Article&match_order=1&q=ANSI%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzAzNDE3NjAsInEiOiJBTlNJ5a2X56ym57yW56CBIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjM3NjYxNjQ0LCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.HbjwWl6Xzd4GgLjVIinGFyUcdR4Rjm25kzTG35RCOVA&zhida_source=entity">ANSI字符编码</a>另存为后，修改该文件名为cmd.reg</p><p>注：若不按此编码保存，<a href="https://zhida.zhihu.com/search?content_id=237661644&content_type=Article&match_order=1&q=%E6%B3%A8%E5%86%8C%E8%A1%A8&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzAzNDE3NjAsInEiOiLms6jlhozooagiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMzc2NjE2NDQsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.h8xwXEAZ6yAZAdmF2S2_IYzulQFMPXkGqeUCb7yXgKg&zhida_source=entity">注册表</a>将无法导入中文内容</p><p>双击该文件，将上述注册表操作导入注册表，ok搞定。如下图所示</p><p><img src="https://pica.zhimg.com/v2-00bb8fc453aa3495bc2d5353d32e0386_1440w.jpg" alt="img"></p><h2 id="系统更新延迟2099年"><a href="#系统更新延迟2099年" class="headerlink" title="系统更新延迟2099年"></a>系统更新延迟2099年</h2><p>此方法适用于 Win11 和 Win10，无需下载软件，不会影响微软商店使用。</p><p> 按 Win + X 键选择 Windows PowerShell (管理员)</p><p>注：Win键就是键盘左下角CTRL键右边那个键</p><p> 按右键粘贴这行代码后回车即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsUpdate\UX\Settings&quot; /v FlightSettingsMaxPauseDays /t reg_dword /d 10000 /f</span><br></pre></td></tr></table></figure><p>之后你就可以在 Windows 更新设置——高级选项里面，选择暂停到10000天后更新了：</p><p>如果想恢复，可以随时在这里点击“继续更新”。</p><p>相较于使用软件，这个方法更原生、更简单。</p><h2 id="一键安装python依赖"><a href="#一键安装python依赖" class="headerlink" title="一键安装python依赖"></a>一键安装python依赖</h2><p><a href="E:\text\requirements_backup.txt">依赖文档</a></p><p>安装命令：</p><p>pip 前缀</p><p>install 安装 命令示例1: pip install 库名</p><p> 命令示例2: pip install 库名&#x3D;&#x3D;版本号</p><p> 命令示例3: pip install 库名 -i 加速安装网络地址</p><p> 命令示例4: pip install 库名&#x3D;&#x3D;版本号 -i 加速安装网络地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyodbc==4.0.32 -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><p>或者直接下载依赖文档，并执行命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><p>命令解析：</p><h5 id="（1）-r-requirements-txt（或-requirement-requirements-txt）"><a href="#（1）-r-requirements-txt（或-requirement-requirements-txt）" class="headerlink" title="（1）-r requirements.txt（或 --requirement requirements.txt）"></a>（1）<code>-r requirements.txt</code>（或 <code>--requirement requirements.txt</code>）</h5><ul><li><p><strong>作用</strong>：从指定的文本文件中读取需要安装的包列表，并批量安装这些包。</p></li><li><p><strong>文件格式</strong>：<code>requirements.txt</code>是 Python 项目中常用的依赖声明文件，每行通常包含一个包名及版本约束（可选）。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requests==2.31.0       # 精确版本</span><br><span class="line">numpy&gt;=1.21.0          # 最低版本</span><br><span class="line">pandas~=2.0.0           # 兼容版本（如 2.0.x）</span><br></pre></td></tr></table></figure></li><li><p><strong>场景</strong>：项目协作或部署时，通过此文件统一记录所有依赖，避免手动逐个安装包的繁琐。</p></li></ul><h5 id="（2）-i-https-pypi-tuna-tsinghua-edu-cn-simple（或-index-url-镜像地址）"><a href="#（2）-i-https-pypi-tuna-tsinghua-edu-cn-simple（或-index-url-镜像地址）" class="headerlink" title="（2）-i https://pypi.tuna.tsinghua.edu.cn/simple（或 --index-url 镜像地址）"></a>（2）<code>-i https://pypi.tuna.tsinghua.edu.cn/simple</code>（或 <code>--index-url 镜像地址</code>）</h5><ul><li><strong>作用</strong>：指定<strong>包下载的镜像源</strong>（替代默认的 PyPI 官方源 <code>https://pypi.org/simple</code>）。</li><li><strong>镜像源背景</strong>：PyPI 官方源服务器位于国外，国内直接访问可能因网络延迟导致下载缓慢甚至失败。清华大学开源软件镜像站（<code>https://pypi.tuna.tsinghua.edu.cn/simple</code>）是国内常用的 PyPI 镜像，同步官方源且访问速度快。</li><li><strong>效果</strong>：通过该参数，<code>pip</code>会从清华镜像源下载 <code>requirements.txt</code>中声明的所有包，显著提升安装效率。</li></ul><h4 id="完整命令逻辑"><a href="#完整命令逻辑" class="headerlink" title="完整命令逻辑"></a><strong>完整命令逻辑</strong></h4><p>这条命令的完整含义是：</p><p><strong>使用 <code>pip</code>工具，从 <code>requirements.txt</code>文件中读取需要安装的 Python 包列表，并通过清华大学 PyPI 镜像源（<code>https://pypi.tuna.tsinghua.edu.cn/simple</code>）下载并安装这些包。</strong></p><h2 id="MD插入音频视频文件"><a href="#MD插入音频视频文件" class="headerlink" title="MD插入音频视频文件"></a>MD插入音频视频文件</h2><p>Markdown是一种轻量级标记语言，它使用简单的语法来描述文本的格式。除了基本的文本格式化之外，Markdown还支持插入图片、音频和<a href="https://cloud.baidu.com/product/mct.html">视频</a>等<a href="https://cloud.baidu.com/solution/media.html">多媒体</a>文件。下面将分别介绍如何在Markdown中插入这些媒体文件。</p><h3 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h3><p>要在Markdown中插入图片，可以使用以下语法：</p><p><img src="https://cloud.baidu.com/article/image%20URL" alt="alt text"></p><p>其中，<code>alt text</code>是图片的替代文本，用于描述图片的内容，方便搜索引擎抓取和屏幕阅读器读取。<code>image URL</code>是图片的链接地址，可以是本地文件路径或<a href="https://cloud.baidu.com/product/et.html">网络</a>链接。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![猫的图片](https://example.com/cat.jpg)</span><br></pre></td></tr></table></figure><p><img src="E:\loading.gif" alt="loading"></p><h3 id="插入音频"><a href="#插入音频" class="headerlink" title="插入音频"></a>插入音频</h3><p>要在Markdown中插入音频，可以使用以下语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;audio controls&gt;</span><br><span class="line">    &lt;source src=&quot;your-audio-file.mp3&quot; type=&quot;audio/mpeg&quot;&gt;</span><br><span class="line">    您的浏览器不支持音频播放。</span><br><span class="line">&lt;/audio&gt;</span><br></pre></td></tr></table></figure><p>其中，<code>audio controls</code>是音频文件的内联 HTML，<code>source src</code>是音频<br>文件的链接地址。</p><div style="    max-width: 400px;    margin: 20px auto;    padding: 15px;    background: linear-gradient(135deg, #667eea, #764ba2);    border-radius: 12px;    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);">    <audio controls style="        width: 100%;        outline: none;        border-radius: 8px;        background-color: rgba(255, 255, 255, 0.9);        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));    ">        <source src="E:\千年电一回.mp3" type="audio/mpeg">        您的浏览器不支持音频播放。    </audio></div><p>这将插入一个名为“千年电一回”的音频文件，音频文件的URL为<code>https://example.com/cat_sound.mp3</code>。</p><h3 id="插入视频"><a href="#插入视频" class="headerlink" title="插入视频"></a>插入视频</h3><p>要在Markdown中插入视频，可以使用以下语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;video width=&quot;1920&quot; height=&quot;1080&quot; controls&gt;</span><br><span class="line">    &lt;source src=&quot;E:\video.mp4&quot; type=&quot;video/mp4&quot;&gt;</span><br><span class="line">    您的浏览器不支持视频播放。</span><br><span class="line">&lt;/video&gt;</span><br></pre></td></tr></table></figure><p>其中，<code>width=&quot;1920&quot; height=&quot;1080&quot;</code>是视频文件的长度宽度，<code>source src</code>是视频文件的链接地址。例如：</p><p>这将插入一个名为“cat_video.mp4”的视频文件，视频文件的URL为<code>https://example.com/cat_video.mp4</code>。</p><video width="640" height="360" controls autoplay loop>    <source src="E:\video.mp4" type="video/mp4">    您的浏览器不支持视频播放。</video><p>需要注意的是，Markdown语法对于不同的Markdown解析器可能会有所不同。因此，在编写Markdown<a href="https://cloud.baidu.com/product/doc.html">文档</a>时，请确保所使用的Markdown解析器支持你所需的语法。此外，由于Markdown是一种纯文本格式，因此在插入图片、音频和视频时，建议使用相对稳定的链接地址，以便在需要时可以轻松地更新媒体文件。</p><h2 id="Mermaid语法渲染与实际开发用途"><a href="#Mermaid语法渲染与实际开发用途" class="headerlink" title="Mermaid语法渲染与实际开发用途"></a>Mermaid语法渲染与实际开发用途</h2><h3 id="流程图-Flowchart"><a href="#流程图-Flowchart" class="headerlink" title="流程图 (Flowchart)"></a>流程图 (Flowchart)</h3><pre class="mermaid">graph TD    A[Start] --> B{Is it working?}    B -- Yes --> C[Ship it]    B -- No --> D[Debug]    D --> B</pre><p><strong>实际开发用途：</strong></p><ul><li><strong>业务逻辑梳理</strong>：清晰展示业务决策流程，帮助团队理解复杂业务规则</li><li><strong>算法设计</strong>：可视化算法执行路径，便于发现逻辑漏洞和优化点</li><li><strong>Bug排查流程</strong>：标准化调试和问题解决步骤，提高团队debug效率</li><li><strong>CI&#x2F;CD流水线</strong>：描述自动化构建、测试、部署流程，确保发布质量</li></ul><h3 id="时序图-Sequence-Diagram"><a href="#时序图-Sequence-Diagram" class="headerlink" title="时序图 (Sequence Diagram)"></a>时序图 (Sequence Diagram)</h3><pre class="mermaid">sequenceDiagram    participant Client    participant API    participant DB    Client->>API: GET /users    API->>DB: query users    DB-->>API: rows    API-->>Client: JSON</pre><p><strong>实际开发用途：</strong></p><ul><li><strong>API接口设计</strong>：明确前后端交互协议，减少集成时的沟通成本</li><li><strong>分布式系统调试</strong>：追踪微服务间调用链路，快速定位性能瓶颈和故障点</li><li><strong>数据库事务分析</strong>：可视化数据操作流程，确保ACID特性正确实现</li><li><strong>第三方服务集成</strong>：规范外部API调用时序，处理超时和异常情况</li></ul><h3 id="类图-Class-Diagram"><a href="#类图-Class-Diagram" class="headerlink" title="类图 (Class Diagram)"></a>类图 (Class Diagram)</h3><pre class="mermaid">classDiagram    class User {      +String id      +String name      +login()      +logout()    }    class Session {      +String token      +Date expiresAt    }    User "1" -- "many" Session : creates</pre><p><strong>实际开发用途：</strong></p><ul><li><strong>领域模型设计</strong>：明确业务实体关系和职责边界，指导数据库设计</li><li><strong>API文档生成</strong>：自动生成接口文档，保持代码与文档的一致性</li><li><strong>重构参考</strong>：识别代码坏味道（如上帝类、循环依赖），规划重构路径</li><li><strong>新人培训</strong>：快速理解系统核心结构和对象协作方式</li></ul><h3 id="状态图-State-Diagram"><a href="#状态图-State-Diagram" class="headerlink" title="状态图 (State Diagram)"></a>状态图 (State Diagram)</h3><pre class="mermaid">stateDiagram-v2    [*] --> Idle    Idle --> Running: start    Running --> Paused: pause    Paused --> Running: resume    Running --> [*]: stop</pre><p><strong>实际开发用途：</strong></p><ul><li><strong>订单状态管理</strong>：跟踪电商订单从创建到完成的生命周期，处理异常状态</li><li><strong>工作流引擎</strong>：实现审批流程、任务派发等状态驱动的业务逻辑</li><li><strong>游戏开发</strong>：管理角色状态（ idle&#x2F;running&#x2F;jumping&#x2F;dead ），简化状态转换逻辑</li><li><strong>物联网设备</strong>：监控设备在线&#x2F;离线&#x2F;故障状态，触发相应的运维动作</li></ul><h3 id="ER图-Entity-Relationship-Diagram"><a href="#ER图-Entity-Relationship-Diagram" class="headerlink" title="ER图 (Entity Relationship Diagram)"></a>ER图 (Entity Relationship Diagram)</h3><pre class="mermaid">erDiagram    CUSTOMER ||--o{ ORDER : places    ORDER ||--|{ LINE_ITEM : contains    CUSTOMER ||--o{ DELIVERY_ADDRESS : uses    PRODUCT ||--|{ LINE_ITEM : includes</pre><p><strong>实际开发用途：</strong></p><ul><li><strong>数据库设计</strong>：可视化表关系，避免N+1查询和冗余数据</li><li><strong>数据迁移规划</strong>：明确新旧系统数据结构映射，降低迁移风险</li><li><strong>数据分析建模</strong>：构建数据仓库事实表和维度表关系，支撑BI报表</li><li><strong>API响应设计</strong>：确保JSON结构与数据库模型合理映射，避免数据泄露</li></ul><h3 id="旅程图-Journey-Diagram"><a href="#旅程图-Journey-Diagram" class="headerlink" title="旅程图 (Journey Diagram)"></a>旅程图 (Journey Diagram)</h3><pre class="mermaid">journey    title Checkout Journey    section Browse      User: 4: Visit store      User: 3: View product    section Purchase      User: 3: Add to cart      User: 2: Checkout    section Post-purchase      User: 4: Receive email</pre><p><strong>实际开发用途：</strong></p><ul><li><strong>用户体验优化</strong>：识别购物流程中的痛点（如评分低的Checkout环节）</li><li><strong>转化率分析</strong>：量化各步骤用户流失率，指导产品迭代优先级</li><li><strong>A&#x2F;B测试设计</strong>：对比不同流程设计的用户满意度差异</li><li><strong>客服知识库</strong>：预判用户在各阶段可能遇到的问题，准备标准解决方案</li></ul><h3 id="开发实践价值"><a href="#开发实践价值" class="headerlink" title="开发实践价值"></a>开发实践价值</h3><ol><li><strong>降低沟通成本</strong>：技术&#x2F;产品&#x2F;设计团队使用统一语言描述需求</li><li><strong>提升开发效率</strong>：提前发现设计缺陷，减少后期返工</li><li><strong>增强可维护性</strong>：图表即文档，新成员能快速理解系统脉络</li><li><strong>支持敏捷迭代</strong>：可视化架构演进过程，适应需求变更</li><li><strong>自动化潜力</strong>：结合工具链可自动生成测试用例、API骨架代码等</li></ol><blockquote><p><strong>工具推荐</strong>：VS Code安装Mermaid插件、Typora开启Mermaid支持、GitLab&#x2F;GitHub原生支持、语雀&#x2F;Notion等协作平台均已集成。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 开发技巧 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>单一职责原则与开闭原则在Spring中的应用</title>
      <link href="/2026/02/03/%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3&amp;%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99%202026_2_3/"/>
      <url>/2026/02/03/%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3&amp;%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99%202026_2_3/</url>
      
        <content type="html"><![CDATA[<h2 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h2><p>单一职责原则(Single Responsibility Principle, SRP)是SOLID原则中的第一个原则，它规定一个类应该只有一个引起它变化的原因。在SpringBoot和SpringCloud这类现代Java框架中，SRP的应用尤为重要。</p><h2 id="1-核心概念"><a href="#1-核心概念" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>单一职责原则的核心思想是：</p><ul><li>每个类&#x2F;模块&#x2F;服务只负责一项功能</li><li>每个功能变更只影响一个类&#x2F;模块&#x2F;服务</li><li>高内聚低耦合的设计</li></ul><h2 id="2-SpringBoot中的应用方式"><a href="#2-SpringBoot中的应用方式" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-分层架构实现SRP"><a href="#2-1-分层架构实现SRP" class="headerlink" title="2.1 分层架构实现SRP"></a>2.1 分层架构实现SRP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserDTO&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(userService.getUserById(id));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository, UserMapper userMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">        <span class="built_in">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(id)</span><br><span class="line">        .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;User not found&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> userMapper.toDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    <span class="comment">// 自定义查询方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键点：</p><ul><li>Controller: 只负责HTTP请求处理和响应</li><li>Service: 只负责业务逻辑</li><li>Repository: 只负责数据访问</li><li>每层职责清晰，变更互不影响</li></ul><h3 id="2-2-组件拆分"><a href="#2-2-组件拆分" class="headerlink" title="2.2 组件拆分"></a>2.2 组件拆分</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendNotification</span><span class="params">(NotificationRequest request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailNotificationService</span> <span class="keyword">implements</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendNotification</span><span class="params">(NotificationRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 邮件发送实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsNotificationService</span> <span class="keyword">implements</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendNotification</span><span class="params">(NotificationRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 短信发送实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2><ol start="3"><li>SpringCloud中的应用方式</li></ol><h3 id="3-1-微服务拆分"><a href="#3-1-微服务拆分" class="headerlink" title="3.1 微服务拆分"></a>3.1 微服务拆分</h3><p>在SpringCloud中，SRP体现在微服务划分上：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 用户服务(user-service): 只处理用户相关功能</span><br><span class="line">- 订单服务(order-service): 只处理订单相关功能</span><br><span class="line">- 支付服务(payment-service): 只处理支付相关功能</span><br><span class="line">- 通知服务(notification-service): 只处理通知相关功能</span><br></pre></td></tr></table></figure><h3 id="3-2-服务间通信"><a href="#3-2-服务间通信" class="headerlink" title="3.2 服务间通信"></a>3.2 服务间通信</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/orders/&#123;userId&#125;&quot;)</span></span><br><span class="line">    List&lt;OrderDTO&gt; <span class="title function_">getUserOrders</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-最佳实践场景"><a href="#4-最佳实践场景" class="headerlink" title="4. 最佳实践场景"></a>4. 最佳实践场景</h2><ol><li><strong>领域驱动设计(DDD)</strong>:<ul><li>限界上下文明确职责边界</li><li>聚合根封装业务规则</li></ul></li><li><strong>CQRS模式</strong>:<ul><li>读写分离，命令和查询不同模型</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命令端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserCommandService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(CreateUserCommand command)</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQueryService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> UserView <span class="title function_">getUser</span><span class="params">(Long id)</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>事件驱动架构</strong>:</li></ol><ul><li>通过事件解耦服务</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleOrderCreatedEvent</span><span class="params">(OrderCreatedEvent event)</span> &#123;</span><br><span class="line">    <span class="comment">// 处理订单创建事件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>功能模块化</strong>:</li></ol><ul><li>按功能划分模块包结构</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">com.example.app</span><br><span class="line">├── user</span><br><span class="line">│   ├── controller</span><br><span class="line">│   ├── service</span><br><span class="line">│   ├── repository</span><br><span class="line">│   └── model</span><br><span class="line">├── product</span><br><span class="line">│   ├── controller</span><br><span class="line">│   ├── service</span><br><span class="line">│   └── ...</span><br></pre></td></tr></table></figure><h2 id="优势总结"><a href="#优势总结" class="headerlink" title="优势总结"></a>优势总结</h2><ol><li><strong>可维护性</strong>: 修改一个功能只影响一个组件</li><li><strong>可测试性</strong>: 单一职责组件更容易测试</li><li><strong>可扩展性</strong>: 新功能通过组合现有组件实现</li><li><strong>团队协作</strong>: 不同团队可以并行开发不同组件</li></ol><p>在SpringBoot&#x2F;SpringCloud中贯彻SRP，可以构建出高内聚、低耦合、易于维护和扩展的现代化微服务架构</p><h2 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h2><p>开闭原则(Open-Closed Principle, OCP)是SOLID原则中的第二个原则，它规定软件实体(类、模块、函数等)应该对扩展开放，对修改关闭。</p><h2 id="1-核心概念-1"><a href="#1-核心概念-1" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>开闭原则的关键思想：</p><ul><li><strong>对扩展开放</strong>：允许在不修改现有代码的情况下添加新功能</li><li><strong>对修改关闭</strong>：已有代码应保持稳定，不因新功能而修改</li><li>通过抽象和接口实现灵活性</li></ul><h2 id="2-SpringBoot中的应用方式-1"><a href="#2-SpringBoot中的应用方式-1" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-策略模式实现OCP"><a href="#2-1-策略模式实现OCP" class="headerlink" title="2.1 策略模式实现OCP"></a>2.1 策略模式实现OCP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(BigDecimal amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 支付宝支付实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 微信支付实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-Spring-依赖注入服务"><a href="#2-2-Spring-依赖注入服务" class="headerlink" title="2.2 Spring 依赖注入服务"></a>2.2 Spring 依赖注入服务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, PaymentStrategy&gt; strategies;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentService</span><span class="params">(List&lt;PaymentStrategy&gt; strategyList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategies = strategyList.stream()</span><br><span class="line">            .collect(Collectors.toMap(</span><br><span class="line">                s -&gt; s.getClass().getSimpleName(),</span><br><span class="line">                Function.identity()</span><br><span class="line">            ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processPayment</span><span class="params">(String strategyName, BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> strategies.get(strategyName);</span><br><span class="line">        <span class="keyword">if</span> (strategy != <span class="literal">null</span>) &#123;</span><br><span class="line">            strategy.pay(amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SpringCloud中的应用方式"><a href="#SpringCloud中的应用方式" class="headerlink" title="SpringCloud中的应用方式"></a>SpringCloud中的应用方式</h2><h3 id="3-1-服务扩展点设计"><a href="#3-1-服务扩展点设计" class="headerlink" title="3.1 服务扩展点设计"></a>3.1 服务扩展点设计</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">canProcess</span><span class="params">(Order order)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-实现服务扩展"><a href="#3-2-实现服务扩展" class="headerlink" title="3.2 实现服务扩展"></a>3.2 实现服务扩展</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NormalOrderProcessor</span> <span class="keyword">implements</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canProcess</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> order.getType() == OrderType.NORMAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 普通订单处理逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-3-团购订单处理"><a href="#3-3-团购订单处理" class="headerlink" title="3.3 团购订单处理"></a>3.3 团购订单处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupOrderProcessor</span> <span class="keyword">implements</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canProcess</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> order.getType() == OrderType.GROUP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 团购订单处理逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="最佳实践场景"><a href="#最佳实践场景" class="headerlink" title="最佳实践场景"></a>最佳实践场景</h2><ol><li><strong>插件式架构</strong>：</li></ol><ul><li>通过SPI机制动态加载实现类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServiceLoader&lt;OrderProcessor&gt; loader = ServiceLoader.load(OrderProcessor.class);</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>模板方法模式</strong>：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractOrderProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        validate(order);</span><br><span class="line">        doProcess(order);</span><br><span class="line">        afterProcess(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doProcess</span><span class="params">(Order order)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>装饰器模式</strong>：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingOrderProcessor</span> <span class="keyword">implements</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderProcessor delegate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggingOrderProcessor</span><span class="params">(OrderProcessor delegate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Processing order: &#123;&#125;&quot;</span>, order.getId());</span><br><span class="line">        delegate.process(order);</span><br><span class="line">        log.info(<span class="string">&quot;Order processed: &#123;&#125;&quot;</span>, order.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>配置驱动扩展</strong>：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessorConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(name = &quot;order.processor.type&quot;, havingValue = &quot;normal&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> OrderProcessor <span class="title function_">normalOrderProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NormalOrderProcessor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-优势总结"><a href="#5-优势总结" class="headerlink" title="5. 优势总结"></a>5. 优势总结</h2><ol><li><strong>稳定性</strong>：核心代码不需要频繁修改</li><li><strong>可扩展性</strong>：通过新实现类轻松添加功能</li><li><strong>可维护性</strong>：修改影响范围小</li><li><strong>可测试性</strong>：各扩展点可独立测试</li></ol><p>在SpringBoot&#x2F;SpringCloud中应用OCP原则，可以构建出高度可扩展且稳定的系统架构，适应业务快速变化的需求。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SOLID原则与设计模式应用分类表</title>
      <link href="/2026/02/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8%E5%88%86%E7%B1%BB%E8%A1%A8%202026_2_3/"/>
      <url>/2026/02/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8%E5%88%86%E7%B1%BB%E8%A1%A8%202026_2_3/</url>
      
        <content type="html"><![CDATA[<h1 id="SOLID原则在代码落地中的模式应用分类表"><a href="#SOLID原则在代码落地中的模式应用分类表" class="headerlink" title="SOLID原则在代码落地中的模式应用分类表"></a>SOLID原则在代码落地中的模式应用分类表</h1><h2 id="表格说明"><a href="#表格说明" class="headerlink" title="表格说明"></a>表格说明</h2><ul><li><strong>创建型模式</strong>：关注对象创建机制，增加创建对象的灵活性和复用性</li><li><strong>结构型模式</strong>：关注类和对象的组合，优化类之间的关系</li><li><strong>行为型模式</strong>：关注对象间的职责分配和通信机制</li></ul><table><thead><tr><th>SOLID原则</th><th>模式类别</th><th>最佳适用模式</th><th>模式应用场景</th><th>SpringBoot&#x2F;SpringCloud中的具体应用</th></tr></thead><tbody><tr><td><strong>单一职责原则(SRP)</strong></td><td>创建型</td><td>单例模式   工厂方法模式</td><td>• 确保每个类&#x2F;组件只负责单一功能   • 创建独立的业务处理器实例</td><td>• <code>@Service</code>、<code>@Component</code>注解实现单例   • <code>@Configuration</code>类中定义专用Bean工厂   • 为每个微服务职责创建独立配置类</td></tr><tr><td></td><td>结构型</td><td>外观模式   代理模式</td><td>• 为复杂子系统提供统一接口   • 为单一职责的类添加访问控制</td><td>• <code>@FeignClient</code>接口作为服务外观   • Spring AOP实现方法级职责隔离   • API网关路由到专门控制器</td></tr><tr><td></td><td>行为型</td><td>策略模式   责任链模式</td><td>• 将不同算法封装为独立策略   • 将处理流程分解为单一职责的处理器</td><td>• 支付方式、验证策略的独立实现   • 请求处理管道中的过滤器链   • 事件监听器的职责分离</td></tr><tr><td><strong>开闭原则(OCP)</strong></td><td>创建型</td><td>抽象工厂模式   建造者模式</td><td>• 通过抽象创建不同类型对象   • 灵活构建复杂对象而不修改代码</td><td>• <code>JpaRepositoryFactoryBean</code>创建不同数据源仓库   • <code>@Builder</code>注解构建复杂DTO   • 多环境配置的不同Bean创建</td></tr><tr><td></td><td>结构型</td><td>装饰器模式   适配器模式</td><td>• 动态扩展对象功能   • 适配不同接口实现统一扩展点</td><td>• Spring Security过滤器链装饰   • <code>HttpMessageConverter</code>适配不同数据格式   • <code>@Transactional</code>注解的事务装饰</td></tr><tr><td></td><td>行为型</td><td>策略模式   观察者模式</td><td>• 新增策略不影响现有代码   • 扩展事件处理器不影响发布者</td><td>• 新的业务规则通过策略模式加入   • 微服务事件驱动的扩展机制   • <code>@EventListener</code>注册新事件处理器</td></tr><tr><td><strong>里氏替换原则(LSP)</strong></td><td>创建型</td><td>原型模式   工厂模式</td><td>• 确保子类实例可替换父类   • 通过工厂保证创建正确的子类</td><td>• 深拷贝Bean进行安全修改   • 工厂方法验证子类契约符合性   • 配置化的实现类实例化</td></tr><tr><td></td><td>结构型</td><td>桥接模式   组合模式</td><td>• 分离抽象与实现保证可替换性   • 树形结构中的一致性替换</td><td>• 不同存储策略的桥接实现   • 菜单权限的树形组合结构   • 微服务接口的版本桥接</td></tr><tr><td></td><td>行为型</td><td>模板方法模式   状态模式</td><td>• 子类重写步骤不改变算法结构   • 状态转换保持父类契约</td><td>• JdbcTemplate的固定执行流程   • 订单状态机的统一接口   • 工作流引擎的步骤执行</td></tr><tr><td><strong>依赖倒置原则(DIP)</strong></td><td>创建型</td><td>依赖注入(DI)   控制反转(IoC)</td><td>• 通过容器注入抽象实现   • 反转控制权获得灵活性</td><td>• Spring IoC容器管理Bean生命周期   • <code>@Autowired</code>实现依赖注入   • <code>@Qualifier</code>精确控制实现选择</td></tr><tr><td></td><td>结构型</td><td>桥接模式   适配器模式</td><td>• 抽象与实现分离   • 不同实现适配统一接口</td><td>• 数据库访问的多种技术桥接   • 第三方API的适配器封装   • 消息队列的多实现适配</td></tr><tr><td></td><td>行为型</td><td>策略模式   模板方法模式</td><td>• 基于抽象策略执行   • 固定流程调用抽象操作</td><td>• 多种算法策略的统一调用   • 业务流程模板调用抽象服务   • 规则引擎的策略执行</td></tr><tr><td><strong>接口隔离原则(ISP)</strong></td><td>创建型</td><td>工厂方法模式   原型模式</td><td>• 为不同客户端创建专用接口实例   • 克隆特定接口功能的对象</td><td>• 为不同角色创建专用服务实例   • 特定功能模块的独立工厂   • 接口特定实现的原型复制</td></tr><tr><td></td><td>结构型</td><td>适配器模式   装饰器模式</td><td>• 将胖接口拆分为专用接口   • 为接口添加特定功能</td><td>• 将通用接口适配为专用接口   • 为接口添加缓存、日志等功能   • <code>@Validated</code>分组验证接口</td></tr><tr><td></td><td>行为型</td><td>迭代器模式   中介者模式</td><td>• 提供专用遍历接口   • 通过中介减少接口依赖</td><td>• 分页查询的专用迭代器   • 微服务间通过网关中介通信   • 事件总线的专用监听器接口</td></tr><tr><td><strong>合成复用原则(CRP)</strong></td><td>创建型</td><td>组合模式   享元模式</td><td>• 通过对象组合复用功能   • 共享细粒度对象减少创建开销</td><td>• 权限树的节点组合   • 数据库连接池的享元复用   • 微服务客户端的连接复用</td></tr><tr><td></td><td>结构型</td><td>组合模式   装饰器模式   代理模式</td><td>• 对象包含其他对象实现复用   • 包装对象添加职责   • 控制对象访问实现复用</td><td>• 业务对象的组件组合   • Spring AOP方法拦截装饰   • <code>@Cacheable</code>代理实现缓存复用</td></tr><tr><td></td><td>行为型</td><td>责任链模式   观察者模式   策略模式</td><td>• 对象链传递请求复用处理能力   • 一对多通知复用事件处理   • 算法封装复用决策逻辑</td><td>• 过滤器链的请求处理   • <code>@EventListener</code>的事件广播   • 多种业务策略的组合使用</td></tr><tr><td><strong>迪米特原则(LoD)</strong></td><td>创建型</td><td>建造者模式   工厂模式</td><td>• 封装复杂对象创建过程   • 隐藏创建细节减少知识暴露</td><td>• 复杂查询条件的建造器   • DTO转换的工厂封装   • 配置对象的构建器模式</td></tr><tr><td></td><td>结构型</td><td>外观模式   代理模式</td><td>• 提供统一简单接口   • 控制访问减少直接依赖</td><td>• BFF层的外观封装   • API网关的路由代理   • <code>@Transactional</code>的事务边界代理</td></tr><tr><td></td><td>行为型</td><td>中介者模式   命令模式</td><td>• 集中协调减少直接通信   • 封装请求减少调用者知识</td><td>• 微服务编排的中介者   • 异步任务执行的命令封装   • 工作流引擎的命令模式</td></tr></tbody></table><h2 id="模式应用的核心要点"><a href="#模式应用的核心要点" class="headerlink" title="模式应用的核心要点"></a>模式应用的核心要点</h2><h3 id="创建型模式在SOLID中的应用重点"><a href="#创建型模式在SOLID中的应用重点" class="headerlink" title="创建型模式在SOLID中的应用重点"></a>创建型模式在SOLID中的应用重点</h3><ul><li><strong>解决对象创建的问题</strong>，确保在遵循SOLID原则的同时灵活创建对象</li><li>重点关注<strong>依赖注入</strong>、<strong>工厂模式</strong>、<strong>建造者模式</strong>的使用</li><li>在SpringBoot中充分利用<code>@Configuration</code>、<code>@Bean</code>等注解</li></ul><h3 id="结构型模式在SOLID中的应用重点"><a href="#结构型模式在SOLID中的应用重点" class="headerlink" title="结构型模式在SOLID中的应用重点"></a>结构型模式在SOLID中的应用重点</h3><ul><li><strong>优化类和对象的结构关系</strong>，支持低耦合高内聚的设计</li><li>重点关注<strong>装饰器</strong>、<strong>代理</strong>、<strong>外观</strong>、<strong>适配器</strong>模式</li><li>在SpringCloud中通过网关、服务发现等机制实现</li></ul><h3 id="行为型模式在SOLID中的应用重点"><a href="#行为型模式在SOLID中的应用重点" class="headerlink" title="行为型模式在SOLID中的应用重点"></a>行为型模式在SOLID中的应用重点</h3><ul><li><strong>规范对象间的交互行为</strong>，确保职责清晰、协作灵活</li><li>重点关注<strong>策略</strong>、<strong>观察者</strong>、<strong>责任链</strong>、<strong>模板方法</strong>模式</li><li>在微服务架构中通过事件驱动、消息队列等实现</li></ul><p>这个表格提供了在实际项目中应用SOLID原则的模式选择指南，帮助开发者根据具体场景选择最合适的设计模式来实现高质量的软件架构。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>接口隔离原则与合成复用原则在Spring中的应用</title>
      <link href="/2026/02/03/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB&amp;%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%202026_2_3/"/>
      <url>/2026/02/03/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB&amp;%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%202026_2_3/</url>
      
        <content type="html"><![CDATA[<h1 id="接口隔离原则-ISP"><a href="#接口隔离原则-ISP" class="headerlink" title="接口隔离原则(ISP)"></a>接口隔离原则(ISP)</h1><p>接口隔离原则(Interface Segregation Principle, ISP)是SOLID原则中的第五个原则，它规定：客户端不应该被迫依赖于它不使用的方法。多个特定客户端接口要好于一个通用接口。</p><h2 id="1-核心概念"><a href="#1-核心概念" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>接口隔离原则的关键思想：</p><ul><li><strong>不要强迫客户端依赖它们不需要的方法</strong></li><li><strong>将臃肿的接口拆分为更小、更具体的接口</strong></li><li><strong>让接口的职责单一化</strong></li><li><strong>避免”胖接口”(Fat Interface)</strong></li></ul><h2 id="2-SpringBoot中的应用方式"><a href="#2-SpringBoot中的应用方式" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-接口拆分示例"><a href="#2-1-接口拆分示例" class="headerlink" title="2.1 接口拆分示例"></a>2.1 接口拆分示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反ISP的反例 - 臃肿的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// 用户基本操作</span></span><br><span class="line">    UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getAllUsers</span><span class="params">()</span>;</span><br><span class="line">    UserDTO <span class="title function_">createUser</span><span class="params">(UserCreateRequest request)</span>;</span><br><span class="line">    UserDTO <span class="title function_">updateUser</span><span class="params">(Long id, UserUpdateRequest request)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 管理员操作</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">resetPassword</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getLockedUsers</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 认证授权操作</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(Long userId, String permission)</span>;</span><br><span class="line">    Set&lt;String&gt; <span class="title function_">getUserPermissions</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">assignRole</span><span class="params">(Long userId, String role)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合ISP的正确设计 - 拆分接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BasicUserService</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getAllUsers</span><span class="params">()</span>;</span><br><span class="line">    UserDTO <span class="title function_">createUser</span><span class="params">(UserCreateRequest request)</span>;</span><br><span class="line">    UserDTO <span class="title function_">updateUser</span><span class="params">(Long id, UserUpdateRequest request)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdminUserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">resetPassword</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlockUser</span><span class="params">(Long userId)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getLockedUsers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorizationService</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(Long userId, String permission)</span>;</span><br><span class="line">    Set&lt;String&gt; <span class="title function_">getUserPermissions</span><span class="params">(Long userId)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">assignRole</span><span class="params">(Long userId, String role)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-Spring中的具体实现"><a href="#2-2-Spring中的具体实现" class="headerlink" title="2.2 Spring中的具体实现"></a>2.2 Spring中的具体实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实现类按需实现接口</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BasicUserService</span>, AdminUserService, AuthorizationService &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取用户逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserDTO&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取所有用户逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现所有接口的方法...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通控制器只需要基础服务</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BasicUserService basicUserService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(BasicUserService basicUserService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.basicUserService = basicUserService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserDTO&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(basicUserService.getUserById(id));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理员控制器需要管理功能</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/admin/users&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminUserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BasicUserService basicUserService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AdminUserService adminUserService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AdminUserController</span><span class="params">(BasicUserService basicUserService, </span></span><br><span class="line"><span class="params">                              AdminUserService adminUserService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.basicUserService = basicUserService;</span><br><span class="line">        <span class="built_in">this</span>.adminUserService = adminUserService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;userId&#125;/lock&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">lockUser</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span> &#123;</span><br><span class="line">        adminUserService.lockUser(userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-使用-Qualifier区分接口实现"><a href="#2-3-使用-Qualifier区分接口实现" class="headerlink" title="2.3 使用@Qualifier区分接口实现"></a>2.3 使用@Qualifier区分接口实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 专门的管理员服务实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;adminUserService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminOnlyUserService</span> <span class="keyword">implements</span> <span class="title class_">AdminUserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">resetPassword</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 管理员专用的密码重置逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只实现AdminUserService接口的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 认证服务实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;authService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthBasedAuthorizationService</span> <span class="keyword">implements</span> <span class="title class_">AuthorizationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPermission</span><span class="params">(Long userId, String permission)</span> &#123;</span><br><span class="line">        <span class="comment">// 基于权限的验证逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只实现AuthorizationService接口的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-SpringCloud中的应用方式"><a href="#3-SpringCloud中的应用方式" class="headerlink" title="3. SpringCloud中的应用方式"></a>3. SpringCloud中的应用方式</h2><h3 id="3-1-微服务接口隔离"><a href="#3-1-微服务接口隔离" class="headerlink" title="3.1 微服务接口隔离"></a>3.1 微服务接口隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单服务的细粒度接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderQueryService</span> &#123;</span><br><span class="line">    OrderDTO <span class="title function_">getOrderById</span><span class="params">(Long orderId)</span>;</span><br><span class="line">    List&lt;OrderDTO&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(Long userId)</span>;</span><br><span class="line">    Page&lt;OrderDTO&gt; <span class="title function_">getOrdersWithPagination</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderCommandService</span> &#123;</span><br><span class="line">    OrderDTO <span class="title function_">createOrder</span><span class="params">(OrderCreateCommand command)</span>;</span><br><span class="line">    OrderDTO <span class="title function_">updateOrderStatus</span><span class="params">(Long orderId, OrderStatus status)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">cancelOrder</span><span class="params">(Long orderId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderPaymentService</span> &#123;</span><br><span class="line">    PaymentResult <span class="title function_">processPayment</span><span class="params">(Long orderId, PaymentRequest paymentRequest)</span>;</span><br><span class="line">    RefundResult <span class="title function_">processRefund</span><span class="params">(Long orderId, RefundRequest refundRequest)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Feign客户端接口也遵循ISP</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderQueryClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/orders/&#123;id&#125;&quot;)</span></span><br><span class="line">    OrderDTO <span class="title function_">getOrderById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;userId&#125;/orders&quot;)</span></span><br><span class="line">    List&lt;OrderDTO&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;order-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderCommandClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    OrderDTO <span class="title function_">createOrder</span><span class="params">(<span class="meta">@RequestBody</span> OrderCreateCommand command)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;orderId&#125;/status&quot;)</span></span><br><span class="line">    OrderDTO <span class="title function_">updateOrderStatus</span><span class="params">(<span class="meta">@PathVariable</span> Long orderId, </span></span><br><span class="line"><span class="params">                               <span class="meta">@RequestParam</span> OrderStatus status)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-API网关路由隔离"><a href="#3-2-API网关路由隔离" class="headerlink" title="3.2 API网关路由隔离"></a>3.2 API网关路由隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># application.yml</span><br><span class="line">spring:</span><br><span class="line">cloud:</span><br><span class="line">gateway:</span><br><span class="line">routes:</span><br><span class="line"># 查询路由 - 只读权限</span><br><span class="line">- id: order-query</span><br><span class="line">uri: lb:<span class="comment">//order-service</span></span><br><span class="line">predicates:</span><br><span class="line">- Path=/api/orders<span class="comment">/**</span></span><br><span class="line"><span class="comment">filters:</span></span><br><span class="line"><span class="comment">- name: RequestRateLimiter</span></span><br><span class="line"><span class="comment">args:</span></span><br><span class="line"><span class="comment">redis-rate-limiter.replenishRate: 100</span></span><br><span class="line"><span class="comment">redis-rate-limiter.burstCapacity: 200</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 命令路由 - 需要更高权限</span></span><br><span class="line"><span class="comment">- id: order-command</span></span><br><span class="line"><span class="comment">uri: lb://order-service</span></span><br><span class="line"><span class="comment">predicates:</span></span><br><span class="line"><span class="comment">- Path=/api/orders/command/**</span></span><br><span class="line"><span class="comment">filters:</span></span><br><span class="line"><span class="comment">- name: AuthFilter</span></span><br><span class="line"><span class="comment">args:</span></span><br><span class="line"><span class="comment">required-role: ADMIN</span></span><br></pre></td></tr></table></figure><h2 id="4-最佳实践场景"><a href="#4-最佳实践场景" class="headerlink" title="4. 最佳实践场景"></a>4. 最佳实践场景</h2><h3 id="4-1-角色基础接口设计"><a href="#4-1-角色基础接口设计" class="headerlink" title="4.1 角色基础接口设计"></a>4.1 角色基础接口设计</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础读写接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ReadableRepository</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    Optional&lt;T&gt; <span class="title function_">findById</span><span class="params">(ID id)</span>;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsById</span><span class="params">(ID id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WritableRepository</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    T <span class="title function_">save</span><span class="params">(T entity)</span>;</span><br><span class="line">    &lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; List&lt;S&gt; <span class="title function_">saveAll</span><span class="params">(Iterable&lt;S&gt; entities)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(ID id)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(T entity)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CrudRepository</span>&lt;T, ID&gt; <span class="keyword">extends</span> <span class="title class_">ReadableRepository</span>&lt;T, ID&gt;, WritableRepository&lt;T, ID&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务特定的仓库接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuditableRepository</span>&lt;T, ID&gt; <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;T, ID&gt; &#123;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">findByCreatedDateAfter</span><span class="params">(LocalDateTime date)</span>;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">findByLastModifiedBy</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现按需扩展</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepositoryImpl</span> <span class="keyword">implements</span> <span class="title class_">CrudRepository</span>&lt;User, Long&gt;, AuditableRepository&lt;User, Long&gt; &#123;</span><br><span class="line">    <span class="comment">// 实现所有必要的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-事件监听器接口隔离"><a href="#4-2-事件监听器接口隔离" class="headerlink" title="4.2 事件监听器接口隔离"></a>4.2 事件监听器接口隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不同类型的事件监听器接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderEventListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onOrderCreated</span><span class="params">(OrderCreatedEvent event)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onOrderCancelled</span><span class="params">(OrderCancelledEvent event)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentEventListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onPaymentSuccess</span><span class="params">(PaymentSuccessEvent event)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onPaymentFailed</span><span class="params">(PaymentFailedEvent event)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InventoryEventListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onStockLow</span><span class="params">(StockLowEvent event)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onStockReplenished</span><span class="params">(StockReplenishedEvent event)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合监听器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessEventListener</span> <span class="keyword">implements</span> </span><br><span class="line">    <span class="title class_">OrderEventListener</span>, PaymentEventListener, InventoryEventListener &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOrderCreated</span><span class="params">(OrderCreatedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理订单创建事件</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPaymentSuccess</span><span class="params">(PaymentSuccessEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理支付成功事件</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现所有接口方法...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 专门的库存监听器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryOnlyListener</span> <span class="keyword">implements</span> <span class="title class_">InventoryEventListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStockLow</span><span class="params">(StockLowEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 只关心库存不足事件</span></span><br><span class="line">        sendRestockAlert(event.getProductId());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStockReplenished</span><span class="params">(StockReplenishedEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 只关心库存补充事件</span></span><br><span class="line">        updateInventoryDashboard(event.getProductId());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendRestockAlert</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="comment">// 发送补货提醒</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateInventoryDashboard</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="comment">// 更新仪表板</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-配置服务接口隔离"><a href="#4-3-配置服务接口隔离" class="headerlink" title="4.3 配置服务接口隔离"></a>4.3 配置服务接口隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置读取接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigReader</span> &#123;</span><br><span class="line">    String <span class="title function_">getString</span><span class="params">(String key)</span>;</span><br><span class="line">    Integer <span class="title function_">getInt</span><span class="params">(String key)</span>;</span><br><span class="line">    Boolean <span class="title function_">getBoolean</span><span class="params">(String key)</span>;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">getValue</span><span class="params">(String key, Class&lt;T&gt; type)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置写入接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigWriter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setString</span><span class="params">(String key, String value)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setInt</span><span class="params">(String key, Integer value)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBoolean</span><span class="params">(String key, Boolean value)</span>;</span><br><span class="line">    &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String key, T value)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置监听接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigWatcher</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addListener</span><span class="params">(String keyPattern, ConfigChangeListener listener)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeListener</span><span class="params">(String keyPattern)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合配置服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigService</span> <span class="keyword">extends</span> <span class="title class_">ConfigReader</span>, ConfigWriter, ConfigWatcher &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只读配置服务（用于前端等场景）</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;readOnlyConfigService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadOnlyConfigService</span> <span class="keyword">implements</span> <span class="title class_">ConfigReader</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConfigService fullConfigService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getString</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fullConfigService.getString(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只实现读取方法，编译时保证不会调用写入方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-优势总结"><a href="#5-优势总结" class="headerlink" title="5. 优势总结"></a>5. 优势总结</h2><ol><li><strong>减少依赖</strong>：客户端只依赖需要的方法，减少不必要的耦合</li><li><strong>提高灵活性</strong>：可以独立修改和扩展各个接口</li><li><strong>增强可维护性</strong>：接口职责单一，易于理解和维护</li><li><strong>改善编译时检查</strong>：未实现的方法会在编译时报错</li><li><strong>更好的封装</strong>：隐藏不需要暴露的功能</li></ol><h2 id="6-实际项目中的ISP实践建议"><a href="#6-实际项目中的ISP实践建议" class="headerlink" title="6. 实际项目中的ISP实践建议"></a>6. 实际项目中的ISP实践建议</h2><ol><li><strong>按功能域拆分大接口</strong></li><li><strong>使用Spring的@Qualifier区分不同实现</strong></li><li><strong>在微服务中按业务能力划分API</strong></li><li><strong>利用Java 8的默认方法适度扩展接口</strong></li><li><strong>定期重构检查接口的”肥胖度”</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用默认方法的适度扩展</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdvancedUserService</span> <span class="keyword">extends</span> <span class="title class_">BasicUserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">default</span> UserDTO <span class="title function_">updateUser</span><span class="params">(Long id, UserUpdateRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 提供默认的更新逻辑，具体实现可以覆盖</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">existing</span> <span class="operator">=</span> getUserById(id);</span><br><span class="line">        <span class="comment">// 合并更新逻辑</span></span><br><span class="line">        <span class="keyword">return</span> mergeAndSave(existing, request);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserDTO <span class="title function_">mergeAndSave</span><span class="params">(UserDTO existing, UserUpdateRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 默认合并保存逻辑</span></span><br><span class="line">        <span class="keyword">return</span> existing;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在SpringBoot&#x2F;SpringCloud中应用接口隔离原则，可以构建出更加模块化、可维护的微服务架构，每个服务、组件只暴露必要的接口，降低系统复杂度。</p><h1 id="合成复用原则-CRP"><a href="#合成复用原则-CRP" class="headerlink" title="合成复用原则(CRP)"></a>合成复用原则(CRP)</h1><p>合成复用原则(Composite Reuse Principle, CRP)，也称为组合&#x2F;聚合复用原则，它规定：尽量使用对象组合，而不是继承来达到复用的目的。</p><h2 id="1-核心概念-1"><a href="#1-核心概念-1" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>合成复用原则的关键思想：</p><ul><li><strong>优先使用组合(Composition)和聚合(Aggregation)而非继承(Inheritance)</strong></li><li><strong>组合表示”has-a”关系，继承表示”is-a”关系</strong></li><li><strong>通过依赖注入实现组合关系</strong></li><li><strong>降低类之间的耦合度，提高系统的灵活性</strong></li></ul><h2 id="2-SpringBoot中的应用方式-1"><a href="#2-SpringBoot中的应用方式-1" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-组合替代继承"><a href="#2-1-组合替代继承" class="headerlink" title="2.1 组合替代继承"></a>2.1 组合替代继承</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反CRP的反例 - 使用继承导致的问题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        validate(order);</span><br><span class="line">        calculateTotal(order);</span><br><span class="line">        save(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(Order order)</span> &#123; <span class="comment">/* 基础验证 */</span> &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">calculateTotal</span><span class="params">(Order order)</span> &#123; <span class="comment">/* 基础计算 */</span> &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Order order)</span> &#123; <span class="comment">/* 基础保存 */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特殊订单处理 - 继承导致的问题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GroupOrderProcessor</span> <span class="keyword">extends</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">calculateTotal</span><span class="params">(GroupOrder order)</span> &#123;</span><br><span class="line">        <span class="comment">// 需要重新实现大部分逻辑，只是修改了计算方式</span></span><br><span class="line">        <span class="comment">// 违反了&quot;is-a&quot;关系，GroupOrderProcessor并不是一种OrderProcessor</span></span><br><span class="line">        <span class="built_in">super</span>.validate(order);</span><br><span class="line">        <span class="comment">// 团购特有的计算逻辑</span></span><br><span class="line">        calculateGroupDiscount(order);</span><br><span class="line">        <span class="built_in">super</span>.save(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">calculateGroupDiscount</span><span class="params">(GroupOrder order)</span> &#123;</span><br><span class="line">        <span class="comment">// 团购折扣计算</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合CRP的正确设计 - 使用组合</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator validator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator calculator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Saver saver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderProcessor</span><span class="params">(Validator validator, Calculator calculator, Saver saver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.validator = validator;</span><br><span class="line">        <span class="built_in">this</span>.calculator = calculator;</span><br><span class="line">        <span class="built_in">this</span>.saver = saver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        validator.validate(order);</span><br><span class="line">        calculator.calculateTotal(order);</span><br><span class="line">        saver.save(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过组合实现不同策略</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StandardOrderProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator standardValidator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator standardCalculator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Saver standardSaver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StandardOrderProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.standardValidator = <span class="keyword">new</span> <span class="title class_">StandardValidator</span>();</span><br><span class="line">        <span class="built_in">this</span>.standardCalculator = <span class="keyword">new</span> <span class="title class_">StandardCalculator</span>();</span><br><span class="line">        <span class="built_in">this</span>.standardSaver = <span class="keyword">new</span> <span class="title class_">DatabaseSaver</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 或者通过依赖注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StandardOrderProcessor</span><span class="params">(Validator validator, Calculator calculator, Saver saver)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.standardValidator = validator;</span><br><span class="line">        <span class="built_in">this</span>.standardCalculator = calculator;</span><br><span class="line">        <span class="built_in">this</span>.standardSaver = saver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupOrderProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator groupValidator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Calculator groupCalculator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Saver groupSaver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GroupOrderProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.groupValidator = <span class="keyword">new</span> <span class="title class_">GroupValidator</span>();</span><br><span class="line">        <span class="built_in">this</span>.groupCalculator = <span class="keyword">new</span> <span class="title class_">GroupCalculator</span>();</span><br><span class="line">        <span class="built_in">this</span>.groupSaver = <span class="keyword">new</span> <span class="title class_">DatabaseSaver</span>(); <span class="comment">// 可以复用保存逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-Spring中的依赖注入实现组合"><a href="#2-2-Spring中的依赖注入实现组合" class="headerlink" title="2.2 Spring中的依赖注入实现组合"></a>2.2 Spring中的依赖注入实现组合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义可组合的组件接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, Object value)</span>;</span><br><span class="line">    Object <span class="title function_">get</span><span class="params">(String key)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(String metric, <span class="type">long</span> value)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File Log: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Redis Cache PUT: &quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Redis Cache GET: &quot;</span> + key);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrometheusMetrics</span> <span class="keyword">implements</span> <span class="title class_">MetricsCollector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(String metric, <span class="type">long</span> value)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Metrics: &quot;</span> + metric + <span class="string">&quot; = &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 业务服务通过组合使用这些组件</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MetricsCollector metrics;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过构造器注入所有需要的组件</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository, </span></span><br><span class="line"><span class="params">                       Logger logger, </span></span><br><span class="line"><span class="params">                       Cache cache,</span></span><br><span class="line"><span class="params">                       MetricsCollector metrics)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">        <span class="built_in">this</span>.logger = logger;</span><br><span class="line">        <span class="built_in">this</span>.cache = cache;</span><br><span class="line">        <span class="built_in">this</span>.metrics = metrics;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 记录指标</span></span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.start&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 尝试从缓存获取</span></span><br><span class="line">            <span class="type">UserDTO</span> <span class="variable">cached</span> <span class="operator">=</span> (UserDTO) cache.get(<span class="string">&quot;user:&quot;</span> + id);</span><br><span class="line">            <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">                metrics.record(<span class="string">&quot;user.get.cache.hit&quot;</span>, <span class="number">1</span>);</span><br><span class="line">                logger.log(<span class="string">&quot;Cache hit for user: &quot;</span> + id);</span><br><span class="line">                <span class="keyword">return</span> cached;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从数据库获取</span></span><br><span class="line">            <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;User not found&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 存入缓存</span></span><br><span class="line">            cache.put(<span class="string">&quot;user:&quot;</span> + id, user);</span><br><span class="line"></span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.success&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            logger.log(<span class="string">&quot;Retrieved user: &quot;</span> + id);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.error&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            logger.log(<span class="string">&quot;Error retrieving user: &quot;</span> + id + <span class="string">&quot;, error: &quot;</span> + e.getMessage());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            metrics.record(<span class="string">&quot;user.get.duration&quot;</span>, duration);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-动态组合与策略模式"><a href="#2-3-动态组合与策略模式" class="headerlink" title="2.3 动态组合与策略模式"></a>2.3 动态组合与策略模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付策略接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    PaymentResult <span class="title function_">pay</span><span class="params">(PaymentRequest request)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(PaymentType type)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体支付策略</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">pay</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Alipay payment processing...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResult</span>(<span class="literal">true</span>, <span class="string">&quot;Alipay success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(PaymentType type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> PaymentType.ALIPAY == type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">pay</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Wechat Pay processing...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResult</span>(<span class="literal">true</span>, <span class="string">&quot;Wechat Pay success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(PaymentType type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> PaymentType.WECHAT_PAY == type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支付服务通过组合多个策略</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;PaymentStrategy&gt; paymentStrategies;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Spring会自动注入所有PaymentStrategy实现</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentService</span><span class="params">(List&lt;PaymentStrategy&gt; paymentStrategies)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategies = paymentStrategies;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">processPayment</span><span class="params">(PaymentRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 根据支付类型选择合适的策略</span></span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> paymentStrategies.stream()</span><br><span class="line">        .filter(s -&gt; s.supports(request.getPaymentType()))</span><br><span class="line">        .findFirst()</span><br><span class="line">        .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UnsupportedPaymentTypeException</span>(<span class="string">&quot;Unsupported payment type&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> strategy.pay(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态添加新的支付策略</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPaymentStrategy</span><span class="params">(PaymentStrategy strategy)</span> &#123;</span><br><span class="line">        paymentStrategies.add(strategy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-SpringCloud中的应用方式-1"><a href="#3-SpringCloud中的应用方式-1" class="headerlink" title="3. SpringCloud中的应用方式"></a>3. SpringCloud中的应用方式</h2><h3 id="3-1-微服务功能的组合"><a href="#3-1-微服务功能的组合" class="headerlink" title="3.1 微服务功能的组合"></a>3.1 微服务功能的组合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义微服务的能力接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CircuitBreaker</span> &#123;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">execute</span><span class="params">(Supplier&lt;T&gt; supplier, Supplier&lt;T&gt; fallback)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RateLimiter</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">allowRequest</span><span class="params">(String key, <span class="type">int</span> limit)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RetryPolicy</span> &#123;</span><br><span class="line">    &lt;T&gt; T <span class="title function_">execute</span><span class="params">(Supplier&lt;T&gt; supplier)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line">    ServiceInstance <span class="title function_">choose</span><span class="params">(String serviceId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Resilience4jCircuitBreaker</span> <span class="keyword">implements</span> <span class="title class_">CircuitBreaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">CircuitBreakerRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> CircuitBreakerRegistry.ofDefaults();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(Supplier&lt;T&gt; supplier, Supplier&lt;T&gt; fallback)</span> &#123;</span><br><span class="line">        <span class="type">CircuitBreaker</span> <span class="variable">cb</span> <span class="operator">=</span> registry.circuitBreaker(<span class="string">&quot;default&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cb.executeSupplier(supplier);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisRateLimiter</span> <span class="keyword">implements</span> <span class="title class_">RateLimiter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">allowRequest</span><span class="params">(String key, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="comment">// Redis限流逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微服务客户端组合多种能力</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResilientServiceClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CircuitBreaker circuitBreaker;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RateLimiter rateLimiter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RetryPolicy retryPolicy;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoadBalancer loadBalancer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResilientServiceClient</span><span class="params">(RestTemplate restTemplate,</span></span><br><span class="line"><span class="params">                                  CircuitBreaker circuitBreaker,</span></span><br><span class="line"><span class="params">                                  RateLimiter rateLimiter,</span></span><br><span class="line"><span class="params">                                  RetryPolicy retryPolicy,</span></span><br><span class="line"><span class="params">                                  LoadBalancer loadBalancer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplate;</span><br><span class="line">        <span class="built_in">this</span>.circuitBreaker = circuitBreaker;</span><br><span class="line">        <span class="built_in">this</span>.rateLimiter = rateLimiter;</span><br><span class="line">        <span class="built_in">this</span>.retryPolicy = retryPolicy;</span><br><span class="line">        <span class="built_in">this</span>.loadBalancer = loadBalancer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">callService</span><span class="params">(String serviceName, String endpoint, Class&lt;T&gt; responseType)</span> &#123;</span><br><span class="line">        <span class="comment">// 组合使用各种能力</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> serviceName + <span class="string">&quot;:&quot;</span> + endpoint;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!rateLimiter.allowRequest(key, <span class="number">100</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RateLimitExceededException</span>(<span class="string">&quot;Rate limit exceeded&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> circuitBreaker.execute(</span><br><span class="line">            () -&gt; retryPolicy.execute(() -&gt; &#123;</span><br><span class="line">                <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> loadBalancer.choose(serviceName);</span><br><span class="line">                <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> buildUrl(instance, endpoint);</span><br><span class="line">                <span class="keyword">return</span> restTemplate.getForObject(url, responseType);</span><br><span class="line">            &#125;),</span><br><span class="line">            () -&gt; getFallbackResponse(responseType)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">buildUrl</span><span class="params">(ServiceInstance instance, String endpoint)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http://&quot;</span> + instance.getHost() + <span class="string">&quot;:&quot;</span> + instance.getPort() + endpoint;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; T <span class="title function_">getFallbackResponse</span><span class="params">(Class&lt;T&gt; responseType)</span> &#123;</span><br><span class="line">        <span class="comment">// 返回兜底响应</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-配置管理的组合"><a href="#3-2-配置管理的组合" class="headerlink" title="3.2 配置管理的组合"></a>3.2 配置管理的组合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置源接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    String <span class="title function_">getValue</span><span class="params">(String key)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体配置源</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnvironmentConfigSource</span> <span class="keyword">implements</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> System.getenv(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> System.getenv(key) != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConfigSource</span> <span class="keyword">implements</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 从数据库获取配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 检查数据库中是否存在配置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteConfigSource</span> <span class="keyword">implements</span> <span class="title class_">ConfigSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 从远程配置中心获取</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// 检查远程配置中心</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置管理器组合多个配置源</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompositeConfigService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ConfigSource&gt; configSources;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CompositeConfigService</span><span class="params">(List&lt;ConfigSource&gt; configSources)</span> &#123;</span><br><span class="line">        <span class="comment">// 按优先级排序：环境变量 &gt; 数据库 &gt; 远程配置</span></span><br><span class="line">        <span class="built_in">this</span>.configSources = configSources.stream()</span><br><span class="line">        .sorted((a, b) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (a <span class="keyword">instanceof</span> EnvironmentConfigSource) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (b <span class="keyword">instanceof</span> EnvironmentConfigSource) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (a <span class="keyword">instanceof</span> DatabaseConfigSource) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (b <span class="keyword">instanceof</span> DatabaseConfigSource) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfig</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ConfigSource source : configSources) &#123;</span><br><span class="line">            <span class="keyword">if</span> (source.containsKey(key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> source.getValue(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigNotFoundException</span>(<span class="string">&quot;Config not found: &quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态添加新的配置源</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addConfigSource</span><span class="params">(ConfigSource configSource, <span class="type">int</span> priority)</span> &#123;</span><br><span class="line">        configSources.add(priority, configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-最佳实践场景-1"><a href="#4-最佳实践场景-1" class="headerlink" title="4. 最佳实践场景"></a>4. 最佳实践场景</h2><h3 id="4-1-模板方法模式的组合实现"><a href="#4-1-模板方法模式的组合实现" class="headerlink" title="4.1 模板方法模式的组合实现"></a>4.1 模板方法模式的组合实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用组合替代模板方法模式中的继承</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Step</span>&lt;T, R&gt; &#123;</span><br><span class="line">    R <span class="title function_">execute</span><span class="params">(T input)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体步骤</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidationStep</span> <span class="keyword">implements</span> <span class="title class_">Step</span>&lt;Order, ValidationResult&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ValidationResult <span class="title function_">execute</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 验证逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ValidationResult</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PricingStep</span> <span class="keyword">implements</span> <span class="title class_">Step</span>&lt;Order, PricingResult&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PricingResult <span class="title function_">execute</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 定价逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PricingResult</span>(BigDecimal.valueOf(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersistenceStep</span> <span class="keyword">implements</span> <span class="title class_">Step</span>&lt;Order, Void&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Void <span class="title function_">execute</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 持久化逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 流程编排器组合各个步骤</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderProcessingPipeline</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Step&lt;?, ?&gt;&gt; steps;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderProcessingPipeline</span><span class="params">(List&lt;Step&lt;?, ?&gt;&gt; steps)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.steps = steps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> OrderResult <span class="title function_">process</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">context</span> <span class="operator">=</span> order;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Step step : steps) &#123;</span><br><span class="line">            <span class="keyword">if</span> (step <span class="keyword">instanceof</span> Step) &#123;</span><br><span class="line">                context = ((Step&lt;Order, ?&gt;) step).execute((Order) context);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 如果某步失败，可以中断流程</span></span><br><span class="line">                <span class="keyword">if</span> (context <span class="keyword">instanceof</span> ValidationResult &amp;&amp; !((ValidationResult) context).isValid()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> OrderResult.failure(<span class="string">&quot;Validation failed&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> OrderResult.success((Order) context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态添加步骤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStep</span><span class="params">(Step&lt;?, ?&gt; step)</span> &#123;</span><br><span class="line">        steps.add(step);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-装饰器模式的组合应用"><a href="#4-2-装饰器模式的组合应用" class="headerlink" title="4.2 装饰器模式的组合应用"></a>4.2 装饰器模式的组合应用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line">    String <span class="title function_">fetchData</span><span class="params">(String key)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicDataService</span> <span class="keyword">implements</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Basic data for: &quot;</span> + key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器 - 添加缓存功能</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachingDataService</span> <span class="keyword">implements</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataService delegate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Cache cache;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CachingDataService</span><span class="params">(DataService delegate, Cache cache)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">        <span class="built_in">this</span>.cache = cache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheKey</span> <span class="operator">=</span> <span class="string">&quot;data:&quot;</span> + key;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cached</span> <span class="operator">=</span> (String) cache.get(cacheKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cached != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> cached;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> delegate.fetchData(key);</span><br><span class="line">        cache.put(cacheKey, data);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器 - 添加日志功能</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingDataService</span> <span class="keyword">implements</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataService delegate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggingDataService</span><span class="params">(DataService delegate, Logger logger)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">        <span class="built_in">this</span>.logger = logger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        logger.log(<span class="string">&quot;Fetching data for key: &quot;</span> + key);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> delegate.fetchData(key);</span><br><span class="line">            logger.log(<span class="string">&quot;Successfully fetched data for key: &quot;</span> + key);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">            logger.log(<span class="string">&quot;Data fetch took: &quot;</span> + duration + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用组合的装饰器链</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataServiceFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BasicDataService basicService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Cache cache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Logger logger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> DataService <span class="title function_">createDataService</span><span class="params">(<span class="type">boolean</span> enableCaching, <span class="type">boolean</span> enableLogging)</span> &#123;</span><br><span class="line">        <span class="type">DataService</span> <span class="variable">service</span> <span class="operator">=</span> basicService;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (enableCaching) &#123;</span><br><span class="line">            service = <span class="keyword">new</span> <span class="title class_">CachingDataService</span>(service, cache);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (enableLogging) &#123;</span><br><span class="line">            service = <span class="keyword">new</span> <span class="title class_">LoggingDataService</span>(service, logger);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-优势总结-1"><a href="#5-优势总结-1" class="headerlink" title="5. 优势总结"></a>5. 优势总结</h2><ol><li><strong>灵活性</strong>：可以在运行时动态组合不同的功能</li><li><strong>松耦合</strong>：组件之间通过接口交互，不直接依赖具体实现</li><li><strong>可测试性</strong>：容易模拟和替换组件进行测试</li><li><strong>可维护性</strong>：修改一个组件不会影响其他组件</li><li><strong>符合开闭原则</strong>：新增功能通过添加新组件而非修改现有代码</li><li><strong>避免继承的缺点</strong>：避免菱形继承、脆弱基类等问题</li></ol><h2 id="6-实践建议"><a href="#6-实践建议" class="headerlink" title="6. 实践建议"></a>6. 实践建议</h2><ol><li><strong>识别”has-a”关系时使用组合而非继承</strong></li><li><strong>通过Spring的依赖注入管理组件生命周期</strong></li><li><strong>使用接口定义组件契约</strong></li><li><strong>合理设计组件的粒度</strong></li><li><strong>利用Java 8+的函数式接口增强组合能力</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用函数式接口增强组合</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionalPipelineService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T, R&gt; Function&lt;T, R&gt; <span class="title function_">composeFunctions</span><span class="params">(List&lt;Function&lt;T, R&gt;&gt; functions)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> functions.stream()</span><br><span class="line">        .reduce(Function.identity(), Function::andThen);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exampleUsage</span><span class="params">()</span> &#123;</span><br><span class="line">        Function&lt;Order, Order&gt; pipeline = composeFunctions(Arrays.asList(</span><br><span class="line">            <span class="built_in">this</span>::validateOrder,</span><br><span class="line">            <span class="built_in">this</span>::calculatePrice,</span><br><span class="line">            <span class="built_in">this</span>::applyDiscounts,</span><br><span class="line">            <span class="built_in">this</span>::saveOrder</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">        <span class="type">Order</span> <span class="variable">result</span> <span class="operator">=</span> pipeline.apply(<span class="keyword">new</span> <span class="title class_">Order</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">validateOrder</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">calculatePrice</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">applyDiscounts</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">    <span class="keyword">private</span> Order <span class="title function_">saveOrder</span><span class="params">(Order order)</span> &#123; <span class="keyword">return</span> order; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在SpringBoot&#x2F;SpringCloud中，合成复用原则是构建灵活、可维护微服务架构的基石。Spring框架本身的依赖注入机制就是CRP的典型应用，通过组合各种Bean来构建复杂的应用功能。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>迪米特原则在SpringBoot/SpringCloud中的应用</title>
      <link href="/2026/02/03/%E8%BF%AA%E7%B1%B3%E7%89%B9%E5%8E%9F%E5%88%99%202026_2_3/"/>
      <url>/2026/02/03/%E8%BF%AA%E7%B1%B3%E7%89%B9%E5%8E%9F%E5%88%99%202026_2_3/</url>
      
        <content type="html"><![CDATA[<h1 id="迪米特原则-LoD-在SpringBoot-SpringCloud中的应用"><a href="#迪米特原则-LoD-在SpringBoot-SpringCloud中的应用" class="headerlink" title="迪米特原则(LoD)在SpringBoot&#x2F;SpringCloud中的应用"></a>迪米特原则(LoD)在SpringBoot&#x2F;SpringCloud中的应用</h1><p>迪米特原则(Law of Demeter, LoD)，也称为最少知识原则(Least Knowledge Principle)，它规定：一个对象应当对其他对象有最少的了解，只与直接的朋友通信。</p><h2 id="1-核心概念"><a href="#1-核心概念" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>迪米特原则的关键思想：</p><ul><li><strong>只与直接朋友通信</strong>：不要跟”陌生人”说话</li><li><strong>降低类之间的耦合度</strong>：减少对象间的依赖关系</li><li><strong>“朋友”包括</strong>：当前对象本身、成员对象、方法参数对象、方法返回值对象</li><li><strong>避免链式调用</strong>：如 <code>a.getB().getC().doSomething()</code></li></ul><h2 id="2-SpringBoot中的应用方式"><a href="#2-SpringBoot中的应用方式" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-避免链式调用"><a href="#2-1-避免链式调用" class="headerlink" title="2.1 避免链式调用"></a>2.1 避免链式调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反LoD的反例 - 链式调用</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 违反LoD：OrderService不应该知道User的内部结构</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> orderRepository.findById(orderId).getUser();</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> user.getProfile().getAddress();</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> address.getCity();</span><br><span class="line">        <span class="type">String</span> <span class="variable">cityCode</span> <span class="operator">=</span> city.getCode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用城市代码进行业务逻辑处理</span></span><br><span class="line">        logisticsService.calculateShipping(cityCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合LoD的正确设计 - 引入中间层</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过Order对象直接获取所需信息</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderRepository.findById(orderId);</span><br><span class="line">        <span class="type">ShippingInfo</span> <span class="variable">shippingInfo</span> <span class="operator">=</span> order.getShippingInfo();</span><br><span class="line"></span><br><span class="line">        logisticsService.calculateShipping(shippingInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Order类封装内部细节</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 封装对用户内部结构的访问</span></span><br><span class="line">    <span class="keyword">public</span> ShippingInfo <span class="title function_">getShippingInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> user.getProfile().getAddress();</span><br><span class="line">        <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> address.getCity();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ShippingInfo</span>(city.getCode(), city.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 值对象封装相关信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShippingInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String cityCode;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String cityName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ShippingInfo</span><span class="params">(String cityCode, String cityName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cityCode = cityCode;</span><br><span class="line">        <span class="built_in">this</span>.cityName = cityName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-使用DTO减少知识暴露"><a href="#2-2-使用DTO减少知识暴露" class="headerlink" title="2.2 使用DTO减少知识暴露"></a>2.2 使用DTO减少知识暴露</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反LoD的反例 - 暴露领域模型内部结构</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; getUserDetails(<span class="meta">@PathVariable</span> Long id) &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 违反LoD：Controller不应该知道User的内部结构</span></span><br><span class="line">        Map&lt;String, Object&gt; details = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        details.put(<span class="string">&quot;name&quot;</span>, user.getProfile().getName());</span><br><span class="line">        details.put(<span class="string">&quot;email&quot;</span>, user.getAccount().getEmail());</span><br><span class="line">        details.put(<span class="string">&quot;department&quot;</span>, user.getDepartment().getName());</span><br><span class="line">        details.put(<span class="string">&quot;manager&quot;</span>, user.getDepartment().getManager().getName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(details);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合LoD的正确设计 - 使用DTO</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserDTO&gt; <span class="title function_">getUserDetails</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> userService.getUserDetails(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务层封装转换逻辑</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserDetails</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(id)</span><br><span class="line">        .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;User not found&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UserDTO.from(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DTO封装所需展示的信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> String departmentName;</span><br><span class="line">    <span class="keyword">private</span> String managerName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态工厂方法封装转换逻辑</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserDTO <span class="title function_">from</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        dto.name = user.getProfile().getName();</span><br><span class="line">        dto.email = user.getAccount().getEmail();</span><br><span class="line">        dto.departmentName = user.getDepartment().getName();</span><br><span class="line">        dto.managerName = user.getDepartment().getManager().getName();</span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-使用门面模式简化接口"><a href="#2-3-使用门面模式简化接口" class="headerlink" title="2.3 使用门面模式简化接口"></a>2.3 使用门面模式简化接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复杂子系统</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderSubsystem</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">findOrder</span><span class="params">(Long id)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Order</span>(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validateOrder</span><span class="params">(Order order)</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">calculateTotal</span><span class="params">(Order order)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> BigDecimal.ZERO; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentSubsystem</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">processPayment</span><span class="params">(Order order)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResult</span>(); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refundPayment</span><span class="params">(Long paymentId)</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventorySubsystem</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAvailability</span><span class="params">(Order order)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reserveItems</span><span class="params">(Order order)</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 违反LoD的反例 - 客户端需要知道所有子系统</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComplexOrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderSubsystem orderSubsystem;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentSubsystem paymentSubsystem;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventorySubsystem inventorySubsystem;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processCompleteOrder</span><span class="params">(OrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 违反LoD：客户端需要知道太多子系统的细节</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderSubsystem.findOrder(request.getOrderId());</span><br><span class="line">        orderSubsystem.validateOrder(order);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">available</span> <span class="operator">=</span> inventorySubsystem.checkAvailability(order);</span><br><span class="line">        <span class="keyword">if</span> (!available) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientInventoryException</span>(<span class="string">&quot;Insufficient inventory&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        inventorySubsystem.reserveItems(order);</span><br><span class="line"></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">total</span> <span class="operator">=</span> orderSubsystem.calculateTotal(order);</span><br><span class="line">        <span class="type">PaymentResult</span> <span class="variable">payment</span> <span class="operator">=</span> paymentSubsystem.processPayment(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!payment.isSuccess()) &#123;</span><br><span class="line">            inventorySubsystem.releaseReservation(order); <span class="comment">// 回滚库存</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PaymentFailedException</span>(<span class="string">&quot;Payment failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合LoD的正确设计 - 使用门面模式</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFacade</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderSubsystem orderSubsystem;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentSubsystem paymentSubsystem;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventorySubsystem inventorySubsystem;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CompleteOrderResult <span class="title function_">processCompleteOrder</span><span class="params">(OrderRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 门面封装所有子系统的复杂性</span></span><br><span class="line">        <span class="keyword">return</span> CompleteOrderResult.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">simpleProcessOrder</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 提供简化的接口</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderSubsystem.findOrder(orderId);</span><br><span class="line">        orderSubsystem.validateOrder(order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 内部处理所有复杂性</span></span><br><span class="line">        internalProcessOrder(order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">internalProcessOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 内部实现，对外隐藏复杂性</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">available</span> <span class="operator">=</span> inventorySubsystem.checkAvailability(order);</span><br><span class="line">        <span class="keyword">if</span> (!available) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientInventoryException</span>(<span class="string">&quot;Insufficient inventory&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        inventorySubsystem.reserveItems(order);</span><br><span class="line"></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">total</span> <span class="operator">=</span> orderSubsystem.calculateTotal(order);</span><br><span class="line">        <span class="type">PaymentResult</span> <span class="variable">payment</span> <span class="operator">=</span> paymentSubsystem.processPayment(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!payment.isSuccess()) &#123;</span><br><span class="line">            inventorySubsystem.releaseReservation(order);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PaymentFailedException</span>(<span class="string">&quot;Payment failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端只需要与门面交互</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleOrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderFacade orderFacade;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 符合LoD：只需要知道OrderFacade这一个&quot;朋友&quot;</span></span><br><span class="line">        orderFacade.simpleProcessOrder(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-SpringCloud中的应用方式"><a href="#3-SpringCloud中的应用方式" class="headerlink" title="3. SpringCloud中的应用方式"></a>3. SpringCloud中的应用方式</h2><h3 id="3-1-微服务间通信的门面模式"><a href="#3-1-微服务间通信的门面模式" class="headerlink" title="3.1 微服务间通信的门面模式"></a>3.1 微服务间通信的门面模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户服务内部的复杂结构</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceInternal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">(Long id)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(); &#125;</span><br><span class="line">    <span class="keyword">public</span> Profile <span class="title function_">getProfile</span><span class="params">(User user)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Profile</span>(); &#125;</span><br><span class="line">    <span class="keyword">public</span> Department <span class="title function_">getDepartment</span><span class="params">(User user)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Department</span>(); &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Permission&gt; <span class="title function_">getPermissions</span><span class="params">(User user)</span> &#123; <span class="comment">/* ... */</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 违反LoD的反例 - 网关或BFF知道太多内部细节</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user-details&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserServiceClient userServiceClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">getUserComplexDetails</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 违反LoD：BFF不应该知道用户服务的内部数据结构</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userServiceClient.getUser(userId);</span><br><span class="line">        <span class="type">Profile</span> <span class="variable">profile</span> <span class="operator">=</span> userServiceClient.getUserProfile(userId);</span><br><span class="line">        <span class="type">Department</span> <span class="variable">dept</span> <span class="operator">=</span> userServiceClient.getUserDepartment(userId);</span><br><span class="line">        List&lt;Permission&gt; permissions = userServiceClient.getUserPermissions(userId);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; details = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        details.put(<span class="string">&quot;basic&quot;</span>, user);</span><br><span class="line">        details.put(<span class="string">&quot;profile&quot;</span>, profile);</span><br><span class="line">        details.put(<span class="string">&quot;department&quot;</span>, dept);</span><br><span class="line">        details.put(<span class="string">&quot;permissions&quot;</span>, permissions);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(details);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合LoD的正确设计 - BFF提供简洁接口</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user-details&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsFacade userDetailsFacade;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserDetailsDTO&gt; <span class="title function_">getUserDetails</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 符合LoD：只需要与UserDetailsFacade通信</span></span><br><span class="line">        <span class="type">UserDetailsDTO</span> <span class="variable">details</span> <span class="operator">=</span> userDetailsFacade.getUserDetails(userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(details);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BFF中的门面封装微服务复杂性</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsFacade</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserServiceClient userServiceClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserDetailsDTO <span class="title function_">getUserDetails</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 内部调用多个微服务，但对外部隐藏复杂性</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userServiceClient.getUser(userId);</span><br><span class="line">        <span class="type">Profile</span> <span class="variable">profile</span> <span class="operator">=</span> userServiceClient.getUserProfile(userId);</span><br><span class="line">        <span class="type">Department</span> <span class="variable">dept</span> <span class="operator">=</span> userServiceClient.getUserDepartment(userId);</span><br><span class="line">        List&lt;Permission&gt; permissions = userServiceClient.getUserPermissions(userId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UserDetailsDTO.builder()</span><br><span class="line">        .userId(user.getId())</span><br><span class="line">        .fullName(profile.getFirstName() + <span class="string">&quot; &quot;</span> + profile.getLastName())</span><br><span class="line">        .email(user.getEmail())</span><br><span class="line">        .departmentName(dept.getName())</span><br><span class="line">        .position(profile.getPosition())</span><br><span class="line">        .permissionCodes(permissions.stream()</span><br><span class="line">                         .map(Permission::getCode)</span><br><span class="line">                         .collect(Collectors.toList()))</span><br><span class="line">        .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-API网关的路由隔离"><a href="#3-2-API网关的路由隔离" class="headerlink" title="3.2 API网关的路由隔离"></a>3.2 API网关的路由隔离</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反LoD的反例 - 网关直接暴露所有微服务细节</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComplexGatewayConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">complexRoutes</span><span class="params">(RouteLocatorBuilder builder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">        .route(<span class="string">&quot;user-route&quot;</span>, r -&gt; r.path(<span class="string">&quot;/users/**&quot;</span>)</span><br><span class="line">               .filters(f -&gt; f.stripPrefix(<span class="number">1</span>)</span><br><span class="line">                        .requestHeaderToRequestUri(<span class="string">&quot;X-Forward-To&quot;</span>, <span class="string">&quot;http://user-service:8080&quot;</span>)</span><br><span class="line">                        .setPath(<span class="string">&quot;/internal/**&quot;</span>)) <span class="comment">// 暴露内部路径</span></span><br><span class="line">               .uri(<span class="string">&quot;lb://user-service&quot;</span>))</span><br><span class="line">        .route(<span class="string">&quot;order-route&quot;</span>, r -&gt; r.path(<span class="string">&quot;/orders/**&quot;</span>)</span><br><span class="line">               .filters(f -&gt; f.stripPrefix(<span class="number">1</span>)</span><br><span class="line">                        .setPath(<span class="string">&quot;/api/v2/**&quot;</span>)) <span class="comment">// 暴露API版本</span></span><br><span class="line">               .uri(<span class="string">&quot;lb://order-service&quot;</span>))</span><br><span class="line">        .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合LoD的正确设计 - 网关提供统一的外部接口</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleGatewayConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">simpleRoutes</span><span class="params">(RouteLocatorBuilder builder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> builder.routes()</span><br><span class="line">        .route(<span class="string">&quot;user-info&quot;</span>, r -&gt; r.path(<span class="string">&quot;/user-info/**&quot;</span>)</span><br><span class="line">               .filters(f -&gt; f.stripPrefix(<span class="number">1</span>)</span><br><span class="line">                        .setPath(<span class="string">&quot;/public-api/users/**&quot;</span>)) <span class="comment">// 统一外部API路径</span></span><br><span class="line">               .uri(<span class="string">&quot;lb://user-service&quot;</span>))</span><br><span class="line">        .route(<span class="string">&quot;order-management&quot;</span>, r -&gt; r.path(<span class="string">&quot;/orders/**&quot;</span>)</span><br><span class="line">               .filters(f -&gt; f.stripPrefix(<span class="number">1</span>)</span><br><span class="line">                        .setPath(<span class="string">&quot;/public-api/orders/**&quot;</span>)) <span class="comment">// 隐藏内部版本</span></span><br><span class="line">               .uri(<span class="string">&quot;lb://order-service&quot;</span>))</span><br><span class="line">        .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-最佳实践场景"><a href="#4-最佳实践场景" class="headerlink" title="4. 最佳实践场景"></a>4. 最佳实践场景</h2><h3 id="4-1-使用建造者模式封装对象创建"><a href="#4-1-使用建造者模式封装对象创建" class="headerlink" title="4.1 使用建造者模式封装对象创建"></a>4.1 使用建造者模式封装对象创建</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 违反LoD的反例 - 客户端需要知道对象创建的复杂过程</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateMonthlyReport</span><span class="params">(Long departmentId)</span> &#123;</span><br><span class="line">        <span class="comment">// 违反LoD：客户端不应该知道Report对象的复杂构建过程</span></span><br><span class="line">        <span class="type">Report</span> <span class="variable">report</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Report</span>();</span><br><span class="line">        report.setTitle(<span class="string">&quot;Monthly Report&quot;</span>);</span><br><span class="line">        report.setDepartmentId(departmentId);</span><br><span class="line">        report.setStartDate(LocalDate.now().minusMonths(<span class="number">1</span>));</span><br><span class="line">        report.setEndDate(LocalDate.now());</span><br><span class="line"></span><br><span class="line">        <span class="type">Department</span> <span class="variable">dept</span> <span class="operator">=</span> departmentRepository.findById(departmentId);</span><br><span class="line">        List&lt;User&gt; users = userRepository.findByDepartment(dept);</span><br><span class="line">        report.setEmployeeCount(users.size());</span><br><span class="line"></span><br><span class="line">        <span class="type">PerformanceCalculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PerformanceCalculator</span>();</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">avgPerformance</span> <span class="operator">=</span> calculator.calculateAveragePerformance(users);</span><br><span class="line">        report.setAveragePerformance(avgPerformance);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置更多属性...</span></span><br><span class="line"></span><br><span class="line">        reportRepository.save(report);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合LoD的正确设计 - 使用建造者模式</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateMonthlyReport</span><span class="params">(Long departmentId)</span> &#123;</span><br><span class="line">        <span class="comment">// 符合LoD：通过建造者封装复杂创建过程</span></span><br><span class="line">        <span class="type">MonthlyReportBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MonthlyReportBuilder</span>(departmentId);</span><br><span class="line">        <span class="type">Report</span> <span class="variable">report</span> <span class="operator">=</span> builder</span><br><span class="line">        .forPeriod(MonthlyPeriod.lastMonth())</span><br><span class="line">        .includeEmployeeStats()</span><br><span class="line">        .includePerformanceMetrics()</span><br><span class="line">        .includeDepartmentInfo()</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">        reportRepository.save(report);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建造者封装创建细节</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonthlyReportBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long departmentId;</span><br><span class="line">    <span class="keyword">private</span> Period period;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">includeEmployeeStats</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">includePerformanceMetrics</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">includeDepartmentInfo</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MonthlyReportBuilder</span><span class="params">(Long departmentId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.departmentId = departmentId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MonthlyReportBuilder <span class="title function_">forPeriod</span><span class="params">(Period period)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.period = period;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MonthlyReportBuilder <span class="title function_">includeEmployeeStats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.includeEmployeeStats = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MonthlyReportBuilder <span class="title function_">includePerformanceMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.includePerformanceMetrics = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MonthlyReportBuilder <span class="title function_">includeDepartmentInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.includeDepartmentInfo = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Report <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Report</span> <span class="variable">report</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Report</span>();</span><br><span class="line">        report.setDepartmentId(departmentId);</span><br><span class="line">        report.setPeriod(period);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (includeEmployeeStats) &#123;</span><br><span class="line">            enrichWithEmployeeStats(report);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (includePerformanceMetrics) &#123;</span><br><span class="line">            enrichWithPerformanceMetrics(report);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (includeDepartmentInfo) &#123;</span><br><span class="line">            enrichWithDepartmentInfo(report);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> report;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enrichWithEmployeeStats</span><span class="params">(Report report)</span> &#123;</span><br><span class="line">        <span class="comment">// 内部实现细节，对外隐藏</span></span><br><span class="line">        <span class="type">Department</span> <span class="variable">dept</span> <span class="operator">=</span> departmentRepository.findById(departmentId);</span><br><span class="line">        List&lt;User&gt; users = userRepository.findByDepartment(dept);</span><br><span class="line">        report.setEmployeeCount(users.size());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enrichWithPerformanceMetrics</span><span class="params">(Report report)</span> &#123;</span><br><span class="line">        <span class="comment">// 内部实现细节，对外隐藏</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enrichWithDepartmentInfo</span><span class="params">(Report report)</span> &#123;</span><br><span class="line">        <span class="comment">// 内部实现细节，对外隐藏</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-使用中介者模式减少直接通信"><a href="#4-2-使用中介者模式减少直接通信" class="headerlink" title="4.2 使用中介者模式减少直接通信"></a>4.2 使用中介者模式减少直接通信</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多个组件直接相互通信 - 违反LoD</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComplexWorkflow</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> NotificationService notificationService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 违反LoD：多个组件直接相互了解</span></span><br><span class="line">        orderService.validate(order);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">available</span> <span class="operator">=</span> inventoryService.checkAvailability(order);</span><br><span class="line">        <span class="keyword">if</span> (!available) &#123;</span><br><span class="line">            notificationService.notifyAdmin(<span class="string">&quot;Inventory issue for order: &quot;</span> + order.getId());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        inventoryService.reserveItems(order);</span><br><span class="line"></span><br><span class="line">        <span class="type">PaymentResult</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.processPayment(order);</span><br><span class="line">        <span class="keyword">if</span> (!payment.isSuccess()) &#123;</span><br><span class="line">            inventoryService.releaseReservation(order);</span><br><span class="line">            notificationService.notifyCustomer(<span class="string">&quot;Payment failed for order: &quot;</span> + order.getId());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        orderService.confirm(order);</span><br><span class="line">        notificationService.notifyCustomer(<span class="string">&quot;Order confirmed: &quot;</span> + order.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 符合LoD的正确设计 - 使用中介者模式</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderProcessingMediator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> NotificationService notificationService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 中介者封装所有协调逻辑</span></span><br><span class="line">        <span class="type">ProcessContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessContext</span>(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            orderService.validate(context);</span><br><span class="line">            inventoryService.checkAndReserve(context);</span><br><span class="line">            paymentService.process(context);</span><br><span class="line">            orderService.confirm(context);</span><br><span class="line">            notificationService.notifySuccess(context);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ProcessingException e) &#123;</span><br><span class="line">            handleFailure(context, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleFailure</span><span class="params">(ProcessContext context, ProcessingException e)</span> &#123;</span><br><span class="line">        <span class="comment">// 统一的失败处理逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (context.isInventoryReserved()) &#123;</span><br><span class="line">            inventoryService.releaseReservation(context.getOrder());</span><br><span class="line">        &#125;</span><br><span class="line">        notificationService.notifyFailure(context.getOrder(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文对象传递状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Order order;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">inventoryReserved</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> PaymentResult paymentResult;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; processingSteps = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProcessContext</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters and setters...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务组件通过上下文协作，而不是直接相互调用</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkAndReserve</span><span class="params">(ProcessContext context)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">available</span> <span class="operator">=</span> checkAvailability(context.getOrder());</span><br><span class="line">        <span class="keyword">if</span> (!available) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ProcessingException</span>(<span class="string">&quot;Insufficient inventory&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        reserveItems(context.getOrder());</span><br><span class="line">        context.setInventoryReserved(<span class="literal">true</span>);</span><br><span class="line">        context.addStep(<span class="string">&quot;INVENTORY_RESERVED&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-优势总结"><a href="#5-优势总结" class="headerlink" title="5. 优势总结"></a>5. 优势总结</h2><ol><li><strong>降低耦合</strong>：对象之间依赖关系最小化</li><li><strong>提高模块化</strong>：系统更容易理解和维护</li><li><strong>增强安全性</strong>：减少意外访问内部状态的风险</li><li><strong>改善可测试性</strong>：依赖关系简单，容易模拟</li><li><strong>提高灵活性</strong>：内部实现变化不影响外部调用者</li></ol><h2 id="6-实践建议"><a href="#6-实践建议" class="headerlink" title="6. 实践建议"></a>6. 实践建议</h2><ol><li><strong>识别并消除链式调用</strong>：<code>a.getB().getC().doSomething()</code></li><li><strong>使用DTO封装数据传输</strong>：避免暴露领域模型</li><li><strong>采用门面模式</strong>：为复杂子系统提供简洁接口</li><li><strong>合理使用中介者模式</strong>：减少对象间的直接通信</li><li><strong>利用Spring的依赖注入</strong>：通过容器管理对象关系</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用Spring的@ConfigurationProperties减少配置知识的暴露</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app.shipping&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShippingProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String defaultProvider;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, ProviderConfig&gt; providers;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供业务友好的方法，隐藏配置细节</span></span><br><span class="line">    <span class="keyword">public</span> ProviderConfig <span class="title function_">getActiveProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> providers.get(defaultProvider);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters and setters...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务层使用封装后的配置</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShippingService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShippingProperties shippingProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ShippingCost <span class="title function_">calculateCost</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 符合LoD：只需要知道ShippingProperties提供的业务方法</span></span><br><span class="line">        <span class="type">ProviderConfig</span> <span class="variable">provider</span> <span class="operator">=</span> shippingProperties.getActiveProvider();</span><br><span class="line">        <span class="keyword">return</span> provider.calculateCost(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在SpringBoot&#x2F;SpringCloud中，迪米特原则是构建松耦合、高内聚微服务架构的重要指导原则。通过合理应用LoD，可以减少服务间的过度依赖，提高系统的可维护性和扩展性。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>里氏替换原则与依赖倒置原则在Spring中的应用</title>
      <link href="/2026/02/03/%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2&amp;%E4%BE%9D%E8%B5%96%E5%80%92%E8%BD%AC%202026_2_3/"/>
      <url>/2026/02/03/%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2&amp;%E4%BE%9D%E8%B5%96%E5%80%92%E8%BD%AC%202026_2_3/</url>
      
        <content type="html"><![CDATA[<h1 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h1><p>里氏替换原则(Liskov Substitution Principle, LSP)是SOLID原则中的第三个原则，它由Barbara Liskov提出，规定：所有引用基类的地方必须能透明地使用其子类的对象。</p><h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p>里氏替换原则的关键思想：<br>• 子类必须完全实现父类的抽象方法</p><p>• 子类可以有自己的个性，但不得改变父类原有的行为契约</p><p>• 前置条件不能强化，后置条件不能弱化</p><p>• 子类不能抛出比父类更宽泛的异常</p><h2 id="SpringBoot中的应用方式"><a href="#SpringBoot中的应用方式" class="headerlink" title="SpringBoot中的应用方式"></a>SpringBoot中的应用方式</h2><h3 id="继承关系的正确使用"><a href="#继承关系的正确使用" class="headerlink" title="继承关系的正确使用"></a>继承关系的正确使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基类定义契约</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付金额必须大于0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> PaymentResult <span class="title function_">pay</span><span class="params">(BigDecimal amount)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证支付参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">validateAmount</span><span class="params">(BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (amount == <span class="literal">null</span> || amount.compareTo(BigDecimal.ZERO) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;支付金额必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确实现 - 遵守LSP</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayService</span> <span class="keyword">extends</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">pay</span><span class="params">(BigDecimal amount)</span> &#123;</span><br><span class="line">        validateAmount(amount); <span class="comment">// 调用父类验证</span></span><br><span class="line">        <span class="comment">// 支付宝特定逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResult</span>(<span class="literal">true</span>, <span class="string">&quot;支付宝支付成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误实现 - 违反LSP（示例）</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayService</span> <span class="keyword">extends</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PaymentResult <span class="title function_">pay</span><span class="params">(BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 违反：没有调用父类验证，允许负金额</span></span><br><span class="line">        <span class="keyword">if</span> (amount == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;金额不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 微信支付特定逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaymentResult</span>(<span class="literal">true</span>, <span class="string">&quot;微信支付成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="基于接口的契约设计"><a href="#基于接口的契约设计" class="headerlink" title="基于接口的契约设计"></a>基于接口的契约设计</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义清晰的接口契约</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userCreateRequest 用户信息，username不能为空，email格式必须正确</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创建的用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException 当参数不合法时抛出</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UserDTO <span class="title function_">createUser</span><span class="params">(UserCreateRequest request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 符合LSP的实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultUserService</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">createUser</span><span class="params">(UserCreateRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getUsername() == <span class="literal">null</span> || request.getUsername().trim().isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 正常业务逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不符合LSP的实现（示例）</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LenientUserService</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">createUser</span><span class="params">(UserCreateRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 违反：允许空用户名，改变了父类契约</span></span><br><span class="line">        <span class="comment">// 如果系统其他部分依赖username不为空，这里会导致问题</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SpringCloud中的应用方式"><a href="#SpringCloud中的应用方式" class="headerlink" title="SpringCloud中的应用方式"></a>SpringCloud中的应用方式</h2><h3 id="3-1-微服务接口兼容性"><a href="#3-1-微服务接口兼容性" class="headerlink" title="3.1 微服务接口兼容性"></a>3.1 微服务接口兼容性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单服务接口定义</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderCreateCommand 订单创建命令</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 业务异常，如库存不足、用户不存在等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Long <span class="title function_">createOrder</span><span class="params">(OrderCreateCommand orderCreateCommand)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// V1版本实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceV1</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">createOrder</span><span class="params">(OrderCreateCommand command)</span> &#123;</span><br><span class="line">        <span class="comment">// V1逻辑：简单创建订单</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// V2版本实现（扩展但不破坏原有契约）</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceV2</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">createOrder</span><span class="params">(OrderCreateCommand command)</span> &#123;</span><br><span class="line">        <span class="comment">// V2逻辑：增加优惠券计算，但仍保持原有契约</span></span><br><span class="line">        <span class="comment">// 仍然返回Long类型的订单ID</span></span><br><span class="line">        <span class="comment">// 仍然在库存不足时抛出BusinessException</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2L</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-Feign客户端与LSP"><a href="#3-2-Feign客户端与LSP" class="headerlink" title="3.2 Feign客户端与LSP"></a>3.2 Feign客户端与LSP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 商品服务Feign客户端接口</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;product-service&quot;, path = &quot;/api/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    ResponseEntity&lt;ProductDTO&gt; <span class="title function_">getProductById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    ResponseEntity&lt;ProductDTO&gt; <span class="title function_">createProduct</span><span class="params">(<span class="meta">@RequestBody</span> ProductCreateRequest request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类必须保持接口契约</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductServiceFallback</span> <span class="keyword">implements</span> <span class="title class_">ProductServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ProductDTO&gt; <span class="title function_">getProductById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 熔断降级实现，但返回类型必须一致</span></span><br><span class="line">        <span class="type">ProductDTO</span> <span class="variable">fallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductDTO</span>();</span><br><span class="line">        fallback.setId(id);</span><br><span class="line">        fallback.setName(<span class="string">&quot;商品暂时不可用&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(fallback);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ProductDTO&gt; <span class="title function_">createProduct</span><span class="params">(ProductCreateRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 必须保持相同的参数和返回类型</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;服务暂时不可用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="常见违反LSP的场景及解决方案"><a href="#常见违反LSP的场景及解决方案" class="headerlink" title="常见违反LSP的场景及解决方案"></a>常见违反LSP的场景及解决方案</h2><h3 id="4-1-正方形不是长方形问题"><a href="#4-1-正方形不是长方形问题" class="headerlink" title="4.1 正方形不是长方形问题"></a>4.1 正方形不是长方形问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误设计</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> width, height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">int</span> width)</span> &#123; <span class="built_in">this</span>.width = width; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(<span class="type">int</span> height)</span> &#123; <span class="built_in">this</span>.height = height; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span> &#123; <span class="keyword">return</span> width * height; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">int</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setWidth(width);</span><br><span class="line">        <span class="built_in">super</span>.setHeight(width); <span class="comment">// 违反：改变了父类行为</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(<span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setWidth(height);</span><br><span class="line">        <span class="built_in">super</span>.setHeight(height); <span class="comment">// 违反：改变了父类行为</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确设计 - 使用组合代替继承</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width, height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">int</span> width)</span> &#123; <span class="built_in">this</span>.width = width; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHeight</span><span class="params">(<span class="type">int</span> height)</span> &#123; <span class="built_in">this</span>.height = height; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span> &#123; <span class="keyword">return</span> width * height; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> side;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSide</span><span class="params">(<span class="type">int</span> side)</span> &#123; <span class="built_in">this</span>.side = side; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getArea</span><span class="params">()</span> &#123; <span class="keyword">return</span> side * side; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-在Spring中的解决方案"><a href="#4-2-在Spring中的解决方案" class="headerlink" title="4.2 在Spring中的解决方案"></a>4.2 在Spring中的解决方案</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用策略模式替代继承</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeCalculator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Map&lt;Class&lt;?&gt;, Function&lt;Object, Integer&gt;&gt; calculators = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ShapeCalculator</span><span class="params">()</span> &#123;</span><br><span class="line">        calculators.put(Rectangle.class, shape -&gt; &#123;</span><br><span class="line">            <span class="type">Rectangle</span> <span class="variable">rect</span> <span class="operator">=</span> (Rectangle) shape;</span><br><span class="line">            <span class="keyword">return</span> rect.getWidth() * rect.getHeight();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        calculators.put(Square.class, shape -&gt; &#123;</span><br><span class="line">            <span class="type">Square</span> <span class="variable">square</span> <span class="operator">=</span> (Square) shape;</span><br><span class="line">            <span class="keyword">return</span> square.getSide() * square.getSide();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculateArea</span><span class="params">(Object shape)</span> &#123;</span><br><span class="line">        Function&lt;Object, Integer&gt; calculator = calculators.get(shape.getClass());</span><br><span class="line">        <span class="keyword">if</span> (calculator == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;不支持的图形类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> calculator.apply(shape);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="最佳实践建议"><a href="#最佳实践建议" class="headerlink" title="最佳实践建议"></a>最佳实践建议</h2><ol><li><strong>优先使用组合而非继承</strong></li><li><strong>明确定义接口契约和前置&#x2F;后置条件</strong></li><li><strong>使用@FunctionalInterface定义单一职责的函数接口</strong></li><li><strong>在微服务中使用API版本控制保持契约稳定</strong></li><li><strong>编写契约测试确保实现符合预期行为</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 契约测试示例</span></span><br><span class="line"><span class="meta">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceContractTest</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserService implementation;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 注入待测实现</span></span><br><span class="line">        implementation = <span class="keyword">new</span> <span class="title class_">DefaultUserService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shouldThrowExceptionWhenUsernameIsEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserCreateRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserCreateRequest</span>();</span><br><span class="line">        request.setUsername(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        assertThrows(IllegalArgumentException.class, </span><br><span class="line">            () -&gt; implementation.createUser(request));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在SpringBoot&#x2F;SpringCloud中遵循LSP原则，可以确保系统的稳定性和可扩展性，特别是在微服务这种分布式环境中，接口契约的稳定性至关重要。</p><h1 id="依赖倒置"><a href="#依赖倒置" class="headerlink" title="依赖倒置"></a>依赖倒置</h1><p>依赖倒置原则(Dependency Inversion Principle, DIP)是SOLID原则中的第四个原则，它规定：高层模块不应该依赖低层模块，两者都应该依赖其抽象；抽象不应该依赖细节，细节应该依赖抽象。</p><h2 id="1-核心概念"><a href="#1-核心概念" class="headerlink" title="1. 核心概念"></a>1. 核心概念</h2><p>依赖倒置原则的两个关键表述：</p><ol><li><strong>高层模块不应依赖低层模块，二者都该依赖抽象</strong></li><li><strong>抽象不应依赖细节，细节应依赖抽象</strong></li></ol><p>核心思想：</p><ul><li>面向接口编程而非面向实现编程</li><li>通过依赖注入解耦组件关系</li><li>提高系统的灵活性和可测试性</li></ul><h2 id="2-SpringBoot中的应用方式"><a href="#2-SpringBoot中的应用方式" class="headerlink" title="2. SpringBoot中的应用方式"></a>2. SpringBoot中的应用方式</h2><h3 id="2-1-依赖注入实现DIP"><a href="#2-1-依赖注入实现DIP" class="headerlink" title="2.1 依赖注入实现DIP"></a>2.1 依赖注入实现DIP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象定义 - 不依赖具体实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendNotification</span><span class="params">(String message, String recipient)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现1</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailNotificationService</span> <span class="keyword">implements</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendNotification</span><span class="params">(String message, String recipient)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发送邮件到: &quot;</span> + recipient + <span class="string">&quot;, 内容: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现2</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsNotificationService</span> <span class="keyword">implements</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendNotification</span><span class="params">(String message, String recipient)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发送短信到: &quot;</span> + recipient + <span class="string">&quot;, 内容: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高层模块 - 依赖抽象而非具体实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NotificationService notificationService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过构造器注入依赖 - Spring自动装配</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(NotificationService notificationService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.notificationService = notificationService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑...</span></span><br><span class="line">        notificationService.sendNotification(<span class="string">&quot;订单创建成功&quot;</span>, order.getCustomerEmail());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-配置化选择实现"><a href="#2-2-配置化选择实现" class="headerlink" title="2.2 配置化选择实现"></a>2.2 配置化选择实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(name = &quot;notification.type&quot;, havingValue = &quot;email&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> NotificationService <span class="title function_">emailNotificationService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmailNotificationService</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(name = &quot;notification.type&quot;, havingValue = &quot;sms&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> NotificationService <span class="title function_">smsNotificationService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsNotificationService</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> NotificationService <span class="title function_">defaultNotificationService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmailNotificationService</span>(); <span class="comment">// 默认实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-使用-Qualifier精确控制"><a href="#2-3-使用-Qualifier精确控制" class="headerlink" title="2.3 使用@Qualifier精确控制"></a>2.3 使用@Qualifier精确控制</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiChannelNotificationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NotificationService emailService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NotificationService smsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiChannelNotificationService</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@Qualifier(&quot;emailNotificationService&quot;)</span> NotificationService emailService,</span></span><br><span class="line"><span class="params">        <span class="meta">@Qualifier(&quot;smsNotificationService&quot;)</span> NotificationService smsService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emailService = emailService;</span><br><span class="line">        <span class="built_in">this</span>.smsService = smsService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendOrderConfirmation</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        emailService.sendNotification(<span class="string">&quot;订单确认&quot;</span>, order.getCustomerEmail());</span><br><span class="line">        smsService.sendNotification(<span class="string">&quot;订单已确认&quot;</span>, order.getCustomerPhone());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-SpringCloud中的应用方式"><a href="#3-SpringCloud中的应用方式" class="headerlink" title="3. SpringCloud中的应用方式"></a>3. SpringCloud中的应用方式</h2><h3 id="3-1-服务间通信的抽象"><a href="#3-1-服务间通信的抽象" class="headerlink" title="3.1 服务间通信的抽象"></a>3.1 服务间通信的抽象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象定义服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserServiceClient</span> &#123;</span><br><span class="line">    UserDTO <span class="title function_">getUserById</span><span class="params">(Long userId)</span>;</span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getUsersByIds</span><span class="params">(List&lt;Long&gt; userIds)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Feign实现</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;user-service&quot;, path = &quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserFeignClient</span> <span class="keyword">extends</span> <span class="title class_">UserServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    UserDTO <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    List&lt;UserDTO&gt; <span class="title function_">getUsersByIds</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 熔断降级实现</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceFallback</span> <span class="keyword">implements</span> <span class="title class_">UserServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 返回兜底数据或抛出异常</span></span><br><span class="line">        <span class="keyword">return</span> UserDTO.builder()</span><br><span class="line">                .id(userId)</span><br><span class="line">                .name(<span class="string">&quot;未知用户&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserDTO&gt; <span class="title function_">getUsersByIds</span><span class="params">(List&lt;Long&gt; userIds)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userIds.stream()</span><br><span class="line">                .map(<span class="built_in">this</span>::getUserById)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高层服务 - 依赖抽象</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserServiceClient userServiceClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(UserServiceClient userServiceClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userServiceClient = userServiceClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> OrderDTO <span class="title function_">createOrder</span><span class="params">(OrderCreateRequest request)</span> &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> userServiceClient.getUserById(request.getUserId());</span><br><span class="line">        <span class="comment">// 业务逻辑...</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderDTO</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-配置中心集成"><a href="#3-2-配置中心集成" class="headerlink" title="3.2 配置中心集成"></a>3.2 配置中心集成</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象配置服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConfigService</span> &#123;</span><br><span class="line">    String <span class="title function_">getString</span><span class="params">(String key)</span>;</span><br><span class="line">    Integer <span class="title function_">getInt</span><span class="params">(String key)</span>;</span><br><span class="line">    Boolean <span class="title function_">getBoolean</span><span class="params">(String key)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Nacos实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigService</span> <span class="keyword">implements</span> <span class="title class_">ConfigService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConfigService nacosConfigManager;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getString</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nacosConfigManager.getProperty(key, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其他方法实现...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Apollo实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApolloConfigService</span> <span class="keyword">implements</span> <span class="title class_">ConfigService</span> &#123;</span><br><span class="line">    <span class="comment">// Apollo特定实现</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用配置的组件</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentConfigService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConfigService configService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentConfigService</span><span class="params">(ConfigService configService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configService = configService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> PaymentMethod <span class="title function_">getDefaultPaymentMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> configService.getString(<span class="string">&quot;payment.default.method&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> PaymentMethod.valueOf(method);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-最佳实践场景"><a href="#4-最佳实践场景" class="headerlink" title="4. 最佳实践场景"></a>4. 最佳实践场景</h2><h3 id="4-1-工厂模式-依赖倒置"><a href="#4-1-工厂模式-依赖倒置" class="headerlink" title="4.1 工厂模式+依赖倒置"></a>4.1 工厂模式+依赖倒置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NotificationFactory</span> &#123;</span><br><span class="line">    NotificationService <span class="title function_">createNotificationService</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailNotificationFactory</span> <span class="keyword">implements</span> <span class="title class_">NotificationFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> NotificationService <span class="title function_">createNotificationService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmailNotificationService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsNotificationFactory</span> <span class="keyword">implements</span> <span class="title class_">NotificationFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> NotificationService <span class="title function_">createNotificationService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SmsNotificationService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂提供者</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationFactoryProvider</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, NotificationFactory&gt; factories;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NotificationFactoryProvider</span><span class="params">(List&lt;NotificationFactory&gt; factoryList)</span> &#123;</span><br><span class="line">        factories = factoryList.stream()</span><br><span class="line">                .collect(Collectors.toMap(</span><br><span class="line">                    factory -&gt; factory.getClass().getSimpleName()</span><br><span class="line">                        .replace(<span class="string">&quot;NotificationFactory&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                        .toLowerCase(),</span><br><span class="line">                    Function.identity()</span><br><span class="line">                ));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> NotificationService <span class="title function_">getNotificationService</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="type">NotificationFactory</span> <span class="variable">factory</span> <span class="operator">=</span> factories.get(type.toLowerCase());</span><br><span class="line">        <span class="keyword">if</span> (factory == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;不支持的通知类型: &quot;</span> + type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> factory.createNotificationService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-事件驱动架构中的DIP"><a href="#4-2-事件驱动架构中的DIP" class="headerlink" title="4.2 事件驱动架构中的DIP"></a>4.2 事件驱动架构中的DIP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DomainEvent</span> &#123;</span><br><span class="line">    LocalDateTime <span class="title function_">getOccurredOn</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderCreatedEvent</span> <span class="keyword">implements</span> <span class="title class_">DomainEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long orderId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LocalDateTime occurredOn;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderCreatedEvent</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderId = orderId;</span><br><span class="line">        <span class="built_in">this</span>.occurredOn = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LocalDateTime <span class="title function_">getOccurredOn</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> occurredOn;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getOrderId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象事件处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EventHandler</span>&lt;T <span class="keyword">extends</span> <span class="title class_">DomainEvent</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(T event)</span>;</span><br><span class="line">    Class&lt;T&gt; <span class="title function_">getEventType</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体事件处理器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderCreatedEventHandler</span> <span class="keyword">implements</span> <span class="title class_">EventHandler</span>&lt;OrderCreatedEvent&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(OrderCreatedEvent event)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;处理订单创建事件: &quot;</span> + event.getOrderId());</span><br><span class="line">        <span class="comment">// 发送通知、更新统计等业务逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;OrderCreatedEvent&gt; <span class="title function_">getEventType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OrderCreatedEvent.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件分发器 - 高层模块依赖抽象</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventDispatcher</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, List&lt;EventHandler&lt;?&gt;&gt;&gt; handlers = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EventDispatcher</span><span class="params">(List&lt;EventHandler&lt;?&gt;&gt; eventHandlers)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (EventHandler&lt;?&gt; handler : eventHandlers) &#123;</span><br><span class="line">            Class&lt;?&gt; eventType = handler.getEventType();</span><br><span class="line">            handlers.computeIfAbsent(eventType, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).add(handler);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">DomainEvent</span>&gt; <span class="keyword">void</span> <span class="title function_">dispatch</span><span class="params">(T event)</span> &#123;</span><br><span class="line">        List&lt;EventHandler&lt;?&gt;&gt; eventHandlers = handlers.getOrDefault(event.getClass(), Collections.emptyList());</span><br><span class="line">        <span class="keyword">for</span> (EventHandler handler : eventHandlers) &#123;</span><br><span class="line">            ((EventHandler&lt;T&gt;) handler).handle(event);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-数据库访问层的抽象"><a href="#4-3-数据库访问层的抽象" class="headerlink" title="4.3 数据库访问层的抽象"></a>4.3 数据库访问层的抽象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findById</span><span class="params">(Long id)</span>;</span><br><span class="line">    User <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JPA实现</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaUserRepository</span> <span class="keyword">implements</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;User&gt; <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(entityManager.find(User.class, id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其他方法实现...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MyBatis实现</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisUserRepository</span> <span class="keyword">implements</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;User&gt; <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(userMapper.selectById(id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其他方法实现...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务层依赖抽象</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserProfile</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(userId)</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;用户不存在&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> convertToDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-优势总结"><a href="#5-优势总结" class="headerlink" title="5. 优势总结"></a>5. 优势总结</h2><ol><li><strong>松耦合</strong>：高层模块与低层模块解耦，便于独立演化</li><li><strong>可测试性</strong>：容易进行单元测试，可以注入Mock对象</li><li><strong>可扩展性</strong>：新增实现无需修改现有代码</li><li><strong>可维护性</strong>：依赖关系清晰，代码结构稳定</li><li><strong>符合开闭原则</strong>：通过新增实现扩展功能，无需修改抽象</li></ol><p>在SpringBoot&#x2F;SpringCloud中，依赖倒置原则通过Spring框架的依赖注入机制得到完美支持，使得构建灵活、可维护的微服务架构成为可能。Spring的IoC容器本身就是依赖倒置原则的经典实践。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloud Gateway配置详解</title>
      <link href="/2026/01/27/SpringCloud%20GateWay%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%202026_1_27/"/>
      <url>/2026/01/27/SpringCloud%20GateWay%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%202026_1_27/</url>
      
        <content type="html"><![CDATA[<h3 id="一、配置整体说明"><a href="#一、配置整体说明" class="headerlink" title="一、配置整体说明"></a>一、配置整体说明</h3><p>这段配置是Spring Cloud Gateway（网关）的核心yml配置，主要实现三大核心能力：</p><ol><li>与服务注册中心集成（服务发现）；</li><li>多路由规则配置（动态负载均衡路由+静态路由）；</li><li>路由断言（匹配条件）+ 请求过滤器（请求修改）。</li></ol><h3 id="二、配置分类详尽解析"><a href="#二、配置分类详尽解析" class="headerlink" title="二、配置分类详尽解析"></a>二、配置分类详尽解析</h3><h4 id="模块1：基础应用配置（通用）"><a href="#模块1：基础应用配置（通用）" class="headerlink" title="模块1：基础应用配置（通用）"></a>模块1：基础应用配置（通用）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">getway-20000</span>  <span class="comment"># 网关服务的唯一名称</span></span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>：标识当前网关服务在注册中心的名称（如Eureka&#x2F;Nacos），是服务注册发现的基础；</li><li><strong>注意</strong>：名称自定义，建议格式「服务类型-端口号」，便于运维识别。</li></ul><h4 id="模块2：Gateway核心配置（核心）"><a href="#模块2：Gateway核心配置（核心）" class="headerlink" title="模块2：Gateway核心配置（核心）"></a>模块2：Gateway核心配置（核心）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># 子模块2.1：服务发现配置（与注册中心联动）</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 启用服务发现路由定位器</span></span><br><span class="line">      <span class="comment"># 子模块2.2：路由规则配置（核心，支持多路由）</span></span><br><span class="line">      <span class="attr">routes:</span> </span><br><span class="line">        <span class="comment"># 路由1：基于服务名的动态负载均衡路由（核心）</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route01</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://member-provider-service</span></span><br><span class="line">          <span class="attr">predicates:</span> </span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/member/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestParameter=color,</span> <span class="string">blue</span></span><br><span class="line">        <span class="comment"># 路由2：静态路由（固定地址转发）</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route02</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/</span></span><br></pre></td></tr></table></figure><h5 id="子模块2-1：服务发现配置（discovery-locator）"><a href="#子模块2-1：服务发现配置（discovery-locator）" class="headerlink" title="子模块2.1：服务发现配置（discovery.locator）"></a>子模块2.1：服务发现配置（discovery.locator）</h5><table><thead><tr><th>配置项</th><th>取值</th><th>核心作用</th></tr></thead><tbody><tr><td><code>discovery.locator.enabled</code></td><td>true</td><td>1. 允许网关通过注册中心（Eureka&#x2F;Nacos）自动发现微服务，无需硬编码服务IP&#x2F;端口；   2. 开启后支持「lb:&#x2F;&#x2F;服务名」协议实现负载均衡；   3. 兜底规则：<code>http://网关地址/服务名小写/**</code> 可直接访问对应服务（无需配置routes）。</td></tr></tbody></table><h5 id="子模块2-2：路由规则配置（routes）"><a href="#子模块2-2：路由规则配置（routes）" class="headerlink" title="子模块2.2：路由规则配置（routes）"></a>子模块2.2：路由规则配置（routes）</h5><p>路由是Gateway的核心，每个路由包含4个核心属性：<code>id</code>（唯一标识）、<code>uri</code>（转发地址）、<code>predicates</code>（断言&#x2F;匹配条件）、<code>filters</code>（过滤器）。</p><table><thead><tr><th>路由属性</th><th>配置值&#x2F;示例</th><th>详尽解析</th></tr></thead><tbody><tr><td><code>id</code></td><td>member_route01&#x2F;member_route02</td><td>路由唯一标识，自定义（建议「服务名_route序号」），不可重复；</td></tr><tr><td><code>uri</code></td><td>1. <code>lb://member-provider-service</code>（动态）   2. <code>http://www.baidu.com</code>（静态）</td><td>- 动态URI：<code>lb://</code> 是Gateway内置负载均衡协议（基于Spring Cloud LoadBalancer），<code>member-provider-service</code>是注册中心的微服务名（<strong>必须小写</strong>），自动从注册中心拉取服务实例并实现<strong>轮询负载均衡</strong>；   - 静态URI：固定转发到外网&#x2F;指定地址，无负载均衡；</td></tr><tr><td><code>predicates</code>（断言）</td><td>1. <code>Path=/member/**</code>（路径断言）   2. <code>Path=/</code>（根路径断言）   （注释的扩展断言见下表）</td><td>路由的「匹配条件」，<strong>所有断言都满足才会触发该路由</strong>；   核心是<code>Path</code>路径断言，其他断言是扩展条件；</td></tr><tr><td><code>filters</code>（过滤器）</td><td><code>AddRequestParameter=color, blue</code></td><td>对转发的请求做修改：此处是「添加请求参数」，转发到后端服务时自动追加<code>color=blue</code>参数；</td></tr></tbody></table><h5 id="扩展：常用路由断言（注释部分解析）"><a href="#扩展：常用路由断言（注释部分解析）" class="headerlink" title="扩展：常用路由断言（注释部分解析）"></a>扩展：常用路由断言（注释部分解析）</h5><table><thead><tr><th>断言类型</th><th>示例配置</th><th>作用（匹配条件）</th></tr></thead><tbody><tr><td>时间断言</td><td><code>After=2026-01-26T21:28:00.000+08:00[Asia/Shanghai]</code></td><td>仅请求时间在指定时间<strong>之后</strong>匹配（Before&#x3D;之前，Between&#x3D;中间）；</td></tr><tr><td>Cookie断言</td><td><code>Cookie=user, zero</code></td><td>仅请求携带<code>user=zero</code>（支持正则）的Cookie时匹配；</td></tr><tr><td>请求头断言</td><td><code>Header=X-Request-Id, hello</code></td><td>仅请求携带<code>X-Request-Id=hello</code>（支持正则）的请求头时匹配；</td></tr><tr><td>主机断言</td><td><code>Host=**.zero.**</code></td><td>仅请求的Host满足通配符（如<code>a.zero.b</code>）时匹配；</td></tr><tr><td>请求方法断言</td><td><code>Method=GET,POST</code></td><td>仅GET&#x2F;POST请求匹配（支持多方法）；</td></tr><tr><td>参数断言</td><td><code>Query=email, [\w-]+@([a-zA-Z]+\.)+[a-zA-Z]+</code></td><td>仅请求携带<code>email</code>参数且值符合邮箱正则时匹配；</td></tr><tr><td>远程地址断言</td><td><code>RemoteAddr=127.0.0.1</code></td><td>仅请求来源IP是127.0.0.1时匹配（支持网段，如192.168.1.0&#x2F;24）；</td></tr><tr><td>权重断言</td><td><code>Weight=group1, 2</code> &#x2F; <code>Weight=group1, 8</code></td><td>同分组（group1）的路由按权重分配流量（2:8 → 1:4），用于灰度发布&#x2F;流量控制；</td></tr></tbody></table><h3 id="三、复习文档（精简版）"><a href="#三、复习文档（精简版）" class="headerlink" title="三、复习文档（精简版）"></a>三、复习文档（精简版）</h3><h4 id="【Spring-Cloud-Gateway核心配置复习】"><a href="#【Spring-Cloud-Gateway核心配置复习】" class="headerlink" title="【Spring Cloud Gateway核心配置复习】"></a>【Spring Cloud Gateway核心配置复习】</h4><table><thead><tr><th>核心模块</th><th>关键配置</th><th>核心考点</th></tr></thead><tbody><tr><td>服务发现</td><td><code>discovery.locator.enabled=true</code></td><td>1. 开启后支持<code>lb://服务名</code>负载均衡；   2. 兜底路由：<code>网关地址/服务名/**</code>；</td></tr><tr><td>路由核心属性</td><td><code>id/uri/predicates/filters</code></td><td>1. <code>uri</code>：<code>lb://</code>&#x3D;动态负载均衡，<code>http://</code>&#x3D;静态路由；   2. <code>predicates</code>：Path是核心断言，多断言需全部满足；   3. <code>filters</code>：AddRequestParameter&#x3D;追加请求参数；</td></tr><tr><td>常用断言</td><td>Path&#x2F;Method&#x2F;Weight</td><td>1. Path：路径匹配（<code>/**</code>&#x3D;多级路径，<code>/</code>&#x3D;根路径）；   2. Weight：同分组按权重分流；</td></tr><tr><td>负载均衡</td><td><code>lb://服务名</code></td><td>默认轮询算法，无需额外配置；</td></tr></tbody></table><h4 id="【配置逻辑速记】"><a href="#【配置逻辑速记】" class="headerlink" title="【配置逻辑速记】"></a>【配置逻辑速记】</h4><ol><li>网关接收请求 → 匹配<code>predicates</code>断言 → 命中对应路由 → 经过<code>filters</code>修改请求 → 转发到<code>uri</code>地址；</li><li>动态路由（<code>lb://</code>）：从注册中心拉取服务实例，自动负载均衡；</li><li>静态路由（<code>http://</code>）：固定转发到指定地址，无负载均衡。</li></ol><h3 id="总结（核心关键点）"><a href="#总结（核心关键点）" class="headerlink" title="总结（核心关键点）"></a>总结（核心关键点）</h3><ol><li><strong>服务发现</strong>：<code>discovery.locator.enabled=true</code>是网关与注册中心联动的开关，开启后支持<code>lb://</code>协议实现动态负载均衡；</li><li><strong>路由核心</strong>：每个路由的核心是「断言匹配+地址转发+过滤器修改」，<code>Path</code>断言是最常用的匹配条件；</li><li><strong>URI区别</strong>：<code>lb://服务名</code>是动态路由（推荐），<code>http://地址</code>是静态路由（仅用于外网&#x2F;固定地址转发）。</li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DTO、VO、POJO、DAO详解：企业级应用分层架构的数据对象</title>
      <link href="/2026/01/03/DTO,VO,POJO,DAO%E8%AF%A6%E8%A7%A3%202026_1_3/"/>
      <url>/2026/01/03/DTO,VO,POJO,DAO%E8%AF%A6%E8%A7%A3%202026_1_3/</url>
      
        <content type="html"><![CDATA[<h3 id="一、核心前提：这些“O”的定义来源"><a href="#一、核心前提：这些“O”的定义来源" class="headerlink" title="一、核心前提：这些“O”的定义来源"></a>一、核心前提：这些“O”的定义来源</h3><p>这些以“O”结尾的对象（DTO&#x2F;VO&#x2F;PO等）<strong>并非由官方标准组织（如ISO、W3C）强制定义</strong>，而是：</p><ol><li>核心源于<strong>企业级应用分层开发的行业共识&#x2F;设计模式</strong>，最早由Martin Fowler（马丁·福勒）在《Patterns of Enterprise Application Architecture》（企业应用架构模式，EAA）中明确提出DTO、DAO等核心概念；</li><li>后续VO、BO、PO&#x2F;DO等是Java EE生态结合分层架构（表现层、业务层、持久层）的衍生概念，再经领域驱动设计（DDD）、ORM框架（MyBatis&#x2F;Hibernate）实践演化；</li><li>不同企业&#x2F;团队会根据自身场景微调命名&#x2F;边界，但核心目标一致——<strong>解耦分层、数据语义清晰、降低维护成本</strong>。</li></ol><h3 id="二、常见“O”的定义、作用与场景"><a href="#二、常见“O”的定义、作用与场景" class="headerlink" title="二、常见“O”的定义、作用与场景"></a>二、常见“O”的定义、作用与场景</h3><p>按“分层+职责”分类，以下是最常用的核心对象：</p><table><thead><tr><th>缩写</th><th>全称</th><th>核心定义</th><th>核心作用</th><th>典型场景</th></tr></thead><tbody><tr><td>DTO</td><td>Data Transfer Object</td><td>跨层&#x2F;跨系统传输数据的纯数据载体（仅含字段+get&#x2F;set，无业务逻辑）</td><td>1. 减少网络请求（封装多字段一次传输）；   2. 隔离层间数据（屏蔽PO&#x2F;DO结构）；   3. 适配接口需求</td><td>REST API请求&#x2F;响应对象、微服务间数据传输、前后端交互的基础数据载体</td></tr><tr><td>VO</td><td>View Object</td><td>专为表现层（前端&#x2F;页面）定制的对象，完全贴合视图展示需求</td><td>1. 精准适配前端展示（如状态转中文、日期格式化）；   2. 屏蔽无关数据（仅返回前端需要的字段）</td><td>前端列表&#x2F;表单展示（如订单VO包含“订单号+用户昵称+状态中文+支付时间”）</td></tr><tr><td>PO</td><td>Persistent Object</td><td>与数据库表一一对应的纯数据载体（无业务逻辑），ORM框架的核心映射对象</td><td>1. 映射数据库表，简化CRUD；   2. 隔离数据库细节（业务层无需直接操作SQL）</td><td>MyBatis Mapper接口的入参&#x2F;返回值、Hibernate实体类（如用户PO对应user表）</td></tr><tr><td>DO</td><td>Domain Object</td><td>领域层核心对象（含业务逻辑），体现业务模型&#x2F;规则（DDD核心概念）</td><td>1. 封装核心业务逻辑（如订单DO含“计算金额”“判断是否可取消”方法）；   2. 体现业务语义</td><td>复杂业务的核心实体（如订单DO、商品DO，承载核心业务规则）</td></tr><tr><td>BO</td><td>Business Object</td><td>业务层专用对象，可整合多DO&#x2F;PO数据，封装业务流程逻辑（偏向“业务操作”）</td><td>1. 整合多源数据（如订单BO整合订单DO+用户DO+商品DO）；   2. 封装业务流程</td><td>复杂业务操作（如下单BO、退款BO，整合多步业务逻辑）</td></tr><tr><td>POJO</td><td>Plain Old Java Object</td><td>无框架依赖、仅含字段+get&#x2F;set的普通Java对象（对“轻量级对象”的统称）</td><td>1. 作为其他“O”的基础（DTO&#x2F;VO&#x2F;PO本质都是POJO）；   2. 降低框架耦合</td><td>所有无侵入、无逻辑的纯数据对象（如未继承任何框架类的DTO&#x2F;VO）</td></tr><tr><td>DAO</td><td>Data Access Object</td><td>（补充：非数据对象，是数据访问接口&#x2F;类）封装数据访问逻辑（SQL&#x2F;ORM操作）</td><td>隔离持久层与业务层，业务层无需关心数据存储细节（如MySQL&#x2F;Redis）</td><td>MyBatis的Mapper接口、自定义的数据库操作类（如UserDao）</td></tr></tbody></table><h3 id="三、易混淆概念的核心区别"><a href="#三、易混淆概念的核心区别" class="headerlink" title="三、易混淆概念的核心区别"></a>三、易混淆概念的核心区别</h3><h4 id="1-DTO-vs-VO"><a href="#1-DTO-vs-VO" class="headerlink" title="1. DTO vs VO"></a>1. DTO vs VO</h4><ul><li>DTO：侧重“<strong>跨层&#x2F;跨系统传输</strong>”（解决“数据怎么传”），不关心展示逻辑；</li><li>VO：侧重“<strong>贴合视图展示</strong>”（解决“数据怎么展示”），会包含格式化、语义化处理（如日期转“2026-01-03”、状态转“已支付”）；</li><li>实际开发：简单场景下可合并（如前端需求与传输数据一致时，用VO&#x2F;DTO统称）。</li></ul><h4 id="2-PO-vs-DO"><a href="#2-PO-vs-DO" class="headerlink" title="2. PO vs DO"></a>2. PO vs DO</h4><ul><li>PO：纯“数据载体”，仅映射数据库表，无任何业务逻辑；</li><li>DO：核心“业务载体”，包含业务规则&#x2F;方法，是业务模型的代码化；</li><li>实际开发：简单业务可合并（PO中加简单逻辑），复杂系统建议分离（避免数据库表结构绑定业务逻辑）。</li></ul><h3 id="四、这些“O”的核心价值"><a href="#四、这些“O”的核心价值" class="headerlink" title="四、这些“O”的核心价值"></a>四、这些“O”的核心价值</h3><ol><li><strong>分层解耦</strong>：表现层（VO&#x2F;DTO）、业务层（BO&#x2F;DO）、持久层（PO）各司其职，修改一层不影响其他层（如前端改展示字段，仅改VO，无需动PO）；</li><li><strong>语义清晰</strong>：通过命名直接体现用途（如看到VO就知道是给前端的，看到PO就知道是映射数据库的），提升代码可读性；</li><li><strong>复用与维护</strong>：通用逻辑封装在DO&#x2F;BO中，避免重复代码；数据传输规则封装在DTO中，统一接口规范；</li><li><strong>适配性强</strong>：屏蔽底层细节（如数据库表结构变更，仅改PO，业务层无感知）。</li></ol><h3 id="五、注意事项"><a href="#五、注意事项" class="headerlink" title="五、注意事项"></a>五、注意事项</h3><ul><li>无强制标准：不同团队可微调命名&#x2F;边界，核心是“职责单一”，而非机械区分；</li><li>避免过度设计：小项目&#x2F;简单业务无需严格区分所有“O”（如只用DTO+PO即可），避免为了分层而分层；</li><li>核心原则：让每个对象只做一件事，降低代码耦合度。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 架构设计 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot常用注解总结</title>
      <link href="/2026/01/03/SpringBoot%20%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93%202026_1_3/"/>
      <url>/2026/01/03/SpringBoot%20%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93%202026_1_3/</url>
      
        <content type="html"><![CDATA[<p>SpringBoot的核心优势之一是<strong>注解驱动开发</strong>，通过注解替代传统XML配置，大幅简化开发流程。以下是Web开发中SpringBoot最常用的注解，按「核心&#x2F;Web&#x2F;配置&#x2F;依赖注入&#x2F;事务&#x2F;数据访问&#x2F;AOP&#x2F;校验&#x2F;其他」维度分类详解，包含<strong>作用、核心属性、使用示例、注意事项</strong>，覆盖90%以上的开发场景。</p><h3 id="一、核心启动注解（必用）"><a href="#一、核心启动注解（必用）" class="headerlink" title="一、核心启动注解（必用）"></a>一、核心启动注解（必用）</h3><h4 id="1-SpringBootApplication"><a href="#1-SpringBootApplication" class="headerlink" title="1. @SpringBootApplication"></a>1. @SpringBootApplication</h4><p><strong>核心作用</strong>：SpringBoot应用的入口注解，用于标记主类，整合了3个核心注解的功能，是启动类的标配。<br><strong>底层组成</strong>：  </p><ul><li><code>@SpringBootConfiguration</code>：替代<code>@Configuration</code>，标记当前类为配置类；  </li><li><code>@EnableAutoConfiguration</code>：核心！开启自动配置（SpringBoot根据依赖自动配置Bean，如引入spring-boot-starter-web则自动配置Tomcat、SpringMVC）；  </li><li><code>@ComponentScan</code>：扫描当前包及其子包下的@Component、@Service、@Controller等注解，将类注册为Bean。</li></ul><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// 可选：排除特定自动配置类（如排除数据源自动配置）</span></span><br><span class="line"><span class="comment">// @SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：  </p><ul><li>启动类需放在<strong>根包下</strong>（如<code>com.demo</code>），否则<code>@ComponentScan</code>无法扫描子包的Bean；  </li><li>如需自定义扫描包，可加<code>@ComponentScan(basePackages = &quot;com.xxx&quot;)</code>。</li></ul><h3 id="二、Web开发核心注解"><a href="#二、Web开发核心注解" class="headerlink" title="二、Web开发核心注解"></a>二、Web开发核心注解</h3><h4 id="1-Controller-RestController"><a href="#1-Controller-RestController" class="headerlink" title="1. @Controller &amp; @RestController"></a>1. @Controller &amp; @RestController</h4><table><thead><tr><th>注解</th><th>作用</th><th>区别</th></tr></thead><tbody><tr><td>@Controller</td><td>标记类为SpringMVC的控制器，处理HTTP请求，需配合<code>@ResponseBody</code>返回JSON</td><td>默认返回视图（如jsp&#x2F;html）</td></tr><tr><td>@RestController</td><td>组合注解（<code>@Controller + @ResponseBody</code>），直接返回JSON&#x2F;XML等数据</td><td>无需额外加<code>@ResponseBody</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统控制器（返回视图）</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>; <span class="comment">// 返回templates/index.html（Thymeleaf）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RESTful控制器（返回JSON）</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(id, <span class="string">&quot;张三&quot;</span>); <span class="comment">// 直接返回JSON</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-RequestMapping（及变体）"><a href="#2-RequestMapping（及变体）" class="headerlink" title="2. @RequestMapping（及变体）"></a>2. @RequestMapping（及变体）</h4><p><strong>核心作用</strong>：映射HTTP请求到控制器方法，支持指定URL、请求方法、请求头、参数等。<br><strong>常用变体（简化版）</strong>：  </p><ul><li><code>@GetMapping</code>：仅处理GET请求（<code>method = RequestMethod.GET</code>）；  </li><li><code>@PostMapping</code>：仅处理POST请求；  </li><li><code>@PutMapping</code>&#x2F;<code>@DeleteMapping</code>&#x2F;<code>@PatchMapping</code>：对应PUT&#x2F;DELETE&#x2F;PATCH请求。</li></ul><p><strong>核心属性</strong>：  </p><ul><li><code>value/path</code>：请求URL（如<code>/user</code>）；  </li><li><code>method</code>：请求方法（GET&#x2F;POST等）；  </li><li><code>params</code>：限定请求参数（如<code>params = &quot;id&quot;</code>，仅含id参数时匹配）；  </li><li><code>headers</code>：限定请求头（如<code>headers = &quot;Content-Type=application/json&quot;</code>）；  </li><li><code>produces</code>：指定响应类型（如<code>produces = &quot;application/json;charset=UTF-8&quot;</code>）。</li></ul><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">// 匹配GET /api/user?id=1</span></span><br><span class="line">    <span class="meta">@GetMapping(params = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserById</span><span class="params">(<span class="meta">@RequestParam</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户ID：&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 匹配POST /api/user，且请求头为JSON</span></span><br><span class="line">    <span class="meta">@PostMapping(headers = &quot;Content-Type=application/json&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">addUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-请求参数绑定注解"><a href="#3-请求参数绑定注解" class="headerlink" title="3. 请求参数绑定注解"></a>3. 请求参数绑定注解</h4><table><thead><tr><th>注解</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>@RequestParam</td><td>绑定URL请求参数（如<code>/user?id=1</code>）到方法参数</td><td><code>@RequestParam Long id</code></td></tr><tr><td>@PathVariable</td><td>绑定URL路径变量（如<code>/user/1</code>）到方法参数</td><td><code>@PathVariable Long id</code></td></tr><tr><td>@RequestBody</td><td>绑定HTTP请求体（JSON&#x2F;XML）到Java对象（POST&#x2F;PUT请求常用）</td><td><code>@RequestBody User user</code></td></tr><tr><td>@RequestHeader</td><td>绑定请求头参数到方法参数</td><td><code>@RequestHeader String token</code></td></tr><tr><td>@CookieValue</td><td>绑定Cookie值到方法参数</td><td><code>@CookieValue String JSESSIONID</code></td></tr></tbody></table><p><strong>关键注意</strong>：  </p><ul><li><code>@RequestParam</code>可加<code>required = false</code>（非必传）、<code>defaultValue = &quot;0&quot;</code>（默认值）；  </li><li><code>@RequestBody</code>仅能绑定<strong>一个</strong>请求体，且请求头需为<code>Content-Type: application/json</code>；  </li><li><code>@PathVariable</code>需保证URL中的变量名与参数名一致，不一致则加<code>@PathVariable(&quot;uid&quot;) Long id</code>。</li></ul><h4 id="4-CrossOrigin"><a href="#4-CrossOrigin" class="headerlink" title="4. @CrossOrigin"></a>4. @CrossOrigin</h4><p><strong>作用</strong>：解决跨域问题（前后端分离场景必备），标记在类&#x2F;方法上，允许指定源的跨域请求。<br><strong>核心属性</strong>：  </p><ul><li><code>origins</code>：允许的跨域源（如<code>&quot;http://localhost:8080&quot;</code>，<code>&quot;*&quot;</code>表示所有）；  </li><li><code>maxAge</code>：预检请求（OPTIONS）的缓存时间（秒）；  </li><li><code>allowedHeaders</code>：允许的请求头；  </li><li><code>methods</code>：允许的请求方法。</li></ul><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类级别：所有方法允许跨域</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;http://localhost:3000&quot;, maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiController</span> &#123;</span><br><span class="line">    <span class="comment">// 方法级别：覆盖类配置</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="meta">@CrossOrigin(origins = &quot;*&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;跨域成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="三、配置相关注解"><a href="#三、配置相关注解" class="headerlink" title="三、配置相关注解"></a>三、配置相关注解</h3><h4 id="1-Configuration-Bean"><a href="#1-Configuration-Bean" class="headerlink" title="1. @Configuration &amp; @Bean"></a>1. @Configuration &amp; @Bean</h4><p><strong>@Configuration</strong>：标记类为配置类，替代传统XML配置文件（如<code>applicationContext.xml</code>）。<br><strong>@Bean</strong>：标记方法，返回值将注册为Spring容器中的Bean，默认名称为方法名，可通过<code>name/value</code>指定。  </p><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 注册一个Bean，名称为&quot;myHttpClient&quot;</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;myHttpClient&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CloseableHttpClient <span class="title function_">httpClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> HttpClientBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 依赖其他Bean（自动注入）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UserService <span class="title function_">userService</span><span class="params">(UserMapper userMapper)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>(userMapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：<code>@Bean</code>方法默认是单例的，如需多例，配合<code>@Scope(&quot;prototype&quot;)</code>。</p><h4 id="2-Value"><a href="#2-Value" class="headerlink" title="2. @Value"></a>2. @Value</h4><p><strong>作用</strong>：读取配置文件（如<code>application.yml/application.properties</code>）中的值，注入到字段&#x2F;方法参数。<br><strong>语法</strong>：  </p><ul><li>直接取值：<code>@Value(&quot;${app.name}&quot;)</code>；  </li><li>默认值：<code>@Value(&quot;${app.port:8080}&quot;)</code>（配置不存在时用8080）；  </li><li>SpEL表达式：<code>@Value(&quot;#{10+20}&quot;)</code>（计算值30）。</li></ul><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 读取application.yml中的app.name</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取端口，默认8080</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.port:8080&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer appPort;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印配置</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;应用名称：&quot;</span> + appName + <span class="string">&quot;，端口：&quot;</span> + appPort);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-ConfigurationProperties"><a href="#3-ConfigurationProperties" class="headerlink" title="3. @ConfigurationProperties"></a>3. @ConfigurationProperties</h4><p><strong>作用</strong>：批量绑定配置文件中的属性到Java类（比<code>@Value</code>更适合复杂配置），常用前缀统一管理。<br><strong>使用步骤</strong>：  </p><ol><li>加注解指定前缀；  </li><li>类需有<code>setter</code>方法（或用Lombok的<code>@Data</code>）；  </li><li>加<code>@Component</code>（或在配置类加<code>@EnableConfigurationProperties</code>）注册为Bean。</li></ol><p><strong>示例</strong>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">app:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> <span class="comment">// Lombok，自动生成setter/getter</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;app.server&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> Integer port;</span><br><span class="line">    <span class="keyword">private</span> Integer timeout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用配置</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ServerConfig serverConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ServerConfig <span class="title function_">getConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> serverConfig; <span class="comment">// 返回&#123;&quot;host&quot;:&quot;localhost&quot;,&quot;port&quot;:9090,&quot;timeout&quot;:3000&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-PropertySource"><a href="#4-PropertySource" class="headerlink" title="4. @PropertySource"></a>4. @PropertySource</h4><p><strong>作用</strong>：加载自定义配置文件（非默认的application.yml&#x2F;properties），如<code>config/db.properties</code>。<br><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(value = &quot;classpath:config/db.properties&quot;, encoding = &quot;UTF-8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;db.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dbUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="四、依赖注入注解"><a href="#四、依赖注入注解" class="headerlink" title="四、依赖注入注解"></a>四、依赖注入注解</h3><h4 id="1-Autowired"><a href="#1-Autowired" class="headerlink" title="1. @Autowired"></a>1. @Autowired</h4><p><strong>核心作用</strong>：自动注入Spring容器中的Bean，按<strong>类型</strong>匹配（默认必须存在，否则报错）。<br><strong>核心属性</strong>：  </p><ul><li><code>required = false</code>：允许Bean不存在，注入null；  </li><li>配合<code>@Qualifier</code>：按<strong>名称</strong>匹配（解决同类型多Bean问题）。</li></ul><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类1</span></span><br><span class="line"><span class="meta">@Service(&quot;alipayOrderService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayOrderService</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;支付宝下单&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类2</span></span><br><span class="line"><span class="meta">@Service(&quot;wechatOrderService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatOrderService</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;微信下单&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderManager</span> &#123;</span><br><span class="line">    <span class="comment">// 按类型匹配（报错，因为有2个OrderService实现）</span></span><br><span class="line">    <span class="comment">// @Autowired</span></span><br><span class="line">    <span class="comment">// private OrderService orderService;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方案1：@Qualifier指定名称</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;alipayOrderService&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方案2：@Primary（标记其中一个实现为优先）</span></span><br><span class="line">    <span class="comment">// @Service</span></span><br><span class="line">    <span class="comment">// @Primary</span></span><br><span class="line">    <span class="comment">// public class AlipayOrderService implements OrderService &#123;...&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-Resource"><a href="#2-Resource" class="headerlink" title="2. @Resource"></a>2. @Resource</h4><p><strong>作用</strong>：JDK自带的注入注解（非Spring），默认按<strong>名称</strong>匹配，无匹配则按类型。<br><strong>区别于@Autowired</strong>：  </p><table><thead><tr><th>维度</th><th>@Autowired</th><th>@Resource</th></tr></thead><tbody><tr><td>来源</td><td>Spring注解</td><td>JDK javax.annotation</td></tr><tr><td>匹配规则</td><td>默认按类型</td><td>默认按名称（name属性）</td></tr><tr><td>依赖配置</td><td>需配合@Qualifier指定名称</td><td>直接用name属性指定名称</td></tr></tbody></table><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderManager</span> &#123;</span><br><span class="line">    <span class="comment">// 按名称&quot;wechatOrderService&quot;注入</span></span><br><span class="line">    <span class="meta">@Resource(name = &quot;wechatOrderService&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-Primary"><a href="#3-Primary" class="headerlink" title="3. @Primary"></a>3. @Primary</h4><p><strong>作用</strong>：标记Bean为「优先候选」，当同类型多Bean时，<code>@Autowired</code>会优先注入标记的Bean。  </p><h4 id="4-Scope"><a href="#4-Scope" class="headerlink" title="4. @Scope"></a>4. @Scope</h4><p><strong>作用</strong>：指定Bean的作用域，默认<code>singleton</code>（单例）。<br><strong>常用值</strong>：  </p><ul><li><code>singleton</code>：单例（默认），容器中仅一个实例；  </li><li><code>prototype</code>：多例，每次获取创建新实例；  </li><li><code>request</code>：每个HTTP请求创建一个实例；  </li><li><code>session</code>：每个HTTP会话创建一个实例。</li></ul><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScopeConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 多例Bean</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="五、事务管理注解"><a href="#五、事务管理注解" class="headerlink" title="五、事务管理注解"></a>五、事务管理注解</h3><h4 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h4><p><strong>核心作用</strong>：声明式事务管理，标记在类&#x2F;方法上，Spring自动管理事务（提交&#x2F;回滚）。<br><strong>核心属性</strong>：  </p><table><thead><tr><th>属性</th><th>作用</th><th>常用值</th></tr></thead><tbody><tr><td>propagation</td><td>事务传播行为（嵌套事务规则）</td><td>REQUIRED（默认）、REQUIRES_NEW等</td></tr><tr><td>isolation</td><td>事务隔离级别</td><td>READ_COMMITTED（默认）、REPEATABLE_READ等</td></tr><tr><td>rollbackFor</td><td>指定触发回滚的异常类型（默认仅运行时异常回滚）</td><td>Exception.class、RuntimeException.class</td></tr><tr><td>noRollbackFor</td><td>指定不回滚的异常类型</td><td>IllegalArgumentException.class</td></tr><tr><td>timeout</td><td>事务超时时间（秒），超时则回滚</td><td>30（默认-1，无超时）</td></tr><tr><td>readOnly</td><td>是否只读事务（优化性能，仅查询时用）</td><td>true&#x2F;false（默认false）</td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">// 类级别：所有方法应用事务（可被方法级别覆盖）</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class, timeout = 30)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// 方法级别：覆盖类配置（只读）</span></span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// 增删改：读写事务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        <span class="comment">// 抛异常则回滚</span></span><br><span class="line">        <span class="keyword">if</span> (user.getId() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户ID为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：  </p><ul><li>事务仅对<strong>public方法</strong>生效（Spring AOP限制）；  </li><li>自调用（如方法A调用本类方法B）事务不生效（需通过Spring代理调用）；  </li><li>需确保数据源配置正确，且SpringBoot已引入<code>spring-boot-starter-jdbc</code>&#x2F;<code>spring-boot-starter-data-jpa</code>。</li></ul><h3 id="六、数据访问注解"><a href="#六、数据访问注解" class="headerlink" title="六、数据访问注解"></a>六、数据访问注解</h3><h4 id="1-MyBatis相关"><a href="#1-MyBatis相关" class="headerlink" title="1. MyBatis相关"></a>1. MyBatis相关</h4><ul><li><code>@Mapper</code>：标记接口为MyBatis的Mapper接口，SpringBoot自动扫描并创建代理对象；  </li><li><code>@MapperScan</code>：批量扫描Mapper接口（替代每个接口加<code>@Mapper</code>），通常加在启动类。</li></ul><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式1：单个Mapper加@Mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2：启动类批量扫描</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.demo.mapper&quot;)</span> <span class="comment">// 扫描com.demo.mapper下所有Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-Spring-Data-JPA相关"><a href="#2-Spring-Data-JPA相关" class="headerlink" title="2. Spring Data JPA相关"></a>2. Spring Data JPA相关</h4><ul><li><code>@Repository</code>：标记类为数据访问层（DAO），Spring自动捕获持久化异常并转换为Spring统一的DataAccessException；  </li><li><code>@Entity</code>：标记类为JPA实体类，映射数据库表；  </li><li><code>@Table</code>：指定实体类对应的数据库表名（默认类名小写）；  </li><li><code>@Id</code>：标记字段为主键；  </li><li><code>@GeneratedValue</code>：指定主键生成策略（如AUTO、IDENTITY）。</li></ul><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;t_user&quot;)</span> <span class="comment">// 对应数据库t_user表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span> <span class="comment">// 自增主键</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// getter/setter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DAO层</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    <span class="comment">// 自动生成SQL：SELECT * FROM t_user WHERE name = ?</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="七、AOP相关注解"><a href="#七、AOP相关注解" class="headerlink" title="七、AOP相关注解"></a>七、AOP相关注解</h3><p>AOP（面向切面编程）用于日志、权限、性能监控等横切逻辑，核心注解如下：  </p><ul><li><code>@Aspect</code>：标记类为切面类；  </li><li><code>@Pointcut</code>：定义切入点（需指定表达式，如匹配某个包下的所有方法）；  </li><li>通知注解：  <ul><li><code>@Before</code>：切入点方法执行前执行；  </li><li><code>@After</code>：切入点方法执行后执行（无论是否异常）；  </li><li><code>@AfterReturning</code>：切入点方法正常返回后执行；  </li><li><code>@AfterThrowing</code>：切入点方法抛出异常后执行；  </li><li><code>@Around</code>：环绕通知（最强大，可控制切入点方法的执行）。</li></ul></li></ul><p><strong>示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// 必须注册为Spring Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="comment">// 定义切入点：匹配com.demo.service包下所有public方法</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * com.demo.service..*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">servicePointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前置通知：方法执行前打印日志</span></span><br><span class="line">    <span class="meta">@Before(&quot;servicePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;方法&quot;</span> + methodName + <span class="string">&quot;开始执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 环绕通知：统计方法执行时间</span></span><br><span class="line">    <span class="meta">@Around(&quot;servicePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed(); <span class="comment">// 执行原方法</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行耗时：&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="八、参数校验注解"><a href="#八、参数校验注解" class="headerlink" title="八、参数校验注解"></a>八、参数校验注解</h3><p>基于JSR303&#x2F;JSR380，配合<code>@Valid</code>&#x2F;<code>@Validated</code>实现请求参数校验，常用注解：  </p><table><thead><tr><th>注解</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>@NotNull</td><td>字段不能为null</td><td><code>@NotNull(message = &quot;ID不能为空&quot;)</code></td></tr><tr><td>@NotBlank</td><td>字符串不能为null&#x2F;空串&#x2F;全空格</td><td><code>@NotBlank(message = &quot;姓名不能为空&quot;)</code></td></tr><tr><td>@NotEmpty</td><td>集合&#x2F;数组不能为null&#x2F;空</td><td><code>@NotEmpty(message = &quot;列表不能为空&quot;)</code></td></tr><tr><td>@Size</td><td>字符串&#x2F;集合长度范围</td><td><code>@Size(min = 6, max = 20, message = &quot;密码长度6-20位&quot;)</code></td></tr><tr><td>@Email</td><td>字符串需符合邮箱格式</td><td><code>@Email(message = &quot;邮箱格式错误&quot;)</code></td></tr><tr><td>@Pattern</td><td>字符串匹配正则表达式</td><td><code>@Pattern(regexp = &quot;^\\d{11}$&quot;, message = &quot;手机号格式错误&quot;)</code></td></tr></tbody></table><p><strong>使用示例</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;ID不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;姓名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 2, max = 10, message = &quot;姓名长度2-10位&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^\\d&#123;11&#125;$&quot;, message = &quot;手机号格式错误&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制器</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">// @Valid：校验请求体参数</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addUser</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserDTO userDTO, BindingResult result)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理校验结果</span></span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> result.getFieldError().getDefaultMessage();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;添加成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：  </p><ul><li><code>@Valid</code>是JSR303注解，<code>@Validated</code>是Spring扩展（支持分组校验）；  </li><li>需引入依赖<code>spring-boot-starter-validation</code>（SpringBoot 2.3+需手动引入）。</li></ul><h3 id="九、其他高频注解"><a href="#九、其他高频注解" class="headerlink" title="九、其他高频注解"></a>九、其他高频注解</h3><table><thead><tr><th>注解</th><th>作用</th></tr></thead><tbody><tr><td>@Component</td><td>通用Bean注解，标记类为Spring组件（@Service&#x2F;@Repository&#x2F;@Controller都是其派生）</td></tr><tr><td>@Service</td><td>标记类为业务层（Service）Bean，语义更清晰</td></tr><tr><td>@PostConstruct</td><td>标记方法在Bean初始化后执行（构造方法之后，init-method之前）</td></tr><tr><td>@PreDestroy</td><td>标记方法在Bean销毁前执行</td></tr><tr><td>@Profile</td><td>按环境加载Bean（如dev&#x2F;test&#x2F;prod）</td></tr><tr><td>@Async</td><td>标记方法为异步执行（需配合<code>@EnableAsync</code>在启动类）</td></tr><tr><td>@Scheduled</td><td>标记方法为定时任务（需配合<code>@EnableScheduling</code>在启动类）</td></tr></tbody></table><p><strong>示例（定时任务）</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span> <span class="comment">// 开启定时任务</span></span><br><span class="line"><span class="meta">@EnableAsync</span> <span class="comment">// 开启异步</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskService</span> &#123;</span><br><span class="line">    <span class="comment">// 每5秒执行一次</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 5000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fixedRateTask</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定时任务执行：&quot;</span> + LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异步方法</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;String&gt; <span class="title function_">asyncTask</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;异步任务完成&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>SpringBoot注解的核心逻辑是「约定大于配置」，以上注解覆盖了<strong>启动配置、Web开发、依赖注入、事务、数据访问、AOP、校验、定时任务</strong>等核心场景。实际开发中：  </p><ol><li>启动类必加<code>@SpringBootApplication</code>；  </li><li>Web层用<code>@RestController + @GetMapping/@PostMapping</code>；  </li><li>配置用<code>@Configuration + @Bean</code>或<code>@ConfigurationProperties</code>；  </li><li>依赖注入优先用<code>@Autowired + @Qualifier</code>或<code>@Resource</code>；  </li><li>事务用<code>@Transactional</code>；  </li><li>通用横切逻辑用AOP注解；  </li><li>参数校验用<code>@Valid + JSR303注解</code>。</li></ol><p>掌握这些注解，就能高效完成SpringBoot Web开发的绝大部分场景。</p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sa-Token鉴权学习：Vue结合SpringBoot实现角色权限控制</title>
      <link href="/2026/01/03/sa-token%20%E9%89%B4%E6%9D%83%E5%AD%A6%E4%B9%A0%202026_1_3/"/>
      <url>/2026/01/03/sa-token%20%E9%89%B4%E6%9D%83%E5%AD%A6%E4%B9%A0%202026_1_3/</url>
      
        <content type="html"><![CDATA[<p>要实现 Vue 框架结合 Sa-Token 按<strong>不同身份（角色&#x2F;权限）展示不同功能板块</strong>，核心是<strong>前后端协同</strong>：</p><ul><li>后端：基于 Sa-Token 完成登录认证、角色&#x2F;权限的校验与管理；</li><li>前端：通过 Sa-Token 返回的 Token 维持登录状态，结合路由守卫、权限指令控制功能板块的显示&#x2F;隐藏。</li></ul><p>以下是完整的实现方案（涵盖 Vue2&#x2F;Vue3，以 Vue3 + Pinia 为例，Vue2 仅需替换状态管理为 Vuex 即可）。</p><h3 id="一、核心原理"><a href="#一、核心原理" class="headerlink" title="一、核心原理"></a>一、核心原理</h3><table><thead><tr><th>端</th><th>核心职责</th></tr></thead><tbody><tr><td>后端</td><td>1. 登录时生成 Sa-Token，绑定用户角色&#x2F;权限；   2. 接口层通过 Sa-Token 注解（@SaCheckRole&#x2F;@SaCheckPermission）校验权限；   3. 提供接口返回当前用户的角色&#x2F;权限列表。</td></tr><tr><td>前端 Vue</td><td>1. 登录后存储 Token 和用户角色&#x2F;权限；   2. 路由守卫拦截无权限路由；   3. 自定义指令&#x2F;工具函数控制页面内功能板块的显示；   4. 请求拦截器携带 Token 完成鉴权。</td></tr></tbody></table><h3 id="二、后端实现（Spring-Boot-Sa-Token）"><a href="#二、后端实现（Spring-Boot-Sa-Token）" class="headerlink" title="二、后端实现（Spring Boot + Sa-Token）"></a>二、后端实现（Spring Boot + Sa-Token）</h3><p>先完成后端的 Sa-Token 配置和鉴权逻辑，为前端提供支撑。</p><h4 id="1-依赖引入（Maven）"><a href="#1-依赖引入（Maven）" class="headerlink" title="1. 依赖引入（Maven）"></a>1. 依赖引入（Maven）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- Sa-Token 核心 --></span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.dev33<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sa-token-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.38.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment"><!-- Sa-Token 权限注解（可选，简化权限校验） --></span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.dev33<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sa-token-dao-redis-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.38.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-Sa-Token-基础配置（application-yml）"><a href="#2-Sa-Token-基础配置（application-yml）" class="headerlink" title="2. Sa-Token 基础配置（application.yml）"></a>2. Sa-Token 基础配置（application.yml）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sa-token:</span></span><br><span class="line">  <span class="comment"># Token 名称（前端请求头中携带的名称）</span></span><br><span class="line">  <span class="attr">token-name:</span> <span class="string">satoken</span></span><br><span class="line">  <span class="comment"># Token 有效期（7天，单位：秒）</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">604800</span></span><br><span class="line">  <span class="comment"># 无感刷新时间（3天，单位：秒）</span></span><br><span class="line">  <span class="attr">active-timeout:</span> <span class="number">259200</span></span><br><span class="line">  <span class="comment"># 是否允许同一账号多地登录</span></span><br><span class="line">  <span class="attr">is-concurrent:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Token 风格（JWT 格式）</span></span><br><span class="line">  <span class="attr">token-style:</span> <span class="string">jwt</span></span><br><span class="line">  <span class="comment"># 输出日志</span></span><br><span class="line">  <span class="attr">is-log:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="3-核心业务实现"><a href="#3-核心业务实现" class="headerlink" title="3. 核心业务实现"></a>3. 核心业务实现</h4><h5 id="（1）用户实体与权限枚举"><a href="#（1）用户实体与权限枚举" class="headerlink" title="（1）用户实体与权限枚举"></a>（1）用户实体与权限枚举</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 角色枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RoleEnum</span> &#123;</span><br><span class="line">    ADMIN(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;超级管理员&quot;</span>),</span><br><span class="line">    USER(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;普通用户&quot;</span>),</span><br><span class="line">    OPERATOR(<span class="string">&quot;operator&quot;</span>, <span class="string">&quot;运营人员&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;</span><br><span class="line">    <span class="comment">// 构造器、getter 略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 权限枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">PermEnum</span> &#123;</span><br><span class="line">    USER_ADD(<span class="string">&quot;user:add&quot;</span>, <span class="string">&quot;添加用户&quot;</span>),</span><br><span class="line">    USER_DEL(<span class="string">&quot;user:del&quot;</span>, <span class="string">&quot;删除用户&quot;</span>),</span><br><span class="line">    ORDER_VIEW(<span class="string">&quot;order:view&quot;</span>, <span class="string">&quot;查看订单&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;</span><br><span class="line">    <span class="comment">// 构造器、getter 略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户DTO（返回给前端）</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="comment">// 用户角色列表（如 [&quot;admin&quot;, &quot;user&quot;]）</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; roles;</span><br><span class="line">    <span class="comment">// 用户权限列表（如 [&quot;user:add&quot;, &quot;order:view&quot;]）</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; permissions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="（2）登录接口（核心）"><a href="#（2）登录接口（核心）" class="headerlink" title="（2）登录接口（核心）"></a>（2）登录接口（核心）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录接口</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;UserInfoDTO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginDTO loginDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 校验账号密码（业务逻辑，自行实现）</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.verifyUser(loginDTO.getUsername(), loginDTO.getPassword());</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.error(<span class="string">&quot;账号或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. Sa-Token 登录：将用户ID作为登录标识</span></span><br><span class="line">        StpUtil.login(user.getId());</span><br><span class="line">        <span class="comment">// 3. 绑定角色和权限（可存储到 Sa-Token 上下文，也可返回给前端）</span></span><br><span class="line">        List&lt;String&gt; roles = userService.getRolesByUserId(user.getId());</span><br><span class="line">        List&lt;String&gt; permissions = userService.getPermissionsByUserId(user.getId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 构造返回给前端的用户信息</span></span><br><span class="line">        <span class="type">UserInfoDTO</span> <span class="variable">userInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfoDTO</span>();</span><br><span class="line">        userInfo.setId(user.getId());</span><br><span class="line">        userInfo.setUsername(user.getUsername());</span><br><span class="line">        userInfo.setRoles(roles);</span><br><span class="line">        userInfo.setPermissions(permissions);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(userInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前登录用户信息（前端刷新页面时调用）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/current-user&quot;)</span></span><br><span class="line">    <span class="comment">// Sa-Token 注解：校验是否登录，未登录自动抛出异常</span></span><br><span class="line">    <span class="meta">@SaCheckLogin</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;UserInfoDTO&gt; <span class="title function_">getCurrentUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取当前登录用户ID</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> StpUtil.getLoginIdAsLong();</span><br><span class="line">        <span class="type">UserInfoDTO</span> <span class="variable">userInfo</span> <span class="operator">=</span> userService.getUserInfoById(userId);</span><br><span class="line">        <span class="keyword">return</span> Result.success(userInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 退出登录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="meta">@SaCheckLogin</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        StpUtil.logout();</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="（3）权限拦截接口（示例）"><a href="#（3）权限拦截接口（示例）" class="headerlink" title="（3）权限拦截接口（示例）"></a>（3）权限拦截接口（示例）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户：仅管理员可访问</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="meta">@SaCheckRole(&quot;admin&quot;)</span> <span class="comment">// 校验角色为admin</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑</span></span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;添加用户成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看订单：需要 order:view 权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/order&quot;)</span></span><br><span class="line">    <span class="meta">@SaCheckPermission(&quot;order:view&quot;)</span> <span class="comment">// 校验权限</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;List&lt;OrderDTO&gt;&gt; <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑</span></span><br><span class="line">        <span class="keyword">return</span> Result.success(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="三、前端-Vue-实现"><a href="#三、前端-Vue-实现" class="headerlink" title="三、前端 Vue 实现"></a>三、前端 Vue 实现</h3><p>基于 Vue3 + Pinia + 之前封装的 <code>request.js</code> 实现，核心是<strong>状态管理、路由鉴权、组件级权限控制</strong>。</p><h4 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h4><p>（1）封装的 <code>request.js</code> 中添加 Token 携带逻辑（已在之前的封装中包含，补充适配 Sa-Token）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// request.js 中的请求拦截器部分</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 从Pinia获取Token，添加到请求头（Sa-Token默认名称为satoken）</span></span><br><span class="line">    <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">    <span class="keyword">if</span> (userStore.<span class="property">token</span>) &#123;</span><br><span class="line">      config.<span class="property">headers</span>.<span class="property">satoken</span> = userStore.<span class="property">token</span>; <span class="comment">// 关键：匹配后端sa-token的token-name</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他逻辑（重复请求、loading等）不变</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>（2）创建 Pinia 状态管理（存储 Token 和用户权限）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/stores/user.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; get, post &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;satoken&#x27;</span>) || <span class="string">&#x27;&#x27;</span>, <span class="comment">// 持久化存储Token</span></span><br><span class="line">    <span class="attr">userInfo</span>: &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">roles</span>: [], <span class="comment">// 角色列表</span></span><br><span class="line">      <span class="attr">permissions</span>: [] <span class="comment">// 权限列表</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 登录：存储Token和用户信息</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">loginForm</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">post</span>(<span class="string">&#x27;/api/auth/login&#x27;</span>, loginForm);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">token</span> = res.<span class="property">data</span>.<span class="property">satoken</span>; <span class="comment">// 后端返回的Token（或从响应头取）</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userInfo</span> = res.<span class="property">data</span>;</span><br><span class="line">      <span class="comment">// 持久化Token，防止页面刷新丢失</span></span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;satoken&#x27;</span>, <span class="variable language_">this</span>.<span class="property">token</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前用户信息（刷新页面时调用）</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCurrentUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">get</span>(<span class="string">&#x27;/api/auth/current-user&#x27;</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userInfo</span> = res.<span class="property">data</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 退出登录</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">post</span>(<span class="string">&#x27;/api/auth/logout&#x27;</span>);</span><br><span class="line">      <span class="comment">// 清空状态和本地存储</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">token</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">userInfo</span> = &#123; <span class="attr">id</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">roles</span>: [], <span class="attr">permissions</span>: [] &#125;;</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;satoken&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否有指定角色</span></span><br><span class="line">    <span class="title function_">hasRole</span>(<span class="params">role</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">userInfo</span>.<span class="property">roles</span>.<span class="title function_">includes</span>(role);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否有指定权限</span></span><br><span class="line">    <span class="title function_">hasPermission</span>(<span class="params">permission</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">userInfo</span>.<span class="property">permissions</span>.<span class="title function_">includes</span>(permission);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="2-路由鉴权（核心：控制页面级访问）"><a href="#2-路由鉴权（核心：控制页面级访问）" class="headerlink" title="2. 路由鉴权（核心：控制页面级访问）"></a>2. 路由鉴权（核心：控制页面级访问）</h4><p>（1）路由配置（添加 <code>meta</code> 元信息，声明角色&#x2F;权限要求）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/user&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;@/layout/Layout.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/Login.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">false</span> &#125; <span class="comment">// 无需登录即可访问</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;, <span class="comment">// 需要登录</span></span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      <span class="comment">// 首页：所有登录用户可访问</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/Home.vue&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 用户管理：仅admin角色可访问</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;User&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/User.vue&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;用户管理&#x27;</span>, <span class="attr">roles</span>: [<span class="string">&#x27;admin&#x27;</span>] &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 订单管理：需要 order:view 权限</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;order&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Order&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/Order.vue&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;订单管理&#x27;</span>, <span class="attr">permissions</span>: [<span class="string">&#x27;order:view&#x27;</span>] &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 运营面板：仅operator角色可访问</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;operator&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Operator&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/Operator.vue&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;运营面板&#x27;</span>, <span class="attr">roles</span>: [<span class="string">&#x27;operator&#x27;</span>] &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:pathMatch(.*)*&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span> &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">BASE_URL</span>),</span><br><span class="line">  routes</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局前置守卫：鉴权核心</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="title function_">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">  <span class="keyword">const</span> isLogin = !!userStore.<span class="property">token</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 未登录：跳登录页（除了登录页本身）</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">requiresAuth</span> &amp;&amp; !isLogin) &#123;</span><br><span class="line">    <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>, <span class="attr">query</span>: &#123; <span class="attr">redirect</span>: to.<span class="property">fullPath</span> &#125; &#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 已登录：刷新用户信息（首次进入/刷新页面）</span></span><br><span class="line">  <span class="keyword">if</span> (isLogin &amp;&amp; !userStore.<span class="property">userInfo</span>.<span class="property">username</span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> userStore.<span class="title function_">getCurrentUser</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 权限校验：检查角色/权限</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">roles</span>) &#123;</span><br><span class="line">    <span class="comment">// 校验角色：只要有一个匹配即可</span></span><br><span class="line">    <span class="keyword">const</span> hasRole = to.<span class="property">meta</span>.<span class="property">roles</span>.<span class="title function_">some</span>(<span class="function"><span class="params">role</span> =&gt;</span> userStore.<span class="title function_">hasRole</span>(role));</span><br><span class="line">    <span class="keyword">if</span> (!hasRole) &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;无访问权限，请联系管理员&#x27;</span>);</span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span> &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">permissions</span>) &#123;</span><br><span class="line">    <span class="comment">// 校验权限：只要有一个匹配即可</span></span><br><span class="line">    <span class="keyword">const</span> hasPermission = to.<span class="property">meta</span>.<span class="property">permissions</span>.<span class="title function_">some</span>(<span class="function"><span class="params">perm</span> =&gt;</span> userStore.<span class="title function_">hasPermission</span>(perm));</span><br><span class="line">    <span class="keyword">if</span> (!hasPermission) &#123;</span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;无操作权限，请联系管理员&#x27;</span>);</span><br><span class="line">      <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span> &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 全部通过，放行</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure><h4 id="3-组件级权限控制（控制功能板块-按钮显示）"><a href="#3-组件级权限控制（控制功能板块-按钮显示）" class="headerlink" title="3. 组件级权限控制（控制功能板块&#x2F;按钮显示）"></a>3. 组件级权限控制（控制功能板块&#x2F;按钮显示）</h4><p>通过<strong>自定义指令</strong>实现细粒度的权限控制（如按钮、功能板块的显示&#x2F;隐藏）。</p><p>（1）创建权限指令：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/directives/permission.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 角色指令：v-role=&quot;[&#x27;admin&#x27;]&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> roleDirective = &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">    <span class="keyword">const</span> requiredRoles = binding.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(requiredRoles)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无匹配角色则隐藏元素</span></span><br><span class="line">    <span class="keyword">const</span> hasRole = requiredRoles.<span class="title function_">some</span>(<span class="function"><span class="params">role</span> =&gt;</span> userStore.<span class="title function_">hasRole</span>(role));</span><br><span class="line">    <span class="keyword">if</span> (!hasRole) &#123;</span><br><span class="line">      el.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">      <span class="comment">// 彻底移除（可选）：el.parentNode?.removeChild(el);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 权限指令：v-permission=&quot;[&#x27;user:add&#x27;]&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> permissionDirective = &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">    <span class="keyword">const</span> requiredPerms = binding.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(requiredPerms)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无匹配权限则隐藏元素</span></span><br><span class="line">    <span class="keyword">const</span> hasPerm = requiredPerms.<span class="title function_">some</span>(<span class="function"><span class="params">perm</span> =&gt;</span> userStore.<span class="title function_">hasPermission</span>(perm));</span><br><span class="line">    <span class="keyword">if</span> (!hasPerm) &#123;</span><br><span class="line">      el.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>（2）注册全局指令（main.js）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; roleDirective, permissionDirective &#125; <span class="keyword">from</span> <span class="string">&#x27;@/directives/permission&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">createPinia</span>());</span><br><span class="line">app.<span class="title function_">use</span>(router);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册权限指令</span></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;role&#x27;</span>, roleDirective);</span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;permission&#x27;</span>, permissionDirective);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><p>（3）组件中使用（控制功能板块&#x2F;按钮）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><!-- src/views/User.vue --></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;user-page&quot;&gt;</span><br><span class="line">    <!-- 仅管理员可见的“添加用户”按钮 --></span><br><span class="line">    &lt;el-button </span><br><span class="line">      type=&quot;primary&quot; </span><br><span class="line">      v-permission=&quot;[&#x27;user:add&#x27;]&quot;</span><br><span class="line">      @click=&quot;addUser&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      添加用户</span><br><span class="line">    &lt;/el-button&gt;</span><br><span class="line">    <!-- 仅运营人员可见的“运营面板”板块 --></span><br><span class="line">    &lt;div v-role=&quot;[&#x27;operator&#x27;]&quot; class=&quot;operator-panel&quot;&gt;</span><br><span class="line">      &lt;h3&gt;运营数据统计&lt;/h3&gt;</span><br><span class="line">      <!-- 运营相关内容 --></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    <!-- 也可通过工具函数判断（适合复杂逻辑） --></span><br><span class="line">    &lt;el-button </span><br><span class="line">      type=&quot;danger&quot; </span><br><span class="line">      v-if=&quot;userStore.hasPermission(&#x27;user:del&#x27;)&quot;</span><br><span class="line">      @click=&quot;delUser&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      删除用户</span><br><span class="line">    &lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/stores/user&#x27;;</span><br><span class="line">const userStore = useUserStore();</span><br><span class="line"></span><br><span class="line">const addUser = () =&gt; &#123; /* 业务逻辑 */ &#125;;</span><br><span class="line">const delUser = () =&gt; &#123; /* 业务逻辑 */ &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4-登录-退出逻辑（页面示例）"><a href="#4-登录-退出逻辑（页面示例）" class="headerlink" title="4. 登录&#x2F;退出逻辑（页面示例）"></a>4. 登录&#x2F;退出逻辑（页面示例）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><!-- src/views/Login.vue --></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-form :model=&quot;loginForm&quot; @submit.prevent=&quot;handleLogin&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;用户名&quot; prop=&quot;username&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;loginForm.username&quot; /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;loginForm.password&quot; type=&quot;password&quot; /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; native-type=&quot;submit&quot;&gt;登录&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; useUserStore &#125; from &#x27;@/stores/user&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line">import &#123; ElMessage &#125; from &#x27;element-plus&#x27;;</span><br><span class="line"></span><br><span class="line">const loginForm = ref(&#123; username: &#x27;&#x27;, password: &#x27;&#x27; &#125;);</span><br><span class="line">const userStore = useUserStore();</span><br><span class="line">const router = useRouter();</span><br><span class="line"></span><br><span class="line">const handleLogin = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    await userStore.login(loginForm.value);</span><br><span class="line">    // 跳转到之前的页面（或首页）</span><br><span class="line">    const redirect = router.currentRoute.query.redirect || &#x27;/home&#x27;;</span><br><span class="line">    router.push(redirect);</span><br><span class="line">    ElMessage.success(&#x27;登录成功&#x27;);</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    ElMessage.error(&#x27;登录失败，请检查账号密码&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="四、效果演示"><a href="#四、效果演示" class="headerlink" title="四、效果演示"></a>四、效果演示</h3><table><thead><tr><th>用户角色</th><th>可访问页面</th><th>可操作功能</th></tr></thead><tbody><tr><td>admin</td><td>首页、用户管理、订单管理</td><td>添加用户、删除用户、查看订单</td></tr><tr><td>user</td><td>首页、订单管理</td><td>仅查看订单</td></tr><tr><td>operator</td><td>首页、运营面板</td><td>仅查看运营数据</td></tr></tbody></table><h3 id="五、关键注意事项"><a href="#五、关键注意事项" class="headerlink" title="五、关键注意事项"></a>五、关键注意事项</h3><ol><li><strong>Token 持久化</strong>：前端需将 Token 存储到 <code>localStorage</code>&#x2F;<code>sessionStorage</code>，防止页面刷新丢失；</li><li><strong>无感刷新 Token</strong>：结合 Sa-Token 的 <code>active-timeout</code>，前端可在 Token 过期前调用 <code>StpUtil.renewTimeout()</code> 刷新有效期（后端提供刷新接口）；</li><li><strong>权限缓存</strong>：用户角色&#x2F;权限可缓存到前端，无需每次请求接口都校验；</li><li><strong>后端兜底校验</strong>：前端权限控制仅为“展示层面”，核心权限校验必须在后端通过 <code>@SaCheckRole/@SaCheckPermission</code> 实现，防止前端篡改；</li><li><strong>Vue2 适配</strong>：将 Pinia 替换为 Vuex，指令注册方式改为 <code>Vue.directive</code>，路由守卫逻辑一致。</li></ol><h3 id="六、扩展优化"><a href="#六、扩展优化" class="headerlink" title="六、扩展优化"></a>六、扩展优化</h3><ol><li><strong>动态路由</strong>：若权限配置从后端动态获取，可在登录后通过 <code>router.addRoute</code> 动态添加路由，进一步细化权限；</li><li><strong>按钮级别禁用</strong>：除了隐藏，还可通过指令禁用按钮（<code>el.disabled = true</code>），提升用户体验；</li><li><strong>权限缓存刷新</strong>：当用户权限变更时，主动刷新前端缓存的权限列表；</li><li><strong>多标签页适配</strong>：通过 <code>localStorage</code> 监听，实现多标签页登录状态同步。</li></ol><p>通过以上方案，即可完整实现 Vue 框架基于 Sa-Token 的“不同身份展示不同功能板块”，兼顾安全性和易用性。</p>]]></content>
      
      
      <categories>
          
          <category> 安全认证 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>前端通用axios封装：request.js最佳实践</title>
      <link href="/2026/01/03/%E9%80%9A%E7%94%A8%E7%9A%84%20request.js%202026_1_3/"/>
      <url>/2026/01/03/%E9%80%9A%E7%94%A8%E7%9A%84%20request.js%202026_1_3/</url>
      
        <content type="html"><![CDATA[<p>以下是一个<strong>功能完善、可扩展、鲁棒性强</strong>的 axios 通用封装（request.js），涵盖请求&#x2F;响应拦截、错误统一处理、重复请求取消、请求配置扩展、常用请求方法封装等核心能力，适配大部分前端项目场景。</p><h3 id="最终代码（request-js）"><a href="#最终代码（request-js）" class="headerlink" title="最终代码（request.js）"></a>最终代码（request.js）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span>, <span class="title class_">ElMessageBox</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>; <span class="comment">// 适配Vue3+Element Plus，可替换为其他UI库</span></span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/user&#x27;</span>; <span class="comment">// 示例：Vue3 Pinia用户状态，可替换为Vuex/本地存储</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================== 核心配置 =====================</span></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_API_BASE_URL</span>, <span class="comment">// 环境变量配置接口前缀（Vite）</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">10000</span>, <span class="comment">// 请求超时时间</span></span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span> <span class="comment">// 默认请求头</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================== 重复请求取消机制 =====================</span></span><br><span class="line"><span class="comment">// 存储正在进行的请求 &#123; url: CancelTokenSource &#125;</span></span><br><span class="line"><span class="keyword">const</span> pendingRequests = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成请求唯一标识（method + url + 参数）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config axios配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">String</span>&#125; 请求标识</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getRequestKey</span> = (<span class="params">config</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method, url, params, data &#125; = config;</span><br><span class="line">  <span class="keyword">return</span> [method, url, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(params), <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)].<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加待取消的请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config axios配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">addPendingRequest</span> = (<span class="params">config</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> requestKey = <span class="title function_">getRequestKey</span>(config);</span><br><span class="line">  <span class="comment">// 若已有相同请求，先取消再重新添加</span></span><br><span class="line">  <span class="keyword">if</span> (pendingRequests.<span class="title function_">has</span>(requestKey)) &#123;</span><br><span class="line">    pendingRequests.<span class="title function_">get</span>(requestKey).<span class="title function_">cancel</span>(<span class="string">&#x27;重复请求已取消&#x27;</span>);</span><br><span class="line">    pendingRequests.<span class="title function_">delete</span>(requestKey);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> source = axios.<span class="property">CancelToken</span>.<span class="title function_">source</span>();</span><br><span class="line">  config.<span class="property">cancelToken</span> = source.<span class="property">token</span>;</span><br><span class="line">  pendingRequests.<span class="title function_">set</span>(requestKey, source);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移除已完成/取消的请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config axios配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">removePendingRequest</span> = (<span class="params">config</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> requestKey = <span class="title function_">getRequestKey</span>(config);</span><br><span class="line">  <span class="keyword">if</span> (pendingRequests.<span class="title function_">has</span>(requestKey)) &#123;</span><br><span class="line">    pendingRequests.<span class="title function_">delete</span>(requestKey);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================== 请求拦截器 =====================</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 添加取消请求标识</span></span><br><span class="line">    <span class="title function_">addPendingRequest</span>(config);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 注入token（根据项目实际存储位置调整）</span></span><br><span class="line">    <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">    <span class="keyword">if</span> (userStore.<span class="property">token</span>) &#123;</span><br><span class="line">      config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;userStore.token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. GET请求参数处理（可选：防止参数为undefined导致请求异常）</span></span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">method</span> === <span class="string">&#x27;get&#x27;</span> &amp;&amp; config.<span class="property">params</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">entries</span>(config.<span class="property">params</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (value === <span class="literal">undefined</span>) &#123;</span><br><span class="line">          <span class="keyword">delete</span> config.<span class="property">params</span>[key];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 自定义请求配置扩展（如是否显示加载中）</span></span><br><span class="line">    config.<span class="property">loading</span> ??= <span class="literal">true</span>; <span class="comment">// 默认显示加载中，可通过请求配置覆盖</span></span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">loading</span>) &#123;</span><br><span class="line">      <span class="comment">// 示例：可在此处调用UI库的加载中组件（如ElLoading）</span></span><br><span class="line">      <span class="comment">// ElLoading.service(&#123; lock: true, text: &#x27;请求中...&#x27; &#125;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求参数异常，请检查！&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================== 响应拦截器 =====================</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 移除取消请求标识</span></span><br><span class="line">    <span class="title function_">removePendingRequest</span>(response.<span class="property">config</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 关闭加载中（若开启）</span></span><br><span class="line">    <span class="keyword">if</span> (response.<span class="property">config</span>.<span class="property">loading</span>) &#123;</span><br><span class="line">      <span class="comment">// ElLoading.service().close(); // 关闭加载中</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 解构响应数据（适配后端通用返回格式：&#123; code, msg, data &#125;）</span></span><br><span class="line">    <span class="keyword">const</span> &#123; code, msg, data &#125; = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 业务逻辑判断（根据后端约定调整）</span></span><br><span class="line">    <span class="keyword">if</span> (code === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="comment">// 成功：返回核心业务数据，简化上层调用</span></span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="comment">// 未登录/Token过期：统一处理登出逻辑</span></span><br><span class="line">      <span class="title class_">ElMessageBox</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;登录状态已过期，请重新登录&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&#x27;重新登录&#x27;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">        userStore.<span class="title function_">logout</span>(); <span class="comment">// 清空token、跳转登录页</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(msg || <span class="string">&#x27;登录过期&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 其他业务错误：统一提示</span></span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(msg || <span class="string">&#x27;请求失败&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(msg || <span class="string">&#x27;请求失败&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 移除取消请求标识</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">config</span>) &#123;</span><br><span class="line">      <span class="title function_">removePendingRequest</span>(error.<span class="property">config</span>);</span><br><span class="line">      <span class="comment">// 关闭加载中</span></span><br><span class="line">      <span class="keyword">if</span> (error.<span class="property">config</span>.<span class="property">loading</span>) &#123;</span><br><span class="line">        <span class="comment">// ElLoading.service().close();</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 错误分类处理</span></span><br><span class="line">    <span class="keyword">let</span> errorMsg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123;</span><br><span class="line">      <span class="comment">// 取消请求（重复请求）</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求已取消：&#x27;</span>, error.<span class="property">message</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">&#x27;timeout&#x27;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 超时错误</span></span><br><span class="line">      errorMsg = <span class="string">&#x27;请求超时，请检查网络！&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.<span class="property">response</span>) &#123;</span><br><span class="line">      <span class="comment">// HTTP状态码错误（4xx/5xx）</span></span><br><span class="line">      <span class="keyword">const</span> status = error.<span class="property">response</span>.<span class="property">status</span>;</span><br><span class="line">      <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">400</span>:</span><br><span class="line">          errorMsg = <span class="string">&#x27;请求参数错误！&#x27;</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">          errorMsg = <span class="string">&#x27;权限不足，无法访问！&#x27;</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">          errorMsg = <span class="string">&#x27;请求接口不存在！&#x27;</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">          errorMsg = <span class="string">&#x27;服务器内部错误，请稍后重试！&#x27;</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          errorMsg = <span class="string">`请求失败（<span class="subst">$&#123;status&#125;</span>）：<span class="subst">$&#123;error.response.data?.msg || <span class="string">&#x27;未知错误&#x27;</span>&#125;</span>`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 网络错误（无响应）</span></span><br><span class="line">      errorMsg = <span class="string">&#x27;网络异常，请检查网络连接！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 统一错误提示</span></span><br><span class="line">    <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(errorMsg);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================== 封装通用请求方法 =====================</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GET请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; url 接口地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; params 请求参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config 自定义配置（如loading: false）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">get</span> = (<span class="params">url, params = &#123;&#125;, config = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> service.<span class="title function_">get</span>(url, &#123; params, ...config &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * POST请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; url 接口地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; data 请求体数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config 自定义配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">post</span> = (<span class="params">url, data = &#123;&#125;, config = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> service.<span class="title function_">post</span>(url, data, config);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PUT请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; url 接口地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; data 请求体数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config 自定义配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">put</span> = (<span class="params">url, data = &#123;&#125;, config = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> service.<span class="title function_">put</span>(url, data, config);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DELETE请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; url 接口地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; params 请求参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config 自定义配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">del</span> = (<span class="params">url, params = &#123;&#125;, config = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> service.<span class="title function_">delete</span>(url, &#123; params, ...config &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件（FormData）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; url 接口地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">FormData</span>&#125; formData 表单数据（含文件）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config 自定义配置（如进度回调）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">upload</span> = (<span class="params">url, formData, config = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> service.<span class="title function_">post</span>(url, formData, &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">60000</span>, <span class="comment">// 上传超时时间延长</span></span><br><span class="line">    ...config</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出默认实例（保留原生能力，按需使用）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure><h3 id="核心功能说明"><a href="#核心功能说明" class="headerlink" title="核心功能说明"></a>核心功能说明</h3><h4 id="1-基础配置"><a href="#1-基础配置" class="headerlink" title="1. 基础配置"></a>1. 基础配置</h4><ul><li>基于环境变量配置 <code>baseURL</code>（适配 Vite 项目，Webpack 可替换为 <code>process.env.VUE_APP_API_BASE_URL</code>）；</li><li>默认超时时间 10s，可通过请求配置覆盖；</li><li>统一设置 <code>Content-Type</code> 为 JSON 格式。</li></ul><h4 id="2-重复请求取消"><a href="#2-重复请求取消" class="headerlink" title="2. 重复请求取消"></a>2. 重复请求取消</h4><ul><li>用 <code>Map</code> 存储请求标识和取消令牌，避免同一时间重复发起相同请求；</li><li>请求发起前检查是否已有相同请求，有则取消旧请求，保证请求唯一性。</li></ul><h4 id="3-请求拦截器"><a href="#3-请求拦截器" class="headerlink" title="3. 请求拦截器"></a>3. 请求拦截器</h4><ul><li>自动注入 Token（适配 Vue3 Pinia，可替换为 Vuex&#x2F;<code>localStorage</code>）；</li><li>处理 GET 请求参数（移除 <code>undefined</code> 参数，避免请求异常）；</li><li>支持自定义加载中状态（默认开启，可通过请求配置关闭）。</li></ul><h4 id="4-响应拦截器"><a href="#4-响应拦截器" class="headerlink" title="4. 响应拦截器"></a>4. 响应拦截器</h4><ul><li>统一解析后端返回格式（<code>{ code, msg, data }</code>），成功时直接返回 <code>data</code>，简化上层调用；</li><li>针对 401（登录过期）做统一登出处理；</li><li>分类处理错误：取消请求、超时、HTTP 状态码、网络异常，给出精准提示。</li></ul><h4 id="5-通用方法封装"><a href="#5-通用方法封装" class="headerlink" title="5. 通用方法封装"></a>5. 通用方法封装</h4><ul><li>封装 <code>get/post/put/del</code> 常用方法，简化调用；</li><li>单独封装 <code>upload</code> 方法，适配文件上传（调整请求头、延长超时时间）。</li></ul><h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; get, post, upload &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. GET请求</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getUserList</span> = <span class="keyword">async</span> (<span class="params">page, size</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">get</span>(<span class="string">&#x27;/user/list&#x27;</span>, &#123; page, size &#125;, &#123; <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户列表：&#x27;</span>, data);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败：&#x27;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. POST请求</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">addUser</span> = <span class="keyword">async</span> (<span class="params">userInfo</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">post</span>(<span class="string">&#x27;/user/add&#x27;</span>, userInfo);</span><br><span class="line">    <span class="title class_">ElMessage</span>.<span class="title function_">success</span>(<span class="string">&#x27;添加成功&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 无需手动提示，request.js已统一处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 文件上传</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">uploadFile</span> = <span class="keyword">async</span> (<span class="params">file</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">upload</span>(<span class="string">&#x27;/file/upload&#x27;</span>, formData, &#123;</span><br><span class="line">      <span class="attr">onUploadProgress</span>: <span class="function">(<span class="params">progressEvent</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> progress = (progressEvent.<span class="property">loaded</span> / progressEvent.<span class="property">total</span>) * <span class="number">100</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;上传进度：&#x27;</span>, progress);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">ElMessage</span>.<span class="title function_">success</span>(<span class="string">&#x27;上传成功&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 异常处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="扩展与适配"><a href="#扩展与适配" class="headerlink" title="扩展与适配"></a>扩展与适配</h3><ol><li><strong>UI 库替换</strong>：若不用 Element Plus，可将 <code>ElMessage/ElMessageBox</code> 替换为其他 UI 库的提示组件（如 Ant Design Vue 的 <code>message/modal</code>），或自定义提示函数。</li><li><strong>状态管理适配</strong>：Token 存储若用 Vuex，替换 <code>useUserStore</code> 为 <code>store.dispatch/store.getters</code>；若用本地存储，直接读取 <code>localStorage.getItem(&#39;token&#39;)</code>。</li><li><strong>后端返回格式调整</strong>：若后端返回格式不是 <code>{ code, msg, data }</code>，修改响应拦截器中的解析逻辑即可。</li><li><strong>请求加载中</strong>：可集成 <code>ElLoading</code>（Element Plus）或自定义加载组件，在请求拦截器开启、响应拦截器关闭。</li><li><strong>更多配置</strong>：可扩展请求头、代理、SSL 验证等，直接在 <code>axios.create</code> 或请求配置中添加。</li></ol><h3 id="核心原则"><a href="#核心原则" class="headerlink" title="核心原则"></a>核心原则</h3><ul><li><strong>统一化</strong>：请求&#x2F;响应拦截统一处理通用逻辑（Token、错误、加载中），减少重复代码；</li><li><strong>可扩展</strong>：保留自定义配置入口，支持覆盖默认行为；</li><li><strong>鲁棒性</strong>：处理各类异常场景（重复请求、超时、网络错误、业务错误），避免页面崩溃；</li><li><strong>易用性</strong>：封装通用方法，上层调用只需关注接口地址和参数，无需关心底层逻辑。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 前端技术 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot文件上传下载接口实现</title>
      <link href="/2026/01/02/IO%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD%202026_1_2/"/>
      <url>/2026/01/02/IO%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD%202026_1_2/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Boot-学习编写上传下载接口"><a href="#Spring-Boot-学习编写上传下载接口" class="headerlink" title="Spring Boot 学习编写上传下载接口"></a>Spring Boot 学习编写上传下载接口</h1><h2 id="一、项目基础配置"><a href="#一、项目基础配置" class="headerlink" title="一、项目基础配置"></a>一、项目基础配置</h2><h3 id="1-核心配置文件（application-properties）"><a href="#1-核心配置文件（application-properties）" class="headerlink" title="1. 核心配置文件（application.properties）"></a>1. 核心配置文件（<code>application.properties</code>）</h3><p>文件上传下载的核心配置集中在<code>src/main/resources/application.properties</code>，主要包含以下关键配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件存储目录（相对路径，会在项目根目录下创建）</span></span><br><span class="line"><span class="attr">file.upload.dir</span>=<span class="string">uploads</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 自定义上传 配置（自定义，需在代码中读取）</span></span><br><span class="line"><span class="attr">file.upload.max-size</span>=<span class="string">10485760  # 单个文件最大限制（10MB，10*1024*1024）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Spring 内置 multipart 配置（必须配置，控制文件上传行为）</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.enabled</span>=<span class="string">true  # 启用文件上传</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.max-file-size</span>=<span class="string">10MB  # 单个文件最大大小（与自定义配置保持一致）</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.max-request-size</span>=<span class="string">50MB  # 单次请求总文件大小限制</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.file-size-threshold</span>=<span class="string">2KB  # 超过此大小的文件会写入磁盘（否则暂存内存）</span></span><br></pre></td></tr></table></figure><h2 id="二、文件上传接口实现（POST-api-file-upload）"><a href="#二、文件上传接口实现（POST-api-file-upload）" class="headerlink" title="二、文件上传接口实现（POST /api/file/upload）"></a>二、文件上传接口实现（<code>POST /api/file/upload</code>）</h2><h3 id="1-接口功能"><a href="#1-接口功能" class="headerlink" title="1. 接口功能"></a>1. 接口功能</h3><p>接收前端上传的单个或多个文件，保存到<code>file.upload.dir</code>配置的目录，并返回上传结果（如文件名、存储路径等）。</p><h3 id="2-核心技术点"><a href="#2-核心技术点" class="headerlink" title="2. 核心技术点"></a>2. 核心技术点</h3><ul><li>使用<code>org.springframework.web.multipart.MultipartFile</code>接收上传文件</li><li>生成唯一文件名（避免文件名冲突）</li><li>确保存储目录存在（若不存在则创建）</li><li>校验文件大小、文件非空等</li></ul><h3 id="3-代码实现思路"><a href="#3-代码实现思路" class="headerlink" title="3. 代码实现思路"></a>3. 代码实现思路</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从配置文件读取上传目录</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;file.upload.dir&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadDir;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从配置文件读取单个文件最大限制</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;file.upload.max-size&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> maxFileSize;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(&quot;files&quot;)</span> MultipartFile[] files)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; uploadedFiles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 校验上传目录是否存在，不存在则创建</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadDir);</span><br><span class="line">        <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">            dir.mkdirs(); <span class="comment">// 递归创建目录</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 处理每个上传的文件</span></span><br><span class="line">        <span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">            <span class="comment">// 校验文件非空</span></span><br><span class="line">            <span class="keyword">if</span> (file.isEmpty()) &#123;</span><br><span class="line">                result.put(<span class="string">&quot;success&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">                result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;文件不能为空&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.badRequest().body(result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 校验文件大小</span></span><br><span class="line">            <span class="keyword">if</span> (file.getSize() &gt; maxFileSize) &#123;</span><br><span class="line">                result.put(<span class="string">&quot;success&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">                result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;文件大小超过限制（最大10MB）&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.badRequest().body(result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 3. 生成唯一文件名（UUID + 原文件后缀）</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">                <span class="type">String</span> <span class="variable">fileExt</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">                <span class="type">String</span> <span class="variable">uniqueFileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + fileExt;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 4. 保存文件到目录</span></span><br><span class="line">                <span class="type">File</span> <span class="variable">dest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, uniqueFileName);</span><br><span class="line">                file.transferTo(dest); <span class="comment">// 将上传文件写入目标路径</span></span><br><span class="line"></span><br><span class="line">                uploadedFiles.add(uniqueFileName); <span class="comment">// 记录成功上传的文件名</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                result.put(<span class="string">&quot;success&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">                result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;文件上传失败：&quot;</span> + e.getMessage());</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>).body(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 返回成功结果</span></span><br><span class="line">        result.put(<span class="string">&quot;success&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;文件上传成功&quot;</span>);</span><br><span class="line">        result.put(<span class="string">&quot;files&quot;</span>, uploadedFiles);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、文件下载接口实现（GET-api-file-download-fileName-）"><a href="#三、文件下载接口实现（GET-api-file-download-fileName-）" class="headerlink" title="三、文件下载接口实现（GET /api/file/download/{fileName}）"></a>三、文件下载接口实现（<code>GET /api/file/download/{fileName}</code>）</h2><h3 id="1-接口功能-1"><a href="#1-接口功能-1" class="headerlink" title="1. 接口功能"></a>1. 接口功能</h3><p>根据文件名从存储目录读取文件，以附件形式返回给前端，触发浏览器下载。</p><h3 id="2-核心技术点-1"><a href="#2-核心技术点-1" class="headerlink" title="2. 核心技术点"></a>2. 核心技术点</h3><ul><li>通过文件名定位服务器上的文件</li><li>设置响应头（<code>Content-Type</code>、<code>Content-Disposition</code>）控制下载行为</li><li>以流的形式返回文件内容</li></ul><h3 id="3-代码实现思路-1"><a href="#3-代码实现思路-1" class="headerlink" title="3. 代码实现思路"></a>3. 代码实现思路</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/download/&#123;fileName&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="title function_">downloadFile</span><span class="params">(<span class="meta">@PathVariable</span> String fileName)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 构建文件路径</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadDir + File.separator + fileName);</span><br><span class="line">    <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.notFound().build(); <span class="comment">// 文件不存在返回404</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 创建文件资源对象</span></span><br><span class="line">    <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(file);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 推断文件MIME类型（用于Content-Type）</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        contentType = Files.probeContentType(file.toPath());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="comment">// 推断失败时使用默认类型</span></span><br><span class="line">        contentType = <span class="string">&quot;application/octet-stream&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 设置响应头，指定为附件（触发下载）</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok()</span><br><span class="line">            .contentType(MediaType.parseMediaType(contentType))</span><br><span class="line">            .header(HttpHeaders.CONTENT_DISPOSITION, </span><br><span class="line">                    <span class="string">&quot;attachment; filename=\&quot;&quot;</span> + resource.getFilename() + <span class="string">&quot;\&quot;&quot;</span>)</span><br><span class="line">            .body(resource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="四、文件预览接口（GET-api-file-preview-fileName-）"><a href="#四、文件预览接口（GET-api-file-preview-fileName-）" class="headerlink" title="四、文件预览接口（GET /api/file/preview/{fileName}）"></a>四、文件预览接口（<code>GET /api/file/preview/{fileName}</code>）</h2><h3 id="1-接口功能-2"><a href="#1-接口功能-2" class="headerlink" title="1. 接口功能"></a>1. 接口功能</h3><p>针对图片等可预览文件，直接在浏览器中显示（而非下载）。</p><h3 id="2-核心区别"><a href="#2-核心区别" class="headerlink" title="2. 核心区别"></a>2. 核心区别</h3><p>与下载接口的主要差异在于<code>Content-Disposition</code>头：预览时不设置<code>attachment</code>，浏览器会根据<code>Content-Type</code>自动渲染。</p><h3 id="3-代码实现思路-2"><a href="#3-代码实现思路-2" class="headerlink" title="3. 代码实现思路"></a>3. 代码实现思路</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/preview/&#123;fileName&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="title function_">previewFile</span><span class="params">(<span class="meta">@PathVariable</span> String fileName)</span> &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadDir + File.separator + fileName);</span><br><span class="line">    <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(file);</span><br><span class="line">    <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        contentType = Files.probeContentType(file.toPath());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        contentType = <span class="string">&quot;application/octet-stream&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关键：不设置attachment，浏览器会尝试预览</span></span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok()</span><br><span class="line">            .contentType(MediaType.parseMediaType(contentType))</span><br><span class="line">            .header(HttpHeaders.CONTENT_DISPOSITION, </span><br><span class="line">                    <span class="string">&quot;filename=\&quot;&quot;</span> + resource.getFilename() + <span class="string">&quot;\&quot;&quot;</span>)</span><br><span class="line">            .body(resource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="五、关键注意事项"><a href="#五、关键注意事项" class="headerlink" title="五、关键注意事项"></a>五、关键注意事项</h2><ol><li><strong>文件命名安全</strong><br>必须使用唯一文件名（如UUID），避免使用原始文件名（可能包含特殊字符或导致覆盖）。</li><li><strong>目录权限</strong><br>确保<code>file.upload.dir</code>目录有读写权限，否则会出现<code>Permission denied</code>异常。</li><li><strong>异常处理</strong>  <ul><li>捕获<code>MaxUploadSizeExceededException</code>（文件大小超限）</li><li>处理文件不存在、IO异常等场景，返回友好提示</li></ul></li><li><strong>前端配合</strong><br>上传时表单需设置<code>enctype=&quot;multipart/form-data&quot;</code>，支持多文件上传时<code>input</code>标签添加<code>multiple</code>属性。</li></ol><h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><p>通过上述配置和代码，可实现基础的文件上传、下载、预览功能。核心在于：  </p><ul><li>正确配置Spring的multipart参数  </li><li>安全处理文件存储（唯一命名、目录创建）  </li><li>合理设置响应头控制文件传输行为（下载&#x2F;预览）</li></ul><p>项目地址： <a href="https://github.com/zero201913/springboot-file-upload-test">https://github.com/zero201913/springboot-file-upload-test</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>从Ajax到jQuery到Axios：前端HTTP请求技术演变</title>
      <link href="/2026/01/01/Ajax%E5%88%B0Jquery%E5%88%B0Axios%202026_1_1/"/>
      <url>/2026/01/01/Ajax%E5%88%B0Jquery%E5%88%B0Axios%202026_1_1/</url>
      
        <content type="html"><![CDATA[<p>端发送HTTP请求的技术随发展不断简化，从原生AJAX到jQuery封装，再到axios库，核心目标均为与后端交互，但在API设计、易用性、功能完整性上逐步优化。以下是三者发送请求的核心代码及转变特点：</p><h2 id="1-原生AJAX（XMLHttpRequest）"><a href="#1-原生AJAX（XMLHttpRequest）" class="headerlink" title="1. 原生AJAX（XMLHttpRequest）"></a>1. 原生AJAX（XMLHttpRequest）</h2><p>原生AJAX基于XMLHttpRequest对象实现，是最早的前端请求方案，优点是无需依赖任何框架，但代码繁琐，需手动处理请求状态、响应解析等逻辑。</p><p>核心代码（GET请求）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建XMLHttpRequest对象</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"><span class="comment">// 配置请求：请求方式、URL、是否异步</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/api/user?userId=1&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 监听请求状态变化</span></span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// readyState=4表示请求完成，status=200表示响应成功</span></span><br><span class="line">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 解析响应数据（需手动处理JSON格式）</span></span><br><span class="line">        <span class="keyword">var</span> response = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求成功&#x27;</span>, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 处理请求错误</span></span><br><span class="line">xhr.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 发送请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure><p>核心代码（POST请求，提交JSON数据）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/api/user&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 设置请求头（提交JSON需指定Content-Type）</span></span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>);</span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> response = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;提交成功&#x27;</span>, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 发送JSON字符串数据</span></span><br><span class="line"><span class="keyword">var</span> data = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">username</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span>&#125;);</span><br><span class="line">xhr.<span class="title function_">send</span>(data);</span><br></pre></td></tr></table></figure><h2 id="2-jQuery-AJAX"><a href="#2-jQuery-AJAX" class="headerlink" title="2. jQuery AJAX"></a>2. jQuery AJAX</h2><p>jQuery对原生XMLHttpRequest进行了封装，提供了简洁的$.ajax()方法，简化了参数配置、错误处理、JSON解析等逻辑，还支持$.get()、$.post()等快捷方法，降低了使用门槛。</p><p>核心代码（$.ajax()通用方式）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET请求</span></span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/api/user&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;<span class="attr">userId</span>: <span class="number">1</span>&#125;, <span class="comment">// 自动拼接为URL参数</span></span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>, <span class="comment">// 自动解析JSON响应</span></span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求成功&#x27;</span>, response);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params">xhr, status, error</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// POST请求（提交JSON）</span></span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/api/user&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">contentType</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">username</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span>&#125;),</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;提交成功&#x27;</span>, response);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params">xhr, status, error</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;提交失败&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>快捷方法（$.get()、$.post()）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $.get()快捷获取数据</span></span><br><span class="line">$.<span class="title function_">get</span>(<span class="string">&#x27;/api/user&#x27;</span>, &#123;<span class="attr">userId</span>: <span class="number">1</span>&#125;, <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求成功&#x27;</span>, response);</span><br><span class="line">&#125;, <span class="string">&#x27;json&#x27;</span>).<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $.post()快捷提交数据（默认表单格式）</span></span><br><span class="line">$.<span class="title function_">post</span>(<span class="string">&#x27;/api/user&#x27;</span>, &#123;<span class="attr">username</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;提交成功&#x27;</span>, response);</span><br><span class="line">&#125;, <span class="string">&#x27;json&#x27;</span>).<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;提交失败&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="3-Axios"><a href="#3-Axios" class="headerlink" title="3. Axios"></a>3. Axios</h2><p>Axios是基于Promise的HTTP客户端，支持浏览器和Node.js环境，相比jQuery AJAX，它原生支持Promise、拦截器、请求取消等高级功能，API更简洁，且不依赖jQuery，是当前前端主流的请求方案。</p><p>核心代码（GET请求）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式1：直接调用axios.get()</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123;<span class="attr">userId</span>: <span class="number">1</span>&#125; <span class="comment">// 自动拼接URL参数</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">// response.data直接是解析后的JSON数据</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求成功&#x27;</span>, response.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2：使用async/await（更简洁的同步写法）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/user&#x27;</span>, &#123;<span class="attr">params</span>: &#123;<span class="attr">userId</span>: <span class="number">1</span>&#125;&#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求成功&#x27;</span>, response.<span class="property">data</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;请求失败&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心代码（POST请求，提交JSON）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式1：axios.post()</span></span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&#x27;/api/user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span> <span class="comment">// 自动序列化为JSON，默认设置Content-Type为application/json</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;提交成功&#x27;</span>, response.<span class="property">data</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;提交失败&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2：async/await</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">addUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/api/user&#x27;</span>, &#123;<span class="attr">username</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span>&#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;提交成功&#x27;</span>, response.<span class="property">data</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;提交失败&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-核心转变总结"><a href="#4-核心转变总结" class="headerlink" title="4. 核心转变总结"></a>4. 核心转变总结</h2><ol><li><strong>代码复杂度降低</strong>：从原生AJAX的多步手动配置，到jQuery的简洁配置项，再到axios的Promise化&#x2F;同步化写法，逐步减少冗余代码；</li><li><strong>功能逐步增强</strong>：axios新增了Promise支持、拦截器（请求&#x2F;响应拦截）、请求取消、自动JSON序列化&#x2F;解析等高级功能，满足复杂场景需求；</li><li><strong>依赖解耦</strong>：jQuery AJAX依赖jQuery框架，而axios是独立库，更适合现代前端工程化项目（如Vue、React项目）；</li><li><strong>错误处理优化</strong>：从原生的onerror事件，到jQuery的error回调，再到axios的catch捕获（支持Promise链式错误传递），错误处理更灵活可靠。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 前端技术 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Cookie和Session的应用详解：Web状态管理核心技术</title>
      <link href="/2026/01/01/Cookie%20%E5%92%8C%20Session%20%E7%9A%84%E5%BA%94%E7%94%A8%202026_1_1/"/>
      <url>/2026/01/01/Cookie%20%E5%92%8C%20Session%20%E7%9A%84%E5%BA%94%E7%94%A8%202026_1_1/</url>
      
        <content type="html"><![CDATA[<p>Cookie 和 Session 是 Web 开发中<strong>状态管理</strong>的核心技术（HTTP 协议本身是无状态的），二者互补且常配合使用，以下结合实际项目场景详细说明它们的应用、区别、最佳实践，以及框架（Spring Boot）中的落地方式。</p><h3 id="一、核心概念回顾"><a href="#一、核心概念回顾" class="headerlink" title="一、核心概念回顾"></a>一、核心概念回顾</h3><table><thead><tr><th>特性</th><th>Cookie</th><th>Session</th></tr></thead><tbody><tr><td>存储位置</td><td>客户端浏览器（本地文件&#x2F;内存）</td><td>服务端（内存&#x2F;Redis&#x2F;Memcached）</td></tr><tr><td>存储大小</td><td>受限（通常4KB&#x2F;个，总数≤20个）</td><td>无大小限制（受服务端资源约束）</td></tr><tr><td>安全性</td><td>易被篡改&#x2F;窃取（前端可访问）</td><td>相对安全（仅服务端可访问）</td></tr><tr><td>有效期</td><td>可设置持久化（Expires&#x2F;Max-Age）</td><td>默认随会话结束（关闭浏览器）失效</td></tr><tr><td>核心标识</td><td>无（可自定义键值）</td><td>SessionID（通常存在Cookie中）</td></tr></tbody></table><h3 id="二、Cookie-的核心应用场景"><a href="#二、Cookie-的核心应用场景" class="headerlink" title="二、Cookie 的核心应用场景"></a>二、Cookie 的核心应用场景</h3><p>Cookie 适合存储<strong>轻量、非敏感、客户端需要频繁读取</strong>的状态信息，核心场景如下：</p><h4 id="1-会话标识（SessionID-载体）"><a href="#1-会话标识（SessionID-载体）" class="headerlink" title="1. 会话标识（SessionID 载体）"></a>1. 会话标识（SessionID 载体）</h4><ul><li><strong>场景</strong>：服务端创建 Session 后，将唯一的 <code>SessionID</code> 存入 Cookie（默认键名 <code>JSESSIONID</code>），客户端每次请求携带该 Cookie，服务端通过 <code>SessionID</code> 找到对应的 Session。</li><li><strong>示例</strong>：用户登录后，服务端生成 Session 存储用户信息，将 <code>JSESSIONID=xxx</code> 写入 Cookie，后续请求通过该 Cookie 关联用户会话。</li><li><strong>注意</strong>：可设置 <code>HttpOnly=true</code> 防止前端 JS 读取（避免 XSS 攻击），<code>Secure=true</code> 仅在 HTTPS 下传输，<code>SameSite=Strict/Lax</code> 防止 CSRF 攻击。</li></ul><h4 id="2-记住登录状态（自动登录）"><a href="#2-记住登录状态（自动登录）" class="headerlink" title="2. 记住登录状态（自动登录）"></a>2. 记住登录状态（自动登录）</h4><ul><li><strong>场景</strong>：用户勾选“记住我”&#x2F;“自动登录7天”，服务端生成<strong>持久化 Cookie</strong>（设置 <code>Max-Age=60*60*24*7</code>），存储加密后的用户标识（如 userId+token），下次用户访问时，服务端验证 Cookie 直接免登。</li><li><strong>最佳实践</strong>：<ul><li>不存储明文密码&#x2F;敏感信息，需对用户标识加密（如 HMAC 签名）；</li><li>设置较短有效期（如7-30天），并提供“退出登录”清除 Cookie 的功能。</li></ul></li></ul><h4 id="3-客户端个性化配置"><a href="#3-客户端个性化配置" class="headerlink" title="3. 客户端个性化配置"></a>3. 客户端个性化配置</h4><ul><li><strong>场景</strong>：存储用户在客户端的个性化偏好（无需同步到服务端），如：<ul><li>网站主题（深色&#x2F;浅色模式）、语言（中文&#x2F;英文）；</li><li>页面展示配置（每页显示条数、表格列排序）；</li><li>购物车临时数据（未登录用户，登录后同步到服务端）。</li></ul></li><li><strong>示例</strong>：前端读取 <code>theme=dark</code> 的 Cookie，初始化页面样式；无需请求服务端，提升体验。</li></ul><h4 id="4-营销-统计类场景"><a href="#4-营销-统计类场景" class="headerlink" title="4. 营销&#x2F;统计类场景"></a>4. 营销&#x2F;统计类场景</h4><ul><li><strong>场景</strong>：<ul><li>广告追踪：存储用户广告点击标识，统计曝光&#x2F;转化；</li><li>首次访问提示：存储 <code>first_visit=true</code>，仅首次打开网站显示引导弹窗；</li><li>限流防刷：存储客户端请求次数（如 <code>req_count=5</code>），限制高频请求（需服务端校验，防止篡改）。</li></ul></li></ul><h4 id="5-跨子域名共享状态"><a href="#5-跨子域名共享状态" class="headerlink" title="5. 跨子域名共享状态"></a>5. 跨子域名共享状态</h4><ul><li><strong>场景</strong>：主站 <code>xxx.com</code> 和子站 <code>shop.xxx.com</code> 共享登录状态，设置 Cookie 的 <code>Domain=.xxx.com</code>，实现跨子域名访问。</li></ul><h3 id="三、Session-的核心应用场景"><a href="#三、Session-的核心应用场景" class="headerlink" title="三、Session 的核心应用场景"></a>三、Session 的核心应用场景</h3><p>Session 适合存储<strong>敏感、临时、服务端管控</strong>的用户会话信息，核心场景如下：</p><h4 id="1-登录态核心存储"><a href="#1-登录态核心存储" class="headerlink" title="1. 登录态核心存储"></a>1. 登录态核心存储</h4><ul><li><strong>场景</strong>：用户登录成功后，将<strong>敏感用户信息</strong>存入 Session（而非 Cookie），如：<ul><li>用户基本信息（userId、用户名、角色、权限）；</li><li>登录时间、登录IP、设备信息；</li><li>临时权限（如验证码、未提交的表单数据）。</li></ul></li><li><strong>示例</strong>：Spring Boot 中通过 <code>HttpSession.setAttribute(&quot;user&quot;, loginUser)</code> 存储，后续通过 <code>session.getAttribute(&quot;user&quot;)</code> 获取，验证用户是否登录、是否有操作权限。</li></ul><h4 id="2-临时会话数据（单次请求-会话有效）"><a href="#2-临时会话数据（单次请求-会话有效）" class="headerlink" title="2. 临时会话数据（单次请求&#x2F;会话有效）"></a>2. 临时会话数据（单次请求&#x2F;会话有效）</h4><ul><li><strong>场景</strong>：存储仅在当前会话有效、无需持久化的数据，如：<ul><li>表单提交的临时数据（如多步骤下单的中间信息）；</li><li>验证码（如短信&#x2F;图形验证码，有效期5分钟，存储在 Session 避免前端篡改）；</li><li>页面跳转的临时提示（如“操作成功”的消息，显示后立即清除）。</li></ul></li><li><strong>示例</strong>：用户填写注册表单（多步骤），每步数据存入 Session，最后一步统一提交；若用户关闭浏览器，Session 失效，数据自动清理。</li></ul><h4 id="3-服务端会话管控"><a href="#3-服务端会话管控" class="headerlink" title="3. 服务端会话管控"></a>3. 服务端会话管控</h4><ul><li><strong>场景</strong>：需要服务端主动控制会话生命周期的场景，如：<ul><li>强制下线：管理员可通过 <code>SessionID</code> 销毁指定用户的 Session，实现踢人；</li><li>多端登录限制：限制同一账号仅允许1个设备登录，新登录时销毁旧 Session；</li><li>会话超时：设置 Session 有效期（如30分钟无操作自动失效），防止长期未操作的会话泄露。</li></ul></li></ul><h4 id="4-分布式系统中的会话共享"><a href="#4-分布式系统中的会话共享" class="headerlink" title="4. 分布式系统中的会话共享"></a>4. 分布式系统中的会话共享</h4><ul><li><strong>场景</strong>：微服务&#x2F;集群部署时，Session 需脱离单机内存，存储在 Redis 等分布式缓存中，实现多节点共享。</li><li><strong>示例</strong>：Spring Boot 集成 <code>spring-session-data-redis</code>，将 Session 存入 Redis，用户请求分发到任意节点都能读取到会话信息。</li></ul><h3 id="四、Cookie-Session-配合使用的典型场景"><a href="#四、Cookie-Session-配合使用的典型场景" class="headerlink" title="四、Cookie + Session 配合使用的典型场景"></a>四、Cookie + Session 配合使用的典型场景</h3><p>大部分 Web 项目中，二者是“搭档”关系，核心流程：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 用户登录 → 服务端验证账号密码 → 创建 Session（存储用户信息）→ 生成 SessionID → 写入 Cookie（JSESSIONID=xxx）；</span><br><span class="line">2. 用户后续请求 → 浏览器自动携带 Cookie（JSESSIONID）→ 服务端通过 SessionID 查找 Session → 验证用户身份/权限；</span><br><span class="line">3. 用户退出登录 → 服务端销毁 Session → 清除客户端 Cookie（JSESSIONID）。</span><br></pre></td></tr></table></figure><p><strong>典型业务场景</strong>：</p><ul><li>电商系统：Session 存储用户登录态、购物车（登录后），Cookie 存储未登录购物车、页面偏好；</li><li>后台管理系统：Session 存储用户权限、登录信息，Cookie 存储“记住登录”标识、菜单展开状态；</li><li>支付系统：Session 存储支付订单临时信息、验证码，Cookie 存储支付渠道偏好。</li></ul><h3 id="五、框架落地（Spring-Boot-示例）"><a href="#五、框架落地（Spring-Boot-示例）" class="headerlink" title="五、框架落地（Spring Boot 示例）"></a>五、框架落地（Spring Boot 示例）</h3><h4 id="1-Cookie-操作"><a href="#1-Cookie-操作" class="headerlink" title="1. Cookie 操作"></a>1. Cookie 操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/setCookie&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">setCookie</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 存储 SessionID（框架自动处理，无需手动）</span></span><br><span class="line">    <span class="comment">// 2. 手动设置个性化 Cookie</span></span><br><span class="line">    <span class="type">Cookie</span> <span class="variable">themeCookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;theme&quot;</span>, <span class="string">&quot;dark&quot;</span>);</span><br><span class="line">    themeCookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>); <span class="comment">// 有效期7天</span></span><br><span class="line">    themeCookie.setPath(<span class="string">&quot;/&quot;</span>); <span class="comment">// 全站可访问</span></span><br><span class="line">    themeCookie.setHttpOnly(<span class="literal">false</span>); <span class="comment">// 前端可读取（用于主题切换）</span></span><br><span class="line">    themeCookie.setSecure(<span class="literal">true</span>); <span class="comment">// HTTPS下传输</span></span><br><span class="line">    response.addCookie(themeCookie);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Cookie 设置成功&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getCookie&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getCookie</span><span class="params">(<span class="meta">@CookieValue(value = &quot;theme&quot;, defaultValue = &quot;light&quot;)</span> String theme)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;当前主题：&quot;</span> + theme;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-Session-操作"><a href="#2-Session-操作" class="headerlink" title="2. Session 操作"></a>2. Session 操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(String username, String password, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 验证账号密码（省略）</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, username, <span class="string">&quot;ADMIN&quot;</span>);</span><br><span class="line">    session.setAttribute(<span class="string">&quot;loginUser&quot;</span>, user);</span><br><span class="line">    session.setMaxInactiveInterval(<span class="number">1800</span>); <span class="comment">// 会话超时30分钟</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;登录成功&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/userInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">userInfo</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> (User) session.getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (loginUser == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;未登录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> loginUser;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">logout</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    session.invalidate(); <span class="comment">// 销毁Session</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;退出成功&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-分布式-Session（Redis-共享）"><a href="#3-分布式-Session（Redis-共享）" class="headerlink" title="3. 分布式 Session（Redis 共享）"></a>3. 分布式 Session（Redis 共享）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- 依赖 --></span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">session:</span></span><br><span class="line">    <span class="attr">store-type:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">1800s</span> <span class="comment"># Session超时时间</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><h3 id="六、避坑指南（最佳实践）"><a href="#六、避坑指南（最佳实践）" class="headerlink" title="六、避坑指南（最佳实践）"></a>六、避坑指南（最佳实践）</h3><ol><li><strong>Cookie 不要存敏感信息</strong>：如密码、token（可存加密后的标识），开启 <code>HttpOnly/Secure/SameSite</code>；</li><li><strong>Session 避免存大数据</strong>：仅存核心会话信息，大数据（如用户详情）查数据库&#x2F;缓存；</li><li><strong>Session 超时合理设置</strong>：后台系统30分钟、支付系统5分钟，避免过长&#x2F;过短；</li><li><strong>禁用 Cookie 时的兼容</strong>：通过 URL 拼接 SessionID（如 <code>xxx.com?JSESSIONID=xxx</code>），但存在安全风险，仅作为兜底；</li><li><strong>移动端适配</strong>：App 无 Cookie 概念，可将 SessionID 存入本地缓存（如 SharedPreferences），请求时放在 Header 中（如 <code>Authorization: Bearer ${sessionId}</code>）。</li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table><thead><tr><th>技术</th><th>核心适用场景</th><th>核心原则</th></tr></thead><tbody><tr><td>Cookie</td><td>轻量、非敏感、客户端持久化状态</td><td>小数据、低安全、客户端可控</td></tr><tr><td>Session</td><td>敏感、临时、服务端管控的会话状态</td><td>核心登录态、服务端可控、安全</td></tr></tbody></table><p>实际项目中，需根据“数据敏感度、存储大小、有效期、访问频率”选择：敏感数据优先放 Session，客户端个性化数据放 Cookie，二者配合实现完整的状态管理。</p>]]></content>
      
      
      <categories>
          
          <category> Web开发 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot集成Jasypt加密敏感配置最佳实践</title>
      <link href="/2026/01/01/Jasypt%20%E5%8A%A0%E5%AF%86%E4%BF%A1%E6%81%AF%202026_1_1/"/>
      <url>/2026/01/01/Jasypt%20%E5%8A%A0%E5%AF%86%E4%BF%A1%E6%81%AF%202026_1_1/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Boot-集成-Jasypt-加密敏感配置最佳实践"><a href="#Spring-Boot-集成-Jasypt-加密敏感配置最佳实践" class="headerlink" title="Spring Boot 集成 Jasypt 加密敏感配置最佳实践"></a>Spring Boot 集成 Jasypt 加密敏感配置最佳实践</h1><p>Jasypt（Java Simplified Encryption）可安全加密 Spring Boot 配置文件中的敏感信息（如数据库密码、API 密钥、Redis 密码等），避免明文泄露。本文梳理规范的集成方案，涵盖环境隔离、密钥安全、算法选择等核心最佳实践。</p><h2 id="一、核心原则"><a href="#一、核心原则" class="headerlink" title="一、核心原则"></a>一、核心原则</h2><ol><li><strong>密钥不硬编码</strong>：禁止将加密密钥（secret key）写入代码或配置文件，优先通过环境变量、命令行参数或密钥管理服务（KMS）注入。</li><li><strong>环境隔离</strong>：开发、测试、生产环境使用独立密钥，生产环境密钥需严格保密（仅运维&#x2F;核心人员知晓）。</li><li><strong>按需加密</strong>：仅加密敏感字段（密码、密钥、令牌等），非敏感配置（端口、日志级别、超时时间等）无需加密。</li><li><strong>算法安全</strong>：使用高强度加密算法（如 PBKDF2WithHmacSHA512 + AES-256），避免 MD5、DES 等弱算法。</li></ol><h2 id="二、集成步骤（基础版：默认解密方式）"><a href="#二、集成步骤（基础版：默认解密方式）" class="headerlink" title="二、集成步骤（基础版：默认解密方式）"></a>二、集成步骤（基础版：默认解密方式）</h2><p>基于 <code>jasypt-spring-boot-starter</code> 实现配置文件敏感信息自动加密&#x2F;解密，步骤如下：</p><h3 id="步骤-1：引入-Maven-依赖"><a href="#步骤-1：引入-Maven-依赖" class="headerlink" title="步骤 1：引入 Maven 依赖"></a>步骤 1：引入 Maven 依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment"><!-- 推荐使用最新稳定版 --></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="步骤-2：配置-Jasypt-解密规则"><a href="#步骤-2：配置-Jasypt-解密规则" class="headerlink" title="步骤 2：配置 Jasypt 解密规则"></a>步骤 2：配置 Jasypt 解密规则</h3><p>在 <code>application.yml</code>（或 <code>application.properties</code>）中配置加密密钥、算法等核心参数：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jasypt:</span></span><br><span class="line">  <span class="attr">encryptor:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">mySecretKey</span>  <span class="comment"># 加密/解密密钥（生产环境禁止写在此处）</span></span><br><span class="line">    <span class="attr">algorithm:</span> <span class="string">PBEWithMD5AndDES</span>  <span class="comment"># 加密算法（基础版，生产建议替换为高强度算法）</span></span><br><span class="line">    <span class="attr">iv-generator-classname:</span> <span class="string">org.jasypt.iv.NoIvGenerator</span>  <span class="comment"># 禁用IV生成（适配基础算法）</span></span><br></pre></td></tr></table></figure><h3 id="步骤-3：生成加密内容"><a href="#步骤-3：生成加密内容" class="headerlink" title="步骤 3：生成加密内容"></a>步骤 3：生成加密内容</h3><p>编写工具类生成敏感信息的密文（如数据库密码 <code>123456</code>）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jasypt.util.text.BasicTextEncryptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JasyptEncryptUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化加密器</span></span><br><span class="line">        <span class="type">BasicTextEncryptor</span> <span class="variable">encryptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicTextEncryptor</span>();</span><br><span class="line">        encryptor.setPassword(<span class="string">&quot;mySecretKey&quot;</span>); <span class="comment">// 与配置文件中的密钥一致</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 加密敏感信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">plainText</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>; <span class="comment">// 原始明文（数据库密码）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cipherText</span> <span class="operator">=</span> encryptor.encrypt(plainText);</span><br><span class="line">        System.out.println(<span class="string">&quot;密文：&quot;</span> + cipherText); <span class="comment">// 输出示例：kud5ZnaMJYve284geT0ITw==</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-4：替换配置文件中的明文为密文"><a href="#步骤-4：替换配置文件中的明文为密文" class="headerlink" title="步骤 4：替换配置文件中的明文为密文"></a>步骤 4：替换配置文件中的明文为密文</h3><p>将生成的密文包裹在 <code>ENC()</code> 中，替换配置文件中的敏感信息明文：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test_db</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">ENC(kud5ZnaMJYve284geT0ITw==)</span>  <span class="comment"># 密文需包裹在ENC()中</span></span><br></pre></td></tr></table></figure><h3 id="步骤-5：启用自动解密"><a href="#步骤-5：启用自动解密" class="headerlink" title="步骤 5：启用自动解密"></a>步骤 5：启用自动解密</h3><p>在 Spring Boot 启动类上添加 <code>@EnableEncryptableProperties</code> 注解，开启配置自动解密：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ulisesbocchio.jasyptspringboot.annotation.EnableEncryptableProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableEncryptableProperties</span> <span class="comment">// 启用加密配置自动解密</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootJasyptApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootJasyptApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、进阶配置（自定义解密规则）"><a href="#三、进阶配置（自定义解密规则）" class="headerlink" title="三、进阶配置（自定义解密规则）"></a>三、进阶配置（自定义解密规则）</h2><p>若需自定义密文前缀&#x2F;后缀、加密算法或解密逻辑，可实现 Jasypt 核心接口。</p><h3 id="场景-1：自定义密文前后缀（替换默认-ENC-）"><a href="#场景-1：自定义密文前后缀（替换默认-ENC-）" class="headerlink" title="场景 1：自定义密文前后缀（替换默认 ENC()）"></a>场景 1：自定义密文前后缀（替换默认 ENC()）</h3><p>默认 Jasypt 通过 <code>ENC()</code> 识别密文，可自定义为 <code>ikms()</code> 等格式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ulisesbocchio.jasyptspringboot.EncryptablePropertyDetector;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义密文检测器：识别以 ikms() 包裹的内容为密文</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyEncryptablePropertyDetector</span> <span class="keyword">implements</span> <span class="title class_">EncryptablePropertyDetector</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEncrypted</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// 判断值是否为密文（非空 + 以ikms(开头 + 以)结尾）</span></span><br><span class="line">        <span class="keyword">return</span> value != <span class="literal">null</span> &amp;&amp; value.startsWith(<span class="string">&quot;ikms(&quot;</span>) &amp;&amp; value.endsWith(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">unwrapEncryptedValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// 剥离前后缀，返回纯密文（此处可根据需求调整）</span></span><br><span class="line">        <span class="keyword">return</span> value.substring(<span class="number">5</span>, value.length() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="场景-2：自定义解密逻辑（如凯撒加密）"><a href="#场景-2：自定义解密逻辑（如凯撒加密）" class="headerlink" title="场景 2：自定义解密逻辑（如凯撒加密）"></a>场景 2：自定义解密逻辑（如凯撒加密）</h3><p>实现 <code>StringEncryptor</code> 接口，自定义解密算法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jasypt.encryption.StringEncryptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomStringEncryptor</span> <span class="keyword">implements</span> <span class="title class_">StringEncryptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String plainText)</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义加密逻辑（示例：凯撒加密）</span></span><br><span class="line">        <span class="keyword">return</span> KaiserUtil.encryptKaiser(plainText, <span class="number">123456</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decrypt</span><span class="params">(String cipherText)</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义解密逻辑（示例：凯撒解密）</span></span><br><span class="line">        <span class="keyword">return</span> KaiserUtil.decryptKaiser(cipherText, <span class="number">123456</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 凯撒加密工具类（示例）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KaiserUtil</span> &#123;</span><br><span class="line">    <span class="comment">// 凯撒加密</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptKaiser</span><span class="params">(String text, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] chars = text.toCharArray();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : chars) &#123;</span><br><span class="line">            sb.append((<span class="type">char</span>) (c + key));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 凯撒解密</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decryptKaiser</span><span class="params">(String text, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] chars = text.toCharArray();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : chars) &#123;</span><br><span class="line">            sb.append((<span class="type">char</span>) (c - key));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="四、生产环境最佳实践"><a href="#四、生产环境最佳实践" class="headerlink" title="四、生产环境最佳实践"></a>四、生产环境最佳实践</h2><h3 id="1-密钥安全注入（禁止硬编码）"><a href="#1-密钥安全注入（禁止硬编码）" class="headerlink" title="1. 密钥安全注入（禁止硬编码）"></a>1. 密钥安全注入（禁止硬编码）</h3><p>生产环境需通过启动参数、环境变量或 KMS 注入密钥，示例：</p><h4 id="方式-1：命令行启动参数"><a href="#方式-1：命令行启动参数" class="headerlink" title="方式 1：命令行启动参数"></a>方式 1：命令行启动参数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar app.jar --jasypt.encryptor.password=prodSecretKey123!</span><br></pre></td></tr></table></figure><h4 id="方式-2：环境变量（Linux-Mac）"><a href="#方式-2：环境变量（Linux-Mac）" class="headerlink" title="方式 2：环境变量（Linux&#x2F;Mac）"></a>方式 2：环境变量（Linux&#x2F;Mac）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JASYPT_ENCRYPTOR_PASSWORD=prodSecretKey123!</span><br><span class="line">java -jar app.jar</span><br></pre></td></tr></table></figure><p>配置文件中引用环境变量：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jasypt:</span></span><br><span class="line">  <span class="attr">encryptor:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;JASYPT_ENCRYPTOR_PASSWORD&#125;</span></span><br></pre></td></tr></table></figure><h4 id="方式-3：容器化部署（Docker-K8s）"><a href="#方式-3：容器化部署（Docker-K8s）" class="headerlink" title="方式 3：容器化部署（Docker&#x2F;K8s）"></a>方式 3：容器化部署（Docker&#x2F;K8s）</h4><p>Dockerfile 中设置环境变量：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> JASYPT_ENCRYPTOR_PASSWORD=prodSecretKey123!</span><br></pre></td></tr></table></figure><p>K8s ConfigMap&#x2F;Secret 注入：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jasypt-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">jasypt-password:</span> <span class="string">cHJvZFNlY3JldEtleTEyMyE=</span> <span class="comment"># 加密后的密钥（base64编码）</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">app:latest</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JASYPT_ENCRYPTOR_PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">jasypt-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">jasypt-password</span></span><br></pre></td></tr></table></figure><h3 id="2-升级加密算法（高强度）"><a href="#2-升级加密算法（高强度）" class="headerlink" title="2. 升级加密算法（高强度）"></a>2. 升级加密算法（高强度）</h3><p>替换基础算法为 AES-256 等高强度算法：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jasypt:</span></span><br><span class="line">  <span class="attr">encryptor:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;JASYPT_ENCRYPTOR_PASSWORD&#125;</span></span><br><span class="line">    <span class="attr">algorithm:</span> <span class="string">PBKDF2WithHmacSHA512AndAES_256</span>  <span class="comment"># 高强度算法</span></span><br><span class="line">    <span class="attr">key-obtention-iterations:</span> <span class="number">100000</span>  <span class="comment"># 迭代次数（越高越安全）</span></span><br><span class="line">    <span class="attr">pool-size:</span> <span class="number">1</span>  <span class="comment"># 加密池大小</span></span><br><span class="line">    <span class="attr">provider-name:</span> <span class="string">SunJCE</span></span><br><span class="line">    <span class="attr">salt-generator-classname:</span> <span class="string">org.jasypt.salt.RandomSaltGenerator</span>  <span class="comment"># 随机盐值</span></span><br><span class="line">    <span class="attr">iv-generator-classname:</span> <span class="string">org.jasypt.iv.RandomIvGenerator</span>  <span class="comment"># 随机IV</span></span><br><span class="line">    <span class="attr">string-output-type:</span> <span class="string">base64</span>  <span class="comment"># 输出格式</span></span><br></pre></td></tr></table></figure><h3 id="3-验证解密有效性"><a href="#3-验证解密有效性" class="headerlink" title="3. 验证解密有效性"></a>3. 验证解密有效性</h3><p>启动应用后，通过代码验证敏感配置是否解密成功：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigTestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dbPassword;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/db/password&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDbPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dbPassword; <span class="comment">// 应返回解密后的明文（123456）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-多环境隔离"><a href="#4-多环境隔离" class="headerlink" title="4. 多环境隔离"></a>4. 多环境隔离</h3><p>为开发、测试、生产环境配置不同密钥，通过 <code>spring.profiles.active</code> 区分：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml（开发环境）</span></span><br><span class="line"><span class="attr">jasypt:</span></span><br><span class="line">  <span class="attr">encryptor:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">devSecretKey</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># application-test.yml（测试环境）</span></span><br><span class="line"><span class="attr">jasypt:</span></span><br><span class="line">  <span class="attr">encryptor:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">testSecretKey</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># application-prod.yml（生产环境）</span></span><br><span class="line"><span class="attr">jasypt:</span></span><br><span class="line">  <span class="attr">encryptor:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;JASYPT_ENCRYPTOR_PASSWORD&#125;</span></span><br></pre></td></tr></table></figure><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li>项目应用案例：<a href="https://github.com/zero201913/jasypt-demo">https://github.com/zero201913/jasypt-demo</a></li><li>jasypt-spring-boot 开源地址：<a href="https://github.com/ulisesbocchio/jasypt-spring-boot">https://github.com/ulisesbocchio/jasypt-spring-boot</a></li><li>进阶配置示例：<a href="https://pxzxj.github.io/articles/jasypt.html">https://pxzxj.github.io/articles/jasypt.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>手写Bean依赖注入容器：模拟Spring IoC核心原理</title>
      <link href="/2026/01/01/%E6%89%8B%E5%86%99%20Bean%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%202026_1_1/"/>
      <url>/2026/01/01/%E6%89%8B%E5%86%99%20Bean%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%202026_1_1/</url>
      
        <content type="html"><![CDATA[<h1 id="手写Bean-Factory-轻量级依赖注入容器"><a href="#手写Bean-Factory-轻量级依赖注入容器" class="headerlink" title="手写Bean Factory 轻量级依赖注入容器"></a>手写Bean Factory 轻量级依赖注入容器</h1><h2 id="一、项目概述"><a href="#一、项目概述" class="headerlink" title="一、项目概述"></a>一、项目概述</h2><p>本项目实现了一个轻量级的Java Bean Factory（依赖注入容器），核心目标是模拟Spring IoC容器的核心原理，具备<strong>组件自动扫描、多方式依赖注入、仓库接口动态代理、基于注解的查询解析</strong>等能力，并通过Java Stream API模拟数据库查询操作，完整展现了轻量级依赖注入容器的设计与实现逻辑。</p><h2 id="二、核心环境配置"><a href="#二、核心环境配置" class="headerlink" title="二、核心环境配置"></a>二、核心环境配置</h2><h3 id="1-项目基础结构"><a href="#1-项目基础结构" class="headerlink" title="1. 项目基础结构"></a>1. 项目基础结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bean-factory-demo/</span><br><span class="line">├── .gitignore</span><br><span class="line">├── README.md</span><br><span class="line">├── pom.xml          # Maven依赖配置</span><br><span class="line">├── .idea/           # IDE配置文件</span><br><span class="line">└── src/main/java/cn/zero/</span><br><span class="line">    ├── annotation/  # 自定义注解定义（核心扩展点）</span><br><span class="line">    ├── factory/     # Bean工厂核心实现（容器核心）</span><br><span class="line">    ├── model/       # 数据模型（业务实体）</span><br><span class="line">    ├── repository/  # 数据访问层（接口+注解查询）</span><br><span class="line">    ├── service/     # 业务逻辑层（Bean组件）</span><br><span class="line">    └── test/        # 测试类（验证容器功能）</span><br></pre></td></tr></table></figure><h3 id="2-Maven依赖（核心推测）"><a href="#2-Maven依赖（核心推测）" class="headerlink" title="2. Maven依赖（核心推测）"></a>2. Maven依赖（核心推测）</h3><p>项目聚焦纯Java原生实现+基础依赖，无复杂框架依赖：</p><ul><li>JDK 8+（支撑Lambda、Stream API、注解反射、动态代理）；</li><li>无额外Spring等框架依赖，完全自定义实现IoC核心逻辑。</li></ul><h2 id="三、核心功能模块与实现方式"><a href="#三、核心功能模块与实现方式" class="headerlink" title="三、核心功能模块与实现方式"></a>三、核心功能模块与实现方式</h2><h3 id="1-自定义注解系统（核心扩展点）"><a href="#1-自定义注解系统（核心扩展点）" class="headerlink" title="1. 自定义注解系统（核心扩展点）"></a>1. 自定义注解系统（核心扩展点）</h3><table><thead><tr><th>注解名称</th><th>作用目标</th><th>核心功能</th><th>关键属性</th></tr></thead><tbody><tr><td>@Component</td><td>类（TYPE）</td><td>标记类为Bean组件，触发容器自动扫描并创建实例</td><td>value：可选，指定Bean名称（默认类名首字母小写）</td></tr><tr><td>@Autowired</td><td>字段、构造函数、方法</td><td>标记依赖注入点，触发容器自动注入依赖</td><td>required：默认true，依赖必须存在（否则抛异常）</td></tr><tr><td>@Query</td><td>方法（METHOD）</td><td>为仓库接口方法定义查询语句，模拟SQL查询</td><td>value：查询语句（如<code>SELECT u FROM User u WHERE u.age &gt; :age</code>）</td></tr></tbody></table><h4 id="注解实现共性："><a href="#注解实现共性：" class="headerlink" title="注解实现共性："></a>注解实现共性：</h4><ul><li>保留策略：<code>RetentionPolicy.RUNTIME</code>（运行时可通过反射获取）；</li><li>文档化：<code>@Documented</code>（生成文档时包含注解说明）。</li></ul><h3 id="2-BeanFactory-核心容器（核心实现）"><a href="#2-BeanFactory-核心容器（核心实现）" class="headerlink" title="2. BeanFactory 核心容器（核心实现）"></a>2. BeanFactory 核心容器（核心实现）</h3><h4 id="2-1-核心数据结构"><a href="#2-1-核心数据结构" class="headerlink" title="2.1 核心数据结构"></a>2.1 核心数据结构</h4><table><thead><tr><th>变量名</th><th>类型</th><th>核心作用</th></tr></thead><tbody><tr><td>beans</td><td><code>ConcurrentHashMap&lt;String, Object&gt;</code></td><td>存储所有Bean实例，键&#x3D;Bean名称，值&#x3D;Bean实例（线程安全）</td></tr><tr><td>sampleData</td><td><code>ConcurrentHashMap&lt;Class&lt;?&gt;, List&lt;?&gt;&gt;</code></td><td>存储模拟数据库的示例数据，支撑查询功能（键&#x3D;数据模型类，值&#x3D;模拟数据列表）</td></tr></tbody></table><h4 id="2-2-初始化流程（核心逻辑）"><a href="#2-2-初始化流程（核心逻辑）" class="headerlink" title="2.2 初始化流程（核心逻辑）"></a>2.2 初始化流程（核心逻辑）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 初始化模拟数据（填充sampleData）</span></span><br><span class="line">    initializeSampleData();</span><br><span class="line">    <span class="comment">// 2. 扫描指定包下所有类</span></span><br><span class="line">    List&lt;Class&lt;?&gt;&gt; allClasses = getClassesInPackage(basePackage);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 优先创建仓库接口代理（依赖前置）</span></span><br><span class="line">    List&lt;Class&lt;?&gt;&gt; repositoryInterfaces = allClasses.stream()</span><br><span class="line">            .filter(clazz -&gt; clazz.isInterface() &amp;&amp; clazz.getName().endsWith(<span class="string">&quot;Repository&quot;</span>))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; intf : repositoryInterfaces) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> createProxy(intf); <span class="comment">// 动态代理创建仓库接口实例</span></span><br><span class="line">        beans.put(getBeanName(intf), proxy); <span class="comment">// 代理实例存入beans容器</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 创建@Component注解标记的组件实例（业务Bean）</span></span><br><span class="line">    List&lt;Class&lt;?&gt;&gt; componentClasses = allClasses.stream()</span><br><span class="line">            .filter(clazz -&gt; !clazz.isInterface() &amp;&amp; clazz.isAnnotationPresent(Component.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// （注：完整逻辑含实例化、依赖注入、存入beans容器）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>初始化核心步骤拆解：</p><ol><li><strong>数据初始化</strong>：<code>initializeSampleData()</code> 填充模拟数据库数据到<code>sampleData</code>；</li><li><strong>包扫描</strong>：<code>getClassesInPackage(basePackage)</code> 扫描指定包下所有类，为后续组件识别做准备；</li><li><strong>仓库代理优先创建</strong>：<ul><li>筛选所有以<code>Repository</code>结尾的接口；</li><li>通过<code>createProxy(intf)</code>创建动态代理实例，存入<code>beans</code>容器（保证业务Bean依赖注入时仓库已存在）；</li></ul></li><li><strong>业务Bean创建</strong>：筛选<code>@Component</code>注解的非接口类，完成实例化+依赖注入后存入<code>beans</code>容器。</li></ol><h4 id="2-3-核心能力实现"><a href="#2-3-核心能力实现" class="headerlink" title="2.3 核心能力实现"></a>2.3 核心能力实现</h4><table><thead><tr><th>能力名称</th><th>实现方式</th><th>核心逻辑</th></tr></thead><tbody><tr><td>组件扫描</td><td>反射+包扫描</td><td>通过类加载器扫描指定包下所有类，筛选<code>@Component</code>注解类&#x2F;<code>Repository</code>接口</td></tr><tr><td>依赖注入</td><td>反射+@Autowired注解</td><td>实例化Bean后，通过反射遍历字段&#x2F;构造函数&#x2F;方法，识别<code>@Autowired</code>注解，从<code>beans</code>容器中获取依赖并注入</td></tr><tr><td>动态代理（仓库接口）</td><td>JDK动态代理</td><td>对<code>Repository</code>接口生成代理类，解析<code>@Query</code>注解的查询语句，结合<code>sampleData</code>通过Stream API执行模拟查询</td></tr><tr><td>Bean获取</td><td>名称&#x2F;类型映射</td><td>通过<code>getBeanName(Class&lt;?&gt; type)</code>将Bean类型转换为名称，从<code>beans</code>集合中获取实例（支持按类型获取）</td></tr></tbody></table><h3 id="3-业务层与数据层适配"><a href="#3-业务层与数据层适配" class="headerlink" title="3. 业务层与数据层适配"></a>3. 业务层与数据层适配</h3><h4 id="3-1-数据模型（model）"><a href="#3-1-数据模型（model）" class="headerlink" title="3.1 数据模型（model）"></a>3.1 数据模型（model）</h4><ul><li>核心类：<code>User.java</code>（用户模型），作为模拟查询的基础数据结构；</li><li>作用：封装业务数据，支撑<code>sampleData</code>模拟数据存储和<code>@Query</code>查询解析。</li></ul><h4 id="3-2-数据访问层（repository）"><a href="#3-2-数据访问层（repository）" class="headerlink" title="3.2 数据访问层（repository）"></a>3.2 数据访问层（repository）</h4><ul><li>核心接口：<code>UserRepository.java</code>（用户仓库接口）；</li><li>设计特点：无实现类，通过<code>BeanFactory</code>动态代理生成实例；</li><li>核心能力：方法上标注<code>@Query</code>注解，定义查询规则，代理类解析注解并执行Stream模拟查询。</li></ul><h4 id="3-3-业务逻辑层（service）"><a href="#3-3-业务逻辑层（service）" class="headerlink" title="3.3 业务逻辑层（service）"></a>3.3 业务逻辑层（service）</h4><ul><li>核心类：<code>UserService.java</code>（用户服务类）；</li><li>设计特点：标注<code>@Component</code>注解，触发容器自动实例化；</li><li>核心能力：通过<code>@Autowired</code>注入<code>UserRepository</code>代理实例，调用仓库方法完成业务逻辑。</li></ul><h2 id="四、核心技术栈与设计思想"><a href="#四、核心技术栈与设计思想" class="headerlink" title="四、核心技术栈与设计思想"></a>四、核心技术栈与设计思想</h2><h3 id="1-核心技术栈"><a href="#1-核心技术栈" class="headerlink" title="1. 核心技术栈"></a>1. 核心技术栈</h3><ul><li>反射（java.lang.reflect）：实现注解解析、类扫描、实例化、依赖注入；</li><li>JDK动态代理（java.lang.reflect.Proxy）：为仓库接口生成动态代理实例，实现无实现类的查询逻辑；</li><li>Java Stream API：模拟数据库查询（解析<code>@Query</code>语句后，通过Stream过滤&#x2F;匹配<code>sampleData</code>数据）；</li><li>并发容器（ConcurrentHashMap）：保证Bean容器和模拟数据的线程安全；</li><li>自定义注解：扩展容器能力，对标Spring注解设计思路。</li></ul><h3 id="2-核心设计思想"><a href="#2-核心设计思想" class="headerlink" title="2. 核心设计思想"></a>2. 核心设计思想</h3><ul><li>控制反转（IoC）：Bean的创建、依赖注入由容器（BeanFactory）管理，而非业务类自行创建；</li><li>组件化：通过<code>@Component</code>标记业务类，实现组件化管理，降低耦合；</li><li>面向接口编程：仓库层仅定义接口，通过动态代理实现，解耦接口与实现；</li><li>约定优于配置：默认Bean名称为类名首字母小写、Repository接口以固定后缀命名，减少配置成本；</li><li>分层设计：注解层→容器层→数据层→业务层，职责单一，分层清晰。</li></ul><h2 id="五、测试验证"><a href="#五、测试验证" class="headerlink" title="五、测试验证"></a>五、测试验证</h2><ul><li>核心测试类：<code>BeanFactoryTest.java</code>；</li><li>测试目标：验证BeanFactory的组件扫描、依赖注入、仓库查询等核心功能；</li><li>测试逻辑：初始化BeanFactory，获取UserService实例，调用业务方法，验证查询结果是否符合<code>@Query</code>定义规则。</li></ul><h2 id="六、项目价值与复盘要点"><a href="#六、项目价值与复盘要点" class="headerlink" title="六、项目价值与复盘要点"></a>六、项目价值与复盘要点</h2><h3 id="1-项目价值"><a href="#1-项目价值" class="headerlink" title="1. 项目价值"></a>1. 项目价值</h3><ul><li>原理级实现：完整模拟Spring IoC容器核心逻辑，理解依赖注入、动态代理、注解解析的底层实现；</li><li>轻量化设计：无框架依赖，聚焦核心逻辑，便于学习和扩展；</li><li>对标Spring：注解设计、容器思想与Spring高度契合，降低Spring源码学习门槛。</li></ul><h3 id="2-复盘关键要点"><a href="#2-复盘关键要点" class="headerlink" title="2. 复盘关键要点"></a>2. 复盘关键要点</h3><ol><li>容器初始化顺序：仓库代理优先创建的原因（保证业务Bean注入时依赖已存在）；</li><li>动态代理核心：仓库接口代理类如何解析<code>@Query</code>注解并结合Stream执行查询；</li><li>依赖注入实现：<code>@Autowired</code>支持字段&#x2F;构造函数&#x2F;方法注入的反射逻辑差异；</li><li>线程安全：使用ConcurrentHashMap的设计考量（多线程场景下Bean容器的安全性）；</li><li>扩展方向：可参考Spring扩展<code>@Scope</code>（作用域）、<code>@Qualifier</code>（限定符）等注解，丰富容器能力。</li></ol><h3 id="3-项目链接"><a href="#3-项目链接" class="headerlink" title="3. 项目链接"></a>3. 项目链接</h3><ul><li>项目仓库：<a href="https://github.com/zero201913/bean-factory-demo">https://github.com/zero201913/bean-factory-demo</a></li><li>项目文档：<a href="https://github.com/zero201913/bean-factory-demo/blob/main/README.md">https://github.com/zero201913/bean-factory-demo/blob/main/README.md</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 框架原理 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>关于我</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<h1 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h1><h2 id="👋-自我介绍"><a href="#👋-自我介绍" class="headerlink" title="👋 自我介绍"></a>👋 自我介绍</h2><p>我是一名深耕技术领域的开发者，痴迷于探索编程世界的底层逻辑与前沿技术。多年来，我始终以“知识沉淀与技术布道”为追求，在Java生态、前端工程化、设计模式与系统架构等领域不断深耕，致力于将复杂的技术概念拆解为通俗易懂的知识体系，助力更多开发者在技术成长之路上少走弯路。</p><h2 id="🧠-技术深耕领域"><a href="#🧠-技术深耕领域" class="headerlink" title="🧠 技术深耕领域"></a>🧠 技术深耕领域</h2><p>基于我在博客中沉淀的技术内容，我的知识体系覆盖以下核心领域：</p><ul><li><strong>Java 全栈技术</strong><ul><li>深入理解Java泛型、线程模型、反射机制等底层原理，对《Java核心技术》有体系化的知识输出</li><li>精通Spring框架全家桶，从IOC&#x2F;AOP的设计理念到bean.xml解析与反射生成对象的底层原理均有深度剖析</li><li>熟练运用JavaStream API进行高效数据处理，对Java IO、NIO有实战级认知</li></ul></li><li><strong>企业级开发与架构</strong><ul><li>掌握Commons IO和Commons FileUpload实现文件上传下载的企业级方案</li><li>理解设计模式在实际场景中的落地，对单一职责原则（SRP）、里氏替换原则、构造者模式等有详细解读</li><li>具备系统设计能力，如乐淘管理系统设计、基于AJAX的前后端交互方案等</li></ul></li><li><strong>前端与安全技术</strong><ul><li>精通jQuery、JavaScript原生技术，对前端工程化有实践经验</li><li>关注Web安全，深入研究XSS攻击与防御的技术细节</li></ul></li><li><strong>工具与工程实践</strong><ul><li>熟练使用Log4j2 + SLF4J进行日志系统的配置与优化</li><li>掌握Cookie与Session的原理及在分布式场景下的应用</li></ul></li><li><strong>算法与问题解决</strong><ul><li>对算法有持续研究，如最短路径问题的迪杰斯特拉算法有手掰级详解</li><li>提炼出“讲故事的核心框架：问题解决五步法”，将技术问题拆解为可落地的解决方案</li></ul></li></ul><h2 id="🛠-技术栈图谱"><a href="#🛠-技术栈图谱" class="headerlink" title="🛠 技术栈图谱"></a>🛠 技术栈图谱</h2><ul><li><strong>前端</strong>：JavaScript 原生、jQuery、Vue、React</li><li><strong>后端</strong>：Java（含Spring全家桶）、Node.js、Python</li><li><strong>数据库</strong>：MySQL、MongoDB、Redis</li><li><strong>工具与架构</strong>：设计模式、企业级日志系统（Log4j2+SLF4J）、系统设计方法论</li><li><strong>安全</strong>：Web安全（XSS防御等）</li></ul><h2 id="📚-知识输出与价值"><a href="#📚-知识输出与价值" class="headerlink" title="📚 知识输出与价值"></a>📚 知识输出与价值</h2><p>我的博客内容并非零散的技术碎片，而是围绕“<strong>从原理到实践，从单点到体系</strong>”的思路进行创作：</p><ul><li>对于<strong>Java初学者</strong>，我提供从基础语法到框架原理的“阶梯式”学习路径，例如《Java泛型核心知识点复习文档》《Java线程复习指南》</li><li>对于<strong>中高级开发者</strong>，我拆解Spring源码级原理、设计模式的落地场景、系统架构的决策逻辑，如《Spring中IOC和AOP的设计哲学》《单一职责原则（SRP）详解》</li><li>对于<strong>技术管理者</strong>，我输出系统设计方法论、问题解决框架，如《乐淘管理系统设计全解析》《问题解决五步法》</li></ul><h2 id="📫-联系我"><a href="#📫-联系我" class="headerlink" title="📫 联系我"></a>📫 联系我</h2><ul><li><strong>邮箱</strong>: <a href="mailto:&#x7a;&#101;&#x72;&#111;&#50;&#x30;&#x31;&#57;&#49;&#51;&#x40;&#111;&#x75;&#116;&#108;&#x6f;&#111;&#x6b;&#x2e;&#99;&#x6f;&#109;">zero201913@outlook.com</a></li><li><strong>GitHub</strong>: <a href="https://github.com/zero201913">zero201913</a></li><li><strong>博客</strong>: <a href="http://zero02.space/">zero02.space</a></li></ul><hr><p>感谢访问我的博客！期待与你在技术的海洋中共同成长。</p>]]></content>
      
    </entry>
    
    
  
</search>
